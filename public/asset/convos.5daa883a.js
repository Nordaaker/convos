!function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function a(e){return e()}function o(){return Object.create(null)}function r(e){e.forEach(a)}function i(e){return"function"==typeof e}function c(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function s(e,t){const n=e.subscribe(t);return n.unsubscribe?()=>n.unsubscribe():n}function d(e,t,n){e.$$.on_destroy.push(s(t,n))}function u(e,t,n){if(e){const a=l(e,t,n);return e[0](a)}}function l(e,t,a){return e[1]?n({},n(t.$$scope.ctx,e[1](a?a(t):{}))):t.$$scope.ctx}function f(e,t,a,o){return e[1]?n({},n(t.$$scope.changed||{},e[1](o?o(a):{}))):t.$$scope.changed||{}}function p(e,t,n=t){return e.set(n),t}const h="undefined"!=typeof window;let g=h?()=>window.performance.now():()=>Date.now(),m=h?e=>requestAnimationFrame(e):e;const $=new Set;let v,b=!1;function y(){$.forEach(e=>{e[0](g())||($.delete(e),e[1]())}),(b=$.size>0)&&m(y)}function _(e,t){e.appendChild(t)}function w(e,t,n){e.insertBefore(t,n||null)}function k(e){e.parentNode.removeChild(e)}function x(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function E(e){return document.createElement(e)}function O(e){return document.createTextNode(e)}function S(){return O(" ")}function N(){return O("")}function A(e,t,n,a){return e.addEventListener(t,n,a),()=>e.removeEventListener(t,n,a)}function C(e){return function(t){return t.preventDefault(),e.call(this,t)}}function P(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function D(e,t){t=""+t,e.data!==t&&(e.data=t)}function j(e,t){(null!=t||e.value)&&(e.value=t)}function L(e,t,n,a){e.style.setProperty(t,n,a?"important":"")}function R(e,t,n){e.classList[n?"add":"remove"](t)}class T{constructor(e,t=null){this.e=E("div"),this.a=t,this.u(e)}m(e,t=null){for(let n=0;n<this.n.length;n+=1)w(e,this.n[n],t);this.t=e}u(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}p(e){this.d(),this.u(e),this.m(this.t,this.a)}d(){this.n.forEach(k)}}let M,I=0,U={};function H(e,t,n,a,o,r,i,c=0){const s=16.666/a;let d="{\n";for(let e=0;e<=1;e+=s){const a=t+(n-t)*r(e);d+=100*e+`%{${i(a,1-a)}}\n`}const u=d+`100% {${i(n,1-n)}}\n}`,l=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${c}`;if(!U[l]){if(!v){const e=E("style");document.head.appendChild(e),v=e.sheet}U[l]=!0,v.insertRule(`@keyframes ${l} ${u}`,v.cssRules.length)}const f=e.style.animation||"";return e.style.animation=`${f?`${f}, `:""}${l} ${a}ms linear ${o}ms 1 both`,I+=1,l}function z(e,t){e.style.animation=(e.style.animation||"").split(", ").filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")).join(", "),t&&!--I&&m(()=>{if(I)return;let e=v.cssRules.length;for(;e--;)v.deleteRule(e);U={}})}function B(e){M=e}function F(){if(!M)throw new Error("Function called outside component initialization");return M}function q(e){F().$$.on_mount.push(e)}function W(e,t){F().$$.context.set(e,t)}function K(e){return F().$$.context.get(e)}function V(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(e=>e(t))}const G=[],Y=[],J=[],X=[],Z=Promise.resolve();let Q,ee=!1;function te(){ee||(ee=!0,Z.then(oe))}function ne(e){J.push(e)}function ae(e){X.push(e)}function oe(){const e=new Set;do{for(;G.length;){const e=G.shift();B(e),re(e.$$)}for(;Y.length;)Y.pop()();for(let t=0;t<J.length;t+=1){const n=J[t];e.has(n)||(n(),e.add(n))}J.length=0}while(G.length);for(;X.length;)X.pop()();ee=!1}function re(e){e.fragment&&(e.update(e.dirty),r(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(ne))}function ie(e,t,n){e.dispatchEvent(function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(`${t?"intro":"outro"}${n}`))}const ce=new Set;let se;function de(){se={r:0,c:[],p:se}}function ue(){se.r||r(se.c),se=se.p}function le(e,t){e&&e.i&&(ce.delete(e),e.i(t))}function fe(e,t,n,a){if(e&&e.o){if(ce.has(e))return;ce.add(e),se.c.push(()=>{ce.delete(e),a&&(n&&e.d(1),a())}),e.o(t)}}const pe={duration:0};function he(n,a,o,c){let s=a(n,o),d=c?0:1,u=null,l=null,f=null;function p(){f&&z(n,f)}function h(e,t){const n=e.b-d;return t*=Math.abs(n),{a:d,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function v(a){const{delay:o=0,duration:i=300,easing:c=t,tick:v=e,css:_}=s||pe,w={start:g()+o,b:a};a||(w.group=se,se.r+=1),u?l=w:(_&&(p(),f=H(n,d,a,i,o,c,_)),a&&v(0,1),u=h(w,i),ne(()=>ie(n,a,"start")),function(e){let t;b||(b=!0,m(y)),new Promise(n=>{$.add(t=[e,n])})}(e=>{if(l&&e>l.start&&(u=h(l,i),l=null,ie(n,u.b,"start"),_&&(p(),f=H(n,d,u.b,u.duration,0,c,s.css))),u)if(e>=u.end)v(d=u.b,1-d),ie(n,u.b,"end"),l||(u.b?p():--u.group.r||r(u.group.c)),u=null;else if(e>=u.start){const t=e-u.start;d=u.a+u.d*c(t/u.duration),v(d,1-d)}return!(!u&&!l)}))}return{run(e){i(s)?(Q||(Q=Promise.resolve()).then(()=>{Q=null}),Q).then(()=>{s=s(),v(e)}):v(e)},end(){p(),u=l=null}}}function ge(e,t,n){-1!==e.$$.props.indexOf(t)&&(e.$$.bound[t]=n,n(e.$$.ctx[t]))}function me(e,t,n){const{fragment:o,on_mount:c,on_destroy:s,after_update:d}=e.$$;o.m(t,n),ne(()=>{const t=c.map(a).filter(i);s?s.push(...t):r(t),e.$$.on_mount=[]}),d.forEach(ne)}function $e(e,t){e.$$.fragment&&(r(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function ve(t,n,a,i,c,s){const d=M;B(t);const u=n.props||{},l=t.$$={fragment:null,ctx:null,props:s,update:e,not_equal:c,bound:o(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:o(),dirty:null};let f=!1;l.ctx=a?a(t,u,(e,n,a=n)=>(l.ctx&&c(l.ctx[e],l.ctx[e]=a)&&(l.bound[e]&&l.bound[e](a),f&&function(e,t){e.$$.dirty||(G.push(e),te(),e.$$.dirty=o()),e.$$.dirty[t]=!0}(t,e)),n)):u,l.update(),f=!0,r(l.before_update),l.fragment=i(l.ctx),n.target&&(n.hydrate?l.fragment.l(function(e){return Array.from(e.childNodes)}(n.target)):l.fragment.c(),n.intro&&le(t.$$.fragment),me(t,n.target,n.anchor),oe()),B(d)}class be{$destroy(){$e(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function ye(e,t){return e(t={exports:{}},t.exports),t.exports}var _e=ye((function(e){var t=function(e){var t,n=Object.prototype,a=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(e,t,n,a){var o=t&&t.prototype instanceof g?t:g,r=Object.create(o.prototype),i=new S(a||[]);return r._invoke=function(e,t,n){var a=u;return function(o,r){if(a===f)throw new Error("Generator is already running");if(a===p){if("throw"===o)throw r;return A()}for(n.method=o,n.arg=r;;){var i=n.delegate;if(i){var c=x(i,n);if(c){if(c===h)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===u)throw a=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=f;var s=d(e,t,n);if("normal"===s.type){if(a=n.done?p:l,s.arg===h)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(a=p,n.method="throw",n.arg=s.arg)}}}(e,n,i),r}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var u="suspendedStart",l="suspendedYield",f="executing",p="completed",h={};function g(){}function m(){}function $(){}var v={};v[r]=function(){return this};var b=Object.getPrototypeOf,y=b&&b(b(N([])));y&&y!==n&&a.call(y,r)&&(v=y);var _=$.prototype=g.prototype=Object.create(v);function w(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function k(e){var t;this._invoke=function(n,o){function r(){return new Promise((function(t,r){!function t(n,o,r,i){var c=d(e[n],e,o);if("throw"!==c.type){var s=c.arg,u=s.value;return u&&"object"==typeof u&&a.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,r,i)}),(function(e){t("throw",e,r,i)})):Promise.resolve(u).then((function(e){s.value=e,r(s)}),(function(e){return t("throw",e,r,i)}))}i(c.arg)}(n,o,t,r)}))}return t=t?t.then(r,r):r()}}function x(e,n){var a=e.iterator[n.method];if(a===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,x(e,n),"throw"===n.method))return h;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var o=d(a,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,h;var r=o.arg;return r?r.done?(n[e.resultName]=r.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function N(e){if(e){var n=e[r];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(a.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}return{next:A}}function A(){return{value:t,done:!0}}return m.prototype=_.constructor=$,$.constructor=m,$[c]=m.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,$):(e.__proto__=$,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},w(k.prototype),k.prototype[i]=function(){return this},e.AsyncIterator=k,e.async=function(t,n,a,o){var r=new k(s(t,n,a,o));return e.isGeneratorFunction(n)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},w(_),_[c]="Generator",_[r]=function(){return this},_.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},e.values=N,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(a,o){return c.type="throw",c.arg=e,n.next=a,o&&(n.method="next",n.arg=t),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),d=a.call(i,"finallyLoc");if(s&&d){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&a.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var i=r?r.completion:{};return i.type=e,i.arg=t,r?(this.method="next",this.next=r.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var o=a.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,a){return this.delegate={iterator:N(e),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=t),h}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function we(e,t,n,a,o,r,i){try{var c=e[r](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(a,o)}var ke=function(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var r=e.apply(t,n);function i(e){we(r,a,o,i,c,"next",e)}function c(e){we(r,a,o,i,c,"throw",e)}i(void 0)}))}};var xe=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function Ee(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Oe=function(e,t,n){return t&&Ee(e.prototype,t),n&&Ee(e,n),e},Se=ye((function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(a){return"function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?e.exports=n=function(e){return t(e)}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)},n(a)}e.exports=n}));var Ne=function(e){if(Array.isArray(e))return e};var Ae=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],a=!0,o=!1,r=void 0;try{for(var i,c=e[Symbol.iterator]();!(a=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw r}}return n}};var Ce=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")};var Pe=function(e,t){return Ne(e)||Ae(e,t)||Ce()};var De=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var je=function(e,t){return!t||"object"!==Se(t)&&"function"!=typeof t?De(e):t},Le=ye((function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(n)}e.exports=t})),Re=ye((function(e){function t(n,a){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(n,a)}e.exports=t}));var Te=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Re(e,t)},Me=function(){function e(){xe(this,e),this._on={},this._reactive={},this._syncWithLocalStorage={}}return Oe(e,[{key:"emit",value:function(e,t){var n=this._on[e];if(!n)return this;for(var a=0;a<n.length;a++)n[a][0](t);return this}},{key:"on",value:function(e,t){var n=t?null:new Promise((function(e){t=e})),a=this._on[e]||(this._on[e]=[]),o=[t];a.push(o);var r=function(){var e=a.indexOf(o);-1!=e&&a.splice(e,1)};return n?n.finally(r):r}},{key:"subscribe",value:function(e){return e(this),this.on("update",e)}},{key:"update",value:function(e){for(var t=this,n=Object.keys(e),a=0,o=0;o<n.length;o++){var r=n[o];this._reactive.hasOwnProperty(r)&&this._reactive[r]!==e[r]&&(this._reactive[r]=e[r],a++),this._syncWithLocalStorage[r]&&localStorage.setItem(r,JSON.stringify(this._reactive[r]))}return(!this._updatedTid&&a||0==n.length)&&(this._updatedTid=setTimeout((function(){delete t._updatedTid,t.emit("update",t)}),1)),this}},{key:"_localStorageAttr",value:function(e,t){this._updateableAttr(e,t),this._syncWithLocalStorage[e]=!0,localStorage.hasOwnProperty(e)&&(this._reactive[e]=JSON.parse(localStorage.getItem(e)))}},{key:"_readOnlyAttr",value:function(e,t){if(void 0===t)throw'Read-only attribute "'+e+'" cannot be undefined for '+this.constructor.name;var n="function"==typeof t?{get:t}:{value:t,writable:!1};Object.defineProperty(this,e,n)}},{key:"_updateableAttr",value:function(e,t){var n=this;this._reactive[e]=t,Object.defineProperty(this,e,{get:function(){return n._reactive[e]}})}}]),e}(),Ie=.618033988749;function Ue(e,t){var n;return function(){for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];var i=this;n&&clearTimeout(n),n=setTimeout((function(){e.apply(i,o)}),t)}}function He(e,t){for(;e;){if(t.tagName?e==t:e.matches&&e.matches(t))return e;e=e.parentNode}return null}function ze(e,t,n){var a=e&&e.querySelector(t);return a||((a=document.createElement("div")).className=t,e&&e.appendChild(a),n&&n(a),a)}function Be(e){var t=e.errors;return t&&t[0]?t[0].message||"Unknown error.":""}function Fe(e){var t=document,n=e.replace(/\W/g,"_");if(!t.getElementById(n)){var a=t.createElement("script"),o=[n,e];a.id=o[0],a.src=o[1],t.getElementsByTagName("head")[0].appendChild(a)}}function qe(e,t,n){var a=e.querySelectorAll(t);if(!n)return[].slice.call(a,0);for(var o=[],r=0;r<a.length;r++)o.push(n(a[r],r));return o}function We(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function Ke(e,t){return e.name.localeCompare(t.name)}function Ve(e,t){return e&&e.tagName&&e.tagName.toLowerCase()===t}function Ge(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(0==e.length)return"#000";for(var n=0,a=0;a<e.length;a++)n=e.charCodeAt(a)+((n<<5)-n),n&=n;return"#"+function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,a=Math.floor(6*e),o=6*e-a,r=n*(1-t),i=n*(1-o*t),c=n*(1-(1-o)*t),s=255,d=255,u=255;switch(a){case 0:s=n,d=c,u=r;break;case 1:s=i,d=n,u=r;break;case 2:s=r,d=n,u=c;break;case 3:s=r,d=i,u=n;break;case 4:s=c,d=r,u=n;break;case 5:s=n,d=r,u=i}return[Math.floor(255*s),Math.floor(255*d),Math.floor(255*u)]}(((n=Math.abs(n%t/t))+Ie)%1,.4,.7).map((function(e){return e.toString(16)})).join("")}function Ye(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}var Je=["error","loading","pending","success"],Xe=function(e){function t(e){var n;return xe(this,t),(n=je(this,Le(t).call(this)))._readOnlyAttr("api",e.api),n._readOnlyAttr("defaultParams",e.defaultParams||{}),n._readOnlyAttr("id",e.id),n._readOnlyAttr("req",{body:null,headers:{}}),n._readOnlyAttr("res",{body:{},headers:{}}),n._updateableAttr("err",null),n._updateableAttr("status","pending"),n}return Te(t,e),Oe(t,[{key:"error",value:function(e){if(e)return this.update({err:Array.isArray(e)?e:[{message:e}],status:"error"});if(this.err&&this.err.length){var t=this.err[0],n=t.path&&t.path.match(/\w$/)&&t.path.split("/").pop();return n?n+": "+t.message:t.message}return""}},{key:"perform",value:function(e){var t=this;return this._promise||(this._promise=new Promise(function(){var n=ke(_e.mark((function n(a){var o,r,i,c,s,d;return _e.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.api.spec(t.id);case 2:if(o=n.sent){n.next=5;break}return n.abrupt("return",a(t.error('Invalid operationId "'+t.id+'".')));case 5:return t.update({status:"loading"}),n.next=8,t._paramsToRequest(o,e||t.defaultParams);case 8:return r=n.sent,i=Pe(r,2),c=i[0],s=i[1],t.emit("start",s),"object"==Se(s.body)&&(s.body=JSON.stringify(s.body)),n.next=16,fetch(c,s);case 16:d=n.sent,delete t._promise,d.json().then((function(e){return a(t.parse(d,e))}));case 19:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()))}},{key:"is",value:function(e){if(-1==Je.indexOf(e))throw"Invalid status: "+e;return this.status==e}},{key:"parse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.body;this.res.body=t||e,this.res.status=e.status||"201",this.res.statusText=e.statusText,e.headers&&(this.res.headers=e.headers);var n=null;return String(this.res.status).match(/^[23]/)||(n=t&&t.errors?t.errors:[{message:e.statusText||"Unknown error."}]),this.update({err:n,status:n?"error":"success"})}},{key:"reset",value:function(){return this.res.body={},this.res.headers={},this.res.status=0,this.update({err:null,status:"pending"})}},{key:"_extractValue",value:function(e,t){if(t.schema&&"form"==(e.tagName||"").toLowerCase()){var n={};return Object.keys(t.schema.properties).forEach((function(t){n[t]=e[t]&&e[t].value})),n}if(e[t.name]&&e[t.name].tagName)return e[t.name].value;if(t.schema){var a={};return Object.keys(t.schema.properties).forEach((function(t){a[t]=e[t]})),a}return e[t.name]}},{key:"_hasProperty",value:function(e,t){return"body"==t.in||("form"==(e.tagName||"").toLowerCase()?!!e[t.name]:e.hasOwnProperty(t.name))}},{key:"_paramsToRequest",value:function(e,t){var n=this,a={headers:this.req.headers,method:e.method},o=new URL(e.url);return(e.parameters||[]).forEach((function(e){if(n._hasProperty(t,e)||e.required)if("path"==e.in){var r=new RegExp("(%7B|\\{)"+We(e.name)+"(%7D|\\})","i");o.pathname=o.pathname.replace(r,n._extractValue(t,e))}else if("query"==e.in)o.searchParams.set(e.name,n._extractValue(t,e));else if("body"==e.in)a.body=n._extractValue(t,e);else{if("header"!=e.in)throw"[Api] Parameter in:"+e.in+" is not supported.";a.header[e.name]=n._extractValue(t,e.name)}})),[o,a]}}]),t}(Me),Ze=function(){function e(t){xe(this,e),this.protocol=location.protocol,this.url=t}var t;return Oe(e,[{key:"operation",value:function(e,t){var n=new Xe({api:this,id:e,defaultParams:t});return n.req.headers={"Content-Type":"application/json"},n}},{key:"spec",value:(t=ke(_e.mark((function e(t){var n,a,o=this;return _e.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._op||!t){e.next=2;break}return e.abrupt("return",this._op[t]);case 2:if(!this._spec){e.next=4;break}return e.abrupt("return",this._spec);case 4:return e.next=6,fetch(this.url);case 6:return n=e.sent,e.next=9,n.json();case 9:if(a=e.sent,this._op={},this._spec=a,Object.keys(a.paths).forEach((function(e){Object.keys(a.paths[e]).forEach((function(t){var n=a.paths[e][t],r=n.operationId;r&&(n.method=t.toUpperCase(),n.url=o.protocol+"//"+a.host+a.basePath+e+".json",n.parameters=(n.parameters||[]).map((function(e){if(!e.$ref)return e;for(var t=e.$ref.replace(/^#\//,"").split("/"),n=a;t.length;)n=n[t.shift()];return n})),o._op[r]=n)}))})),!this._op||!t){e.next=15;break}return e.abrupt("return",this._op[t]);case 15:if(!this._spec){e.next=17;break}return e.abrupt("return",this._spec);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Qe=ye((function(e,t){var n,a;n=function(e){var t=[],n=Object.keys,a={},o={},r=/^(no-?highlight|plain|text)$/i,i=/\blang(?:uage)?-([\w-]+)\b/i,c=/((^(<[^>]+>|\t|)+|(?:\n)))/gm,s="</span>",d={classPrefix:"hljs-",tabReplace:null,useBR:!1,languages:void 0};function u(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(e){return e.nodeName.toLowerCase()}function f(e,t){var n=e&&e.exec(t);return n&&0===n.index}function p(e){return r.test(e)}function h(e){var t,n={},a=Array.prototype.slice.call(arguments,1);for(t in e)n[t]=e[t];return a.forEach((function(e){for(t in e)n[t]=e[t]})),n}function g(e){var t=[];return function e(n,a){for(var o=n.firstChild;o;o=o.nextSibling)3===o.nodeType?a+=o.nodeValue.length:1===o.nodeType&&(t.push({event:"start",offset:a,node:o}),a=e(o,a),l(o).match(/br|hr|img|input/)||t.push({event:"stop",offset:a,node:o}));return a}(e,0),t}function m(e){function t(e){return e&&e.source||e}function a(n,a){return new RegExp(t(n),"m"+(e.case_insensitive?"i":"")+(a?"g":""))}!function o(r,i){if(!r.compiled){if(r.compiled=!0,r.keywords=r.keywords||r.beginKeywords,r.keywords){var c={},s=function(t,n){e.case_insensitive&&(n=n.toLowerCase()),n.split(" ").forEach((function(e){var n=e.split("|");c[n[0]]=[t,n[1]?Number(n[1]):1]}))};"string"==typeof r.keywords?s("keyword",r.keywords):n(r.keywords).forEach((function(e){s(e,r.keywords[e])})),r.keywords=c}r.lexemesRe=a(r.lexemes||/\w+/,!0),i&&(r.beginKeywords&&(r.begin="\\b("+r.beginKeywords.split(" ").join("|")+")\\b"),r.begin||(r.begin=/\B|\b/),r.beginRe=a(r.begin),r.endSameAsBegin&&(r.end=r.begin),r.end||r.endsWithParent||(r.end=/\B|\b/),r.end&&(r.endRe=a(r.end)),r.terminator_end=t(r.end)||"",r.endsWithParent&&i.terminator_end&&(r.terminator_end+=(r.end?"|":"")+i.terminator_end)),r.illegal&&(r.illegalRe=a(r.illegal)),null==r.relevance&&(r.relevance=1),r.contains||(r.contains=[]),r.contains=Array.prototype.concat.apply([],r.contains.map((function(e){return function(e){return e.variants&&!e.cached_variants&&(e.cached_variants=e.variants.map((function(t){return h(e,{variants:null},t)}))),e.cached_variants||e.endsWithParent&&[h(e)]||[e]}("self"===e?r:e)}))),r.contains.forEach((function(e){o(e,r)})),r.starts&&o(r.starts,i);var d=r.contains.map((function(e){return e.beginKeywords?"\\.?(?:"+e.begin+")\\.?":e.begin})).concat([r.terminator_end,r.illegal]).map(t).filter(Boolean);r.terminators=d.length?a(function(e,n){for(var a=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./,o=0,r="",i=0;i<e.length;i++){var c=o,s=t(e[i]);for(i>0&&(r+=n);s.length>0;){var d=a.exec(s);if(null==d){r+=s;break}r+=s.substring(0,d.index),s=s.substring(d.index+d[0].length),"\\"==d[0][0]&&d[1]?r+="\\"+String(Number(d[1])+c):(r+=d[0],"("==d[0]&&o++)}}return r}(d,"|"),!0):{exec:function(){return null}}}}(e)}function $(e,t,n,o){function r(e){return new RegExp(e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"m")}function i(e,t){var n=g.case_insensitive?t[0].toLowerCase():t[0];return e.keywords.hasOwnProperty(n)&&e.keywords[n]}function c(e,t,n,a){var o='<span class="'+(a?"":d.classPrefix);return e?(o+=e+'">')+t+(n?"":s):t}function l(){k+=null!=y.subLanguage?function(){var e="string"==typeof y.subLanguage;if(e&&!a[y.subLanguage])return u(x);var t=e?$(y.subLanguage,x,!0,_[y.subLanguage]):v(x,y.subLanguage.length?y.subLanguage:void 0);return y.relevance>0&&(E+=t.relevance),e&&(_[y.subLanguage]=t.top),c(t.language,t.value,!1,!0)}():function(){var e,t,n,a;if(!y.keywords)return u(x);for(a="",t=0,y.lexemesRe.lastIndex=0,n=y.lexemesRe.exec(x);n;)a+=u(x.substring(t,n.index)),(e=i(y,n))?(E+=e[1],a+=c(e[0],u(n[0]))):a+=u(n[0]),t=y.lexemesRe.lastIndex,n=y.lexemesRe.exec(x);return a+u(x.substr(t))}(),x=""}function p(e){k+=e.className?c(e.className,"",!0):"",y=Object.create(e,{parent:{value:y}})}function h(e,t){if(x+=e,null==t)return l(),0;var a=function(e,t){var n,a;for(n=0,a=t.contains.length;n<a;n++)if(f(t.contains[n].beginRe,e))return t.contains[n].endSameAsBegin&&(t.contains[n].endRe=r(t.contains[n].beginRe.exec(e)[0])),t.contains[n]}(t,y);if(a)return a.skip?x+=t:(a.excludeBegin&&(x+=t),l(),a.returnBegin||a.excludeBegin||(x=t)),p(a),a.returnBegin?0:t.length;var o=function e(t,n){if(f(t.endRe,n)){for(;t.endsParent&&t.parent;)t=t.parent;return t}if(t.endsWithParent)return e(t.parent,n)}(y,t);if(o){var i=y;i.skip?x+=t:(i.returnEnd||i.excludeEnd||(x+=t),l(),i.excludeEnd&&(x=t));do{y.className&&(k+=s),y.skip||y.subLanguage||(E+=y.relevance),y=y.parent}while(y!==o.parent);return o.starts&&(o.endSameAsBegin&&(o.starts.endRe=o.endRe),p(o.starts)),i.returnEnd?0:t.length}if(function(e,t){return!n&&f(t.illegalRe,e)}(t,y))throw new Error('Illegal lexeme "'+t+'" for mode "'+(y.className||"<unnamed>")+'"');return x+=t,t.length||1}var g=w(e);if(!g)throw new Error('Unknown language: "'+e+'"');m(g);var b,y=o||g,_={},k="";for(b=y;b!==g;b=b.parent)b.className&&(k=c(b.className,"",!0)+k);var x="",E=0;try{for(var O,S,N=0;y.terminators.lastIndex=N,O=y.terminators.exec(t);)S=h(t.substring(N,O.index),O[0]),N=O.index+S;for(h(t.substr(N)),b=y;b.parent;b=b.parent)b.className&&(k+=s);return{relevance:E,value:k,language:e,top:y}}catch(e){if(e.message&&-1!==e.message.indexOf("Illegal"))return{relevance:0,value:u(t)};throw e}}function v(e,t){t=t||d.languages||n(a);var o={relevance:0,value:u(e)},r=o;return t.filter(w).filter(k).forEach((function(t){var n=$(t,e,!1);n.language=t,n.relevance>r.relevance&&(r=n),n.relevance>o.relevance&&(r=o,o=n)})),r.language&&(o.second_best=r),o}function b(e){return d.tabReplace||d.useBR?e.replace(c,(function(e,t){return d.useBR&&"\n"===e?"<br>":d.tabReplace?t.replace(/\t/g,d.tabReplace):""})):e}function y(e){var n,a,r,c,s,f=function(e){var t,n,a,o,r=e.className+" ";if(r+=e.parentNode?e.parentNode.className:"",n=i.exec(r))return w(n[1])?n[1]:"no-highlight";for(t=0,a=(r=r.split(/\s+/)).length;t<a;t++)if(p(o=r[t])||w(o))return o}(e);p(f)||(d.useBR?(n=document.createElementNS("http://www.w3.org/1999/xhtml","div")).innerHTML=e.innerHTML.replace(/\n/g,"").replace(/<br[ \/]*>/g,"\n"):n=e,s=n.textContent,r=f?$(f,s,!0):v(s),(a=g(n)).length&&((c=document.createElementNS("http://www.w3.org/1999/xhtml","div")).innerHTML=r.value,r.value=function(e,n,a){var o=0,r="",i=[];function c(){return e.length&&n.length?e[0].offset!==n[0].offset?e[0].offset<n[0].offset?e:n:"start"===n[0].event?e:n:e.length?e:n}function s(e){r+="<"+l(e)+t.map.call(e.attributes,(function(e){return" "+e.nodeName+'="'+u(e.value).replace('"',"&quot;")+'"'})).join("")+">"}function d(e){r+="</"+l(e)+">"}function f(e){("start"===e.event?s:d)(e.node)}for(;e.length||n.length;){var p=c();if(r+=u(a.substring(o,p[0].offset)),o=p[0].offset,p===e){i.reverse().forEach(d);do{f(p.splice(0,1)[0]),p=c()}while(p===e&&p.length&&p[0].offset===o);i.reverse().forEach(s)}else"start"===p[0].event?i.push(p[0].node):i.pop(),f(p.splice(0,1)[0])}return r+u(a.substr(o))}(a,g(c),s)),r.value=b(r.value),e.innerHTML=r.value,e.className=function(e,t,n){var a=t?o[t]:n,r=[e.trim()];return e.match(/\bhljs\b/)||r.push("hljs"),-1===e.indexOf(a)&&r.push(a),r.join(" ").trim()}(e.className,f,r.language),e.result={language:r.language,re:r.relevance},r.second_best&&(e.second_best={language:r.second_best.language,re:r.second_best.relevance}))}function _(){if(!_.called){_.called=!0;var e=document.querySelectorAll("pre code");t.forEach.call(e,y)}}function w(e){return e=(e||"").toLowerCase(),a[e]||a[o[e]]}function k(e){var t=w(e);return t&&!t.disableAutodetect}return e.highlight=$,e.highlightAuto=v,e.fixMarkup=b,e.highlightBlock=y,e.configure=function(e){d=h(d,e)},e.initHighlighting=_,e.initHighlightingOnLoad=function(){addEventListener("DOMContentLoaded",_,!1),addEventListener("load",_,!1)},e.registerLanguage=function(t,n){var r=a[t]=n(e);r.aliases&&r.aliases.forEach((function(e){o[e]=t}))},e.listLanguages=function(){return n(a)},e.getLanguage=w,e.autoDetection=k,e.inherit=h,e.IDENT_RE="[a-zA-Z]\\w*",e.UNDERSCORE_IDENT_RE="[a-zA-Z_]\\w*",e.NUMBER_RE="\\b\\d+(\\.\\d+)?",e.C_NUMBER_RE="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",e.BINARY_NUMBER_RE="\\b(0b[01]+)",e.RE_STARTERS_RE="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",e.BACKSLASH_ESCAPE={begin:"\\\\[\\s\\S]",relevance:0},e.APOS_STRING_MODE={className:"string",begin:"'",end:"'",illegal:"\\n",contains:[e.BACKSLASH_ESCAPE]},e.QUOTE_STRING_MODE={className:"string",begin:'"',end:'"',illegal:"\\n",contains:[e.BACKSLASH_ESCAPE]},e.PHRASAL_WORDS_MODE={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},e.COMMENT=function(t,n,a){var o=e.inherit({className:"comment",begin:t,end:n,contains:[]},a||{});return o.contains.push(e.PHRASAL_WORDS_MODE),o.contains.push({className:"doctag",begin:"(?:TODO|FIXME|NOTE|BUG|XXX):",relevance:0}),o},e.C_LINE_COMMENT_MODE=e.COMMENT("//","$"),e.C_BLOCK_COMMENT_MODE=e.COMMENT("/\\*","\\*/"),e.HASH_COMMENT_MODE=e.COMMENT("#","$"),e.NUMBER_MODE={className:"number",begin:e.NUMBER_RE,relevance:0},e.C_NUMBER_MODE={className:"number",begin:e.C_NUMBER_RE,relevance:0},e.BINARY_NUMBER_MODE={className:"number",begin:e.BINARY_NUMBER_RE,relevance:0},e.CSS_NUMBER_MODE={className:"number",begin:e.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},e.REGEXP_MODE={className:"regexp",begin:/\//,end:/\/[gimuy]*/,illegal:/\n/,contains:[e.BACKSLASH_ESCAPE,{begin:/\[/,end:/\]/,relevance:0,contains:[e.BACKSLASH_ESCAPE]}]},e.TITLE_MODE={className:"title",begin:e.IDENT_RE,relevance:0},e.UNDERSCORE_TITLE_MODE={className:"title",begin:e.UNDERSCORE_IDENT_RE,relevance:0},e.METHOD_GUARD={begin:"\\.\\s*"+e.UNDERSCORE_IDENT_RE,relevance:0},e},a="object"==typeof window&&window||"object"==typeof self&&self,t.nodeType?a&&(a.hljs=n({})):n(t)})),et=function(){function e(t){xe(this,e),this.api=t.api,this.embeds={},this.disableAll=t.disableAll||!1,this.disableInstagram=t.disableInstagram||!1,this.disableTwitter=t.disableTwitter||!1}var t;return Oe(e,[{key:"render",value:(t=ke(_e.mark((function e(t,n){var a,o=this;return _e.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.disableAll){e.next=2;break}return e.abrupt("return");case 2:a={},qe(n,".message__embed",(function(e){a[e.dataset.url]=e})),t.forEach((function(e){o.embeds[e]||o._loadAndRender(e),a[e]||n.appendChild(o._ensureEmbedEl(e)),delete a[e]})),Object.keys(a).forEach((function(e){return a[e].remove()}));case 6:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"renderInstagram",value:function(e){if(!this.disableInstagram)return window.instgrm?window.instgrm.Embeds.process():void Fe("//platform.instagram.com/en_US/embeds.js")}},{key:"renderPasteEl",value:function(e){Qe.highlightBlock(e.querySelector("pre")),qe(e,".le-meta",(function(e){e.addEventListener("click",(function(){return e.parentNode.classList.toggle("is-expanded")}))}))}},{key:"renderPhoto",value:function(e){var t=this;qe(e,"img",(function(e){return e.addEventListener("click",(function(){return t.showMedia(e)}))}))}},{key:"renderTwitter",value:function(e){this.disableTwitter||(window.twttr&&window.twttr.widgets.load(),Fe("//platform.twitter.com/widgets.js"))}},{key:"showMedia",value:function(e){var t=ze(document.querySelector("body"),"fullscreen-media-wrapper",(function(e){e.addEventListener("click",(function(t){t.target==e&&e.setAttribute("hidden","")})),e.setAttribute("hidden","")}));!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(t),t.appendChild(e.cloneNode()),t.removeAttribute("hidden")}},{key:"_ensureEmbedEl",value:function(e){return this.embeds[e].el||(this.embeds[e].el=ze(null,"message__embed",(function(t){t.dataset.url=e})))}},{key:"_loadAndRender",value:function(e){var t=this;return this.embeds[e]={},this.api.operation("embed",{url:e}).perform().then((function(n){var a=t._ensureEmbedEl(e),o=n.res.body;a.innerHTML=o.html,qe(a,"a",(function(e){e.target="_blank"}));var r=(o.provider_name||"").toLowerCase();return"instagram"==r?t.renderInstagram(a):"twitter"==r?t.renderTwitter(a):-1!=(a.firstChild.className||"").split(/\s+/).indexOf("le-paste")?t.renderPasteEl(a):void qe(a,".le-photo, .le-thumbnail",(function(e){return t.renderPhoto(a)}))}))}}]),e}();var tt=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};var nt=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Le(e)););return e},at=ye((function(e){function t(n,a,o){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=t=Reflect.get:e.exports=t=function(e,t,n){var a=nt(e,t);if(a){var o=Object.getOwnPropertyDescriptor(a,t);return o.get?o.get.call(n):o.value}},t(n,a,o||n)}e.exports=t}));var ot=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},rt=ye((function(e){function t(n,a,o){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?e.exports=t=function(e,t,n){var a=[null];a.push.apply(a,t);var o=new(Function.bind.apply(e,a));return n&&Re(o,n.prototype),o}:e.exports=t=Reflect.construct,t.apply(null,arguments)}e.exports=t})),it=ye((function(e){function t(n){var a="function"==typeof Map?new Map:void 0;return e.exports=t=function(e){if(null===e||!ot(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==a){if(a.has(e))return a.get(e);a.set(e,t)}function t(){return rt(e,arguments,Le(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Re(t,e)},t(n)}e.exports=t})),ct=function(e){function t(e){var n;xe(this,t);var a=e.match(/^\w+:/)[0];return(n=je(this,Le(t).call(this,e.replace(/^\w+:/,"http:")))).connProtocol=a,n}return Te(t,e),Oe(t,[{key:"fromForm",value:function(e){var t=e.server.value;return e.nick.value.length&&this.searchParams.append("nick",e.nick.value),this.searchParams.append("tls",e.tls.checked?"1":"0"),this.searchParams.append("tls_verify",e.tls_verify&&e.tls_verify.checked?"1":"0"),this.host=t.match(/:\d+$/)?t:t+":6667",this.password=e.password.value,this.username=e.username.value,this}},{key:"toString",value:function(){return this.href.replace(/^http:/,this.connProtocol)}}]),t}(it(URL));var st=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}};var dt=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)};var ut=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var lt=function(e){return st(e)||dt(e)||ut()},ft=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return xe(this,t),(e=je(this,Le(t).call(this,n))).sorter=a.sorter||Ke,e._sort(),e}return Te(t,e),Oe(t,[{key:"filter",value:function(e){return Array.from(this.values()).filter(e)}},{key:"set",value:function(e,n){at(Le(t.prototype),"set",this).call(this,e,n),this._sort()}},{key:"toArray",value:function(){return Array.from(this.values())}},{key:"_sort",value:function(){var e=this,n=Array.from(this.entries()),a=this.sorter;return this.clear(),n.sort((function(e,t){return a(e[1],t[1])})).forEach((function(n){var a=Pe(n,2),o=a[0],r=a[1];return at(Le(t.prototype),"set",e).call(e,o,r)})),n}}]),t}(it(Map)),pt={0:"Jan",1:"Feb",2:"March",3:"Apr",4:"May",5:"Jun",6:"July",7:"Aug",8:"Sept",9:"Oct",10:"Nov",11:"Dec"},ht=function(e){function t(e){return xe(this,t),"string"!=typeof e||e.match(/Z$/)||(e+="Z"),je(this,Le(t).call(this,e||new Date))}return Te(t,e),Oe(t,[{key:"getHumanDate",value:function(){return this.getDate()+". "+this.getMonthAbbr()}},{key:"getHM",value:function(){return[this.getHours(),this.getMinutes()].map((function(e){return e<10?"0"+e:e})).join(":")}},{key:"getMonthAbbr",value:function(){return pt[this.getMonth()]||""}},{key:"toEpoch",value:function(){return this.getTime()/1e3}},{key:"toHuman",value:function(){var e=new t,n=this.toEpoch();return n>e.toEpoch()+86400-e.toEpoch()%86400+86400?this.getDate()+". "+this.getMonthAbbr()+" "+this.getHM():n>e.toEpoch()-e.toEpoch()%86400?this.getHM():this.getYear()==e.getYear()?this.getDate()+". "+this.getMonthAbbr()+" "+this.getHM():this.getDate()+". "+this.getMonthAbbr()+" "+this.getFullYear()}}]),t}(it(Date)),gt=function(){var e={base:"https://twemoji.maxcdn.com/v/12.1.3/",ext:".png",size:"72x72",className:"emoji",convert:{fromCodePoint:function(e){var t="string"==typeof e?parseInt(e,16):e;if(t<65536)return c(t);return c(55296+((t-=65536)>>10),56320+(1023&t))},toCodePoint:m},onerror:function(){this.parentNode&&this.parentNode.replaceChild(s(this.alt,!1),this)},parse:function(t,n){n&&"function"!=typeof n||(n={callback:n});return("string"==typeof t?f:l)(t,{callback:n.callback||d,attributes:"function"==typeof n.attributes?n.attributes:h,base:"string"==typeof n.base?n.base:e.base,ext:n.ext||e.ext,size:n.folder||(a=n.size||e.size,"number"==typeof a?a+"x"+a:a),className:n.className||e.className,onerror:n.onerror||e.onerror});var a},replace:g,test:function(e){n.lastIndex=0;var t=n.test(e);return n.lastIndex=0,t}},t={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},n=/(?:\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c\udffb|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c\udffb|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c\udffb|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb\udffc]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffd]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69])(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[©®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,a=/\uFE0F/g,o=String.fromCharCode(8205),r=/[&<>'"]/g,i=/^(?:iframe|noframes|noscript|script|select|style|textarea)$/,c=String.fromCharCode;return e;function s(e,t){return document.createTextNode(t?e.replace(a,""):e)}function d(e,t){return"".concat(t.base,t.size,"/",e,t.ext)}function u(e){return m(e.indexOf(o)<0?e.replace(a,""):e)}function l(e,t){for(var a,o,r,c,d,l,f,p,h,g,m,$,v,b=function e(t,n){for(var a,o,r=t.childNodes,c=r.length;c--;)3===(o=(a=r[c]).nodeType)?n.push(a):1!==o||"ownerSVGElement"in a||i.test(a.nodeName.toLowerCase())||e(a,n);return n}(e,[]),y=b.length;y--;){for(r=!1,c=document.createDocumentFragment(),l=(d=b[y]).nodeValue,p=0;f=n.exec(l);){if((h=f.index)!==p&&c.appendChild(s(l.slice(p,h),!0)),$=u(m=f[0]),p=h+m.length,v=t.callback($,t),$&&v){for(o in(g=new Image).onerror=t.onerror,g.setAttribute("draggable","false"),a=t.attributes(m,$))a.hasOwnProperty(o)&&0!==o.indexOf("on")&&!g.hasAttribute(o)&&g.setAttribute(o,a[o]);g.className=t.className,g.alt=m,g.src=v,r=!0,c.appendChild(g)}g||c.appendChild(s(m,!1)),g=null}r&&(p<l.length&&c.appendChild(s(l.slice(p),!0)),d.parentNode.replaceChild(c,d))}return e}function f(e,t){return g(e,(function(e){var n,a,o=e,i=u(e),c=t.callback(i,t);if(i&&c){for(a in o="<img ".concat('class="',t.className,'" ','draggable="false" ','alt="',e,'"',' src="',c,'"'),n=t.attributes(e,i))n.hasOwnProperty(a)&&0!==a.indexOf("on")&&-1===o.indexOf(" "+a+"=")&&(o=o.concat(" ",a,'="',n[a].replace(r,p),'"'));o=o.concat("/>")}return o}))}function p(e){return t[e]}function h(){return null}function g(e,t){return String(e).replace(n,t)}function m(e,t){for(var n=[],a=0,o=0,r=0;r<e.length;)a=e.charCodeAt(r++),o?(n.push((65536+(o-55296<<10)+(a-56320)).toString(16)),o=0):55296<=a&&a<=56319?o=a:n.push(a.toString(16));return n.join(t||"-")}}(),mt=new RegExp("(\\\\?)`([^`]+)`","g"),$t={},vt={},bt=new RegExp("https?://\\S+","g"),yt=new RegExp("(^|\\s)(\\\\?)(\\*+|_+)(\\w[^<]*?)\\3","g"),_t={":confused:":":/",":disappointed:":":(",":grin:":";D",":heart:":"&lt;3",":slight_smile:":":)",":smiley:":":D",":stuck_out_tongue:":":P",":wink:":";)"},wt=new RegExp("(^|\\s)(:\\w+:|:[()/DP]|;[)D]|&lt;3)(?=\\W|$)","gi"),kt={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&apos;",'"':"&quot;"};function xt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"emoji";return window.__emojiList&&(window.__emojiList.forEach((function(e){if(":"==(e.shortname||"")[0]){if(_t[e.shortname]&&(vt[_t[e.shortname]]=e),vt[e.shortname]=e,e.category){var t=":"+e.category;$t[t]||($t[t]=[]),$t[t].push(e)}e.shortname.match(/(_|:)\w/g).forEach((function(t){$t[t]||($t[t]=[]),$t[t].push(e)})),delete e.category,delete e.html,delete e.order,delete e.unicode}})),delete window.__emojiList),"group"==t?$t[e]||[]:(vt[e]||{})[t]}function Et(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!1!==t.escape&&(e=function(e){return e.replace(/[&<>"']/g,(function(e){return kt[e]}))}(e)),e=(e=e.replace(/^&gt;\s(.*)/,(function(e,t){return"<blockquote>"+t+"</blockquote>"})).replace(yt,(function(e,t,n,a,o){if(a.match(/^_/)&&o.match(/^[A-Z]+$/))return e;var r=a.length;return 1==r?n?e.replace(/^\\/,""):t+"<em>"+o+"</em>":2==r?n?e.replace(/^\\/,""):t+"<strong>"+o+"</strong>":3==r?n?e.replace(/^\\/,""):t+"<em><strong>"+o+"</strong></em>":e}))).replace(mt,(function(e,t,n){return t?e.replace(/^\\/,""):"<code>"+n+"</code>"})),!1!==t.links&&(e=e.replace(bt,(function(e){var t=e.match(/^(.*?)([.!?])?$/);return'<a href="'+t[1]+'" target="_blank">'+t[1].replace(/^https:\/\//,"")+"</a>"+(t[2]||"")}))),!1!==t.emoji&&(e=gt.parse(e.replace(wt,(function(e,t,n){return t+(xt(n)||n)})))),e}var Ot={en:{}},St="en";function Nt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return String(Ot[e]&&Ot[e][St]||e).replace(/%(\d+)/g,(function(e,t){return n[t-1]}))}function At(e,t){return Et(Nt(e))}function Ct(e,t){return e.frozen?Nt(e.frozen):e==t?"Connection messages.":(t.frozen?Nt(t.frozen):t.topic)||t.is_private&&Nt("Private conversation.")||Nt("No topic is set.")}function Pt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pt(n,!0).forEach((function(t){tt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var jt=new RegExp("^[#&]"),Lt={o:"@",v:"+"},Rt={o:10,v:9},Tt=function(e,t){return(Rt[t.mode]||0)-(Rt[e.mode]||0)||e.name.localeCompare(t.name)},Mt=function(e){function t(e){var n;xe(this,t),n=je(this,Le(t).call(this));var a=[];return e.connection_id&&a.push(e.connection_id),e.dialog_id&&a.push(e.dialog_id),n._readOnlyAttr("api",e.api),n._readOnlyAttr("connection_id",e.connection_id||""),n._readOnlyAttr("events",e.events),n._readOnlyAttr("is_private",(function(){return!jt.test(n.name)})),n._readOnlyAttr("participants",new ft([],{sorter:Tt})),n._readOnlyAttr("path",a.map((function(e){return encodeURIComponent(e)})).join("/")),n._updateableAttr("last_active",new ht(e.last_active)),n._updateableAttr("last_read",new ht(e.last_read)),n._updateableAttr("messages",[]),n._updateableAttr("mode",""),n._updateableAttr("name",e.name||"Unknown"),n._updateableAttr("status","loading"),n._updateableAttr("topic",e.topic||""),n._updateableAttr("unread",e.unread||0),e.hasOwnProperty("dialog_id")?(n._readOnlyAttr("dialog_id",e.dialog_id),n._updateableAttr("frozen",e.frozen||"")):n._readOnlyAttr("frozen",(function(){return n._calculateFrozen()})),n.events.on("update",n._loadParticipants.bind(De(n))),n._addOperations(),n}var n,a,o;return Te(t,e),Oe(t,[{key:"addMessage",value:function(e){return this.update({unread:this.unread+1}),this.addMessages("push",[e])}},{key:"addMessages",value:function(e,t){var n=0,a=t.length;switch(e){case"push":n=this.messages.length,a=(t=this.messages.concat(t)).length;break;case"unshift":t=t.concat(this.messages)}for(var o=n;o<a;o++){var r=t[o];r.hasOwnProperty("markdown")||(r.from||(r.from=this.connection_id||"Convos"),r.vars&&(r.message=Nt.apply(void 0,[r.message].concat(lt(r.vars)))),r.highlight&&this.events.notifyUser(r.from,r.message),r.color=Ge(r.from.toLowerCase()),r.ts=new ht(r.ts),r.dayChanged=0!=o&&r.ts.getDate()!=t[o-1].ts.getDate(),r.embeds=(r.message.match(/https?:\/\/(\S+)/g)||[]).map((function(e){return e.replace(/([.!?])?$/,"")})),r.isSameSender=0!=o&&t[o].from==t[o-1].from,r.markdown=Et(r.message))}return this.update({messages:t,status:"loaded"}),this}},{key:"findParticipants",value:function(e){if(!e)return this.participants.toArray();var t=Object.keys(e),n=[];return this.participants.forEach((function(a){for(var o=0;o<t.length;o++){var r=e[t[o]];if(e[r]!=a[r])return}n.push(a)})),n}},{key:"is",value:function(e){return"frozen"==e?this.frozen&&!0:"private"==e?this.is_private:"unread"==e?this.unread&&!0:this.status==e}},{key:"load",value:(o=ke(_e.mark((function e(){return _e.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.is_private&&this.dialog_id&&this.send("/ison","_noop"),this.messagesOp&&!this.messagesOp.is("success")){e.next=3;break}return e.abrupt("return",this);case 3:return this.update({status:"loading"}),e.next=6,this.messagesOp.perform(this);case 6:return this._loadParticipants(),e.abrupt("return",this.addMessages("set",this.messagesOp.res.body.messages||[]));case 8:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"loadHistoric",value:(a=ke(_e.mark((function e(){var t,n;return _e.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.messages[0])&&!t.end){e.next=3;break}return e.abrupt("return");case 3:return this.update({status:"loading"}),e.next=6,this.messagesOp.perform({before:t.ts.toISOString(),connection_id:this.connection_id,dialog_id:this.dialog_id});case 6:return!(n=this.messagesOp.res.body.messages||[]).length&&this.messages.length&&(t.endOfHistory=!0),e.abrupt("return",this.addMessages("unshift",n));case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"participant",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._participantId(e);t.nick=e;var a=this.participants.get(n);return a?Object.keys(t).forEach((function(e){a[e]=t[e]})):(a=Dt({mode:""},t,{color:Ge(n),id:n,name:e,ts:new ht}),this.participants.set(n,a)),this.update({}),a}},{key:"send",value:function(e,t){this.events.send({connection_id:this.connection_id,dialog_id:this.dialog_id||"",message:e},t?this[t].bind(this):null)}},{key:"setLastRead",value:(n=ke(_e.mark((function e(){return _e.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setLastReadOp){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.setLastReadOp.perform({connection_id:this.connection_id,dialog_id:this.dialog_id});case 4:this.update(Dt({unread:0},this.setLastReadOp.res.body));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"wsEventMode",value:function(e){if(!e.nick)return this.update({mode:e.mode});this.participant(e.nick,{mode:e.mode}),this.addMessage({message:"%1 got mode %2 from %3.",vars:[e.nick,e.mode,e.from]})}},{key:"wsEventNickChange",value:function(e){var t=this._participantId(e.old_nick);this.participants.has(t)&&e.old_nick!=e.new_nick&&(this.participants.delete(t),this.participant(e.new_nick,e),this.addMessage({message:"%1 changed nick to %2.",vars:[e.old_nick,e.new_nick]}))}},{key:"wsEventPart",value:function(e){var t=this._participantId(e.nick),n=this.participants.find((function(e){return e.id==t}))||{};this.addMessage(this._partMessage(e)),n.me||(this.participants.delete(t),this.update({}))}},{key:"wsEventSentNames",value:function(e){this._updateParticipants(e);var t={message:"Participants (%1): %2",vars:[]},n=this.participants.map((function(e){return(Lt[e.mode]||"")+e.name}));n.length>1&&(t.message+=" and %3.",t.vars[2]=n.pop()),t.vars[0]=n.length,t.vars[1]=n.join(", "),this.addMessage(t)}},{key:"_addOperations",value:function(){this._readOnlyAttr("setLastReadOp",this.api.operation("setDialogLastRead")),this._readOnlyAttr("messagesOp",this.api.operation("dialogMessages"))}},{key:"_calculateFrozen",value:function(){return""}},{key:"_loadParticipants",value:function(){this.messagesOp&&this.messagesOp.is("success")&&this.events.ready&&!this._participantsLoaded&&(!this.dialog_id||this.is("private")||this.is("frozen")||this.send("/names","_updateParticipants"),this._participantsLoaded=!0)}},{key:"_noop",value:function(){}},{key:"_participantId",value:function(e){return e.toLowerCase()}},{key:"_partMessage",value:function(e){var t={message:"%1 parted.",vars:[e.nick]};return e.kicker?(t.message="%1 was kicked by %2"+(e.message?": %3":""),t.vars.push(e.kicked),t.vars.push(e.message)):e.message&&(t.message+=" Reason: %2",t.vars.push(e.message)),t}},{key:"_updateParticipants",value:function(e){var t=this;this.participants.clear(),e.participants.forEach((function(e){return t.participant(e.nick||e.name,{mode:e.mode})})),e.stopPropagation()}}]),t}(Me);function It(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Ut=function(e){function t(e){var n;return xe(this,t),(n=je(this,Le(t).call(this,e)))._readOnlyAttr("dialogs",new ft),n._updateableAttr("on_connect_commands",e.on_connect_commands||""),n._updateableAttr("state",e.state||"queued"),n._updateableAttr("wanted_state",e.wanted_state||"connected"),n._updateableAttr("url","string"==typeof e.url?new ct(e.url):e.url),n._updateableAttr("nick",e.nick||n.url.searchParams.get("nick")||""),n}return Te(t,e),Oe(t,[{key:"addDialog",value:function(e){var t=e.match(/^[a-z]/i);this.send(t?"/query ".concat(e):"/join ".concat(e))}},{key:"ensureDialog",value:function(e){var t=this,n=this.dialogs.get(e.dialog_id);return n?n.update(e):((n=new Mt(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?It(n,!0).forEach((function(t){tt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):It(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{connection_id:this.connection_id,api:this.api,events:this.events}))).on("message",(function(e){return t.emit("message",e)})),n.on("update",(function(){return t.update({})})),this._addDefaultParticipants(n),this.dialogs.set(n.dialog_id,n),this.update({}),n)}},{key:"findDialog",value:function(e){return this.dialogs.get(e.dialog_id)}},{key:"is",value:function(e){return this.state==e}},{key:"removeDialog",value:function(e){return this.dialogs.delete(e.dialog_id),this.update({})}},{key:"update",value:function(e){return e.nick&&e.nick!=this.nick&&this.wsEventNickChange({new_nick:e.nick,old_nick:this.nick}),e.url&&"string"==typeof e.url&&(e.url=new ct(e.url)),at(Le(t.prototype),"update",this).call(this,e)}},{key:"wsEventConnection",value:function(e){this.update({state:e.state}),this.addMessage(e.message?{message:"Connection state changed to %1: %2",vars:[e.state,e.message]}:{message:"Connection state changed to %1.",vars:[e.state]})}},{key:"wsEventFrozen",value:function(e){var t=this.findDialog(e);this.ensureDialog(e).participant(this.nick,{me:!0}),e.frozen&&(t||this).addMessage({message:e.frozen,vars:[]})}},{key:"wsEventMessage",value:function(e){return e.dialog_id?this.ensureDialog(e).addMessage(e):this.addMessage(e)}},{key:"wsEventNickChange",value:function(e){this.dialogs.forEach((function(t){return t.wsEventNickChange(e)}))}},{key:"wsEventError",value:function(e){this.addMessage({message:Be(e)||"Unknown error from %1.",vars:e.command||e.message})}},{key:"wsEventPart",value:function(e){e.nick==this.nick&&this.removeDialog(e)}},{key:"wsEventQuit",value:function(e){this.wsEventPart(e)}},{key:"wsEventSentJoin",value:function(e){var t=this.findDialog(e);t.addMessage({message:"%1 joined.",vars:[e.nick]}),t.participant(this.nick,{})}},{key:"wsEventSentList",value:function(e){var t=e.args||"/*/";this.addMessage(e.done?{message:"Found %1 of %2 dialogs from %3.",vars:[e.dialogs.length,e.n_dialogs,t]}:{message:"Found %1 of %2 dialogs from %3, but dialogs are still loading.",vars:[e.dialogs.length,e.n_dialogs,t]})}},{key:"wsEventSentQuery",value:function(e){this.ensureDialog(e)}},{key:"wsEventSentWhois",value:function(e){var t=Object.keys(e.channels),n="%1 (%2)",a=[e.nick,e.host];e.idle_for&&t.length?(n+=" has been idle for %3 in %4.",a.push(e.idle_for),a.push(t.join(", "))):e.idle_for&&!t.length?(n+="has been idle for %3, and is not active in any channels.",a.push(e.idle_for)):(n+="is active in %3.",a.push(t.join(", "))),this.addMessage({message:n,vars:a})}},{key:"wsEventTopic",value:function(e){this.ensureDialog(e).addMessage(e.topic?{message:"Topic changed to: %1",vars:[e.topic]}:{message:"No topic is set.",vars:[]})}},{key:"_addDefaultParticipants",value:function(e){e.participant(this.nick),e.is_private&&e.participant(e.name)}},{key:"_addOperations",value:function(){this._readOnlyAttr("setLastReadOp",this.api.operation("setConnectionLastRead")),this._readOnlyAttr("messagesOp",this.api.operation("connectionMessages"))}},{key:"_calculateFrozen",value:function(){switch(this.state){case"connected":return"";case"disconnected":return"Disconnected.";case"unreachable":return"Unreachable.";default:return"Connecting..."}}}]),t}(Mt);function Ht(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function zt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ht(n,!0).forEach((function(t){tt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ht(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Bt=0,Ft=function(e){function t(){var e;return xe(this,t),(e=je(this,Le(t).call(this))).notificationIcon="",e.queue=[],e.waiting={},e._localStorageAttr("notificationCloseDelay",5e3),e._localStorageAttr("debugEvents",-1!=navigator.userAgent.indexOf("Mozilla")?1:0),e._localStorageAttr("wantNotifications",!1),e._readOnlyAttr("wsUrl",Convos.wsUrl),e._updateableAttr("ready",!1),e}return Te(t,e),Oe(t,[{key:"dispatch",value:function(e){var t=("wsEvent_"+this._getEventNameFromParam(e)).replace(/_(\w)/g,(function(e,t){return t.toUpperCase()}));this.debugEvents&&this._debug(t,e),e.bubbles=!0,e.stopPropagation=function(){e.bubbles=!1};var n=this.waiting[e.id];n&&n(e),e.bubbles&&this.emit("message",zt({},e,{dispatchTo:t}))}},{key:"notifyUser",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=this._notificationRejectReason();if(a)this.debugEvents&&console.log("[Events:notifyUser] "+a,e,t,n);else{var o=new Notification(e,zt({icon:this.notificationIcon},n,{body:t}));o.onclick=function(e){o.cancel(),window.focus()},setTimeout((function(){return o.close()}),this.notificationCloseDelay)}}},{key:"send",value:function(e,t){e.id||"ping"==e.method||(e.id=++Bt),!e.method&&e.message&&(e.method="send"),e.dialog&&["connection_id","dialog_id"].forEach((function(t){e[t]=e.dialog[t]||""})),delete e.dialog,this.debugEvents&&this._debug("send",e),t&&(this.waiting[e.id]=t),this.queue.push(e),this._dequeue()}},{key:"update",value:function(e){return at(Le(t.prototype),"update",this).call(this,e),e.wantNotifications&&this.notifyUser("Convos","You have enabled notifications!"),this}},{key:"_debug",value:function(e,t){1==this.debugEvents&&"wsEventPong"!=e&&"ping"!=t.method?console.log("[Events:"+(e||"data")+"]",t):this.debugEvents>=2&&console.log("[Events:"+(e||"data")+"]",t)}},{key:"_getEventNameFromParam",value:function(e){if(e.errors)return"error";if("state"==e.event)return e.type;if("sent"==e.event&&e.message.match(/\/\S+/)){var t=e.message.split(" ",2),n=Pe(t,2),a=n[0],o=n[1];return e.args=o,e.command=a.substring(1),"sent_"+e.command}return e.event}},{key:"_notificationRejectReason",value:function(){return this.wantNotifications?window.Notification?"granted"!=Notification.permission?Notification.permission:document.hasFocus()?"document.hasFocus":"":"window.Notification":"wantNotifications == false"}},{key:"_dequeue",value:function(){var e=this;this.queue=this.queue.filter((function(t){return!e._send(t)})),0==this.queue.length||this.ws||(this._keepaliveTid||(this._keepaliveTid=setInterval((function(){return e._send({method:"ping"})}),1e4)),this._wsReconnectTid&&clearTimeout(this._wsReconnectTid),delete this._wsReconnectTid,this.ws=new WebSocket(this.wsUrl),this.ws.onopen=function(){e.update({ready:!0}),e._dequeue()},this.ws.onclose=this._reconnect.bind(this),this.ws.onerror=this._reconnect.bind(this),this.ws.onmessage=function(t){return e.dispatch(JSON.parse(t.data))})}},{key:"_reconnect",value:function(e){var t=this;this._wsReconnectTid||(this._wsReconnectTid=setTimeout((function(){return t._dequeue()}),5e3)),this.update({ready:!1}),this.ws=null}},{key:"_send",value:function(e){var t=this.ws&&1==this.ws.readyState&&this.ws;return t&&t.send(JSON.stringify(e)),!!t}}]),t}(Me);function qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Wt=function(e){function t(e){var n;return xe(this,t),(n=je(this,Le(t).call(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qt(n,!0).forEach((function(t){tt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{connection_id:"",dialog_id:"notifications",is_private:!0,name:"Notifications"}))))._readOnlyAttr("messagesOp",e.messagesOp),n}var n,a;return Te(t,e),Oe(t,[{key:"load",value:(a=ke(_e.mark((function e(){return _e.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"loadHistoric",value:(n=ke(_e.mark((function e(){return _e.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"_addOperations",value:function(){this._readOnlyAttr("setLastReadOp",this.api.operation("readNotifications"))}}]),t}(Mt);function Kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Vt=function(e){function t(e){var n;xe(this,t),n=je(this,Le(t).call(this));var a=e.api;return n._readOnlyAttr("api",(function(){return a})),n._readOnlyAttr("connections",new ft),n._readOnlyAttr("email",(function(){return n.getUserOp.res.body.email||""})),n._readOnlyAttr("events",n._createEvents()),n._updateableAttr("expandUrlToMedia",!0),n._updateableAttr("icon","user-circle"),n._readOnlyAttr("getUserOp",a.operation("getUser",{connections:!0,dialogs:!0,notifications:!0})),n._readOnlyAttr("notifications",new Wt({api:a,events:n.events,messagesOp:n.getUserOp})),n}var n;return Te(t,e),Oe(t,[{key:"ensureDialog",value:function(e){var t=this;if(e.dialog_id)return this.ensureDialog({connection_id:e.connection_id}).ensureDialog(e);var n=this.findDialog(e);return n?n.update(e):((n=new Ut(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kt(n,!0).forEach((function(t){tt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{api:this.api,events:this.events}))).on("update",(function(){return t.update({})})),this.connections.set(n.connection_id,n),this.update({}),n)}},{key:"findDialog",value:function(e){var t=this.connections.get(e.connection_id);return e.dialog_id?t&&t.findDialog(e):t}},{key:"is",value:function(e){return this.getUserOp.is(e)}},{key:"isDialogOperator",value:function(e){var t=this.findDialog({connection_id:e.connection_id}),n=this.findDialog(e);if(!t||!n)return!1;var a=n.findParticipants({nick:t.nick})[0];return a&&a.mode&&-1!=a.mode.indexOf("o")}},{key:"load",value:(n=ke(_e.mark((function e(){return _e.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.getUserOp.is("success")){e.next=2;break}return e.abrupt("return",this);case 2:return e.next=4,this.getUserOp.perform();case 4:return this._parseGetUser(this.getUserOp.res.body),this.email&&this.send({method:"ping"}),e.abrupt("return",this);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"removeDialog",value:function(e){if(e.dialog_id){var t=this.findDialog({connection_id:e.connection_id});t&&t.removeDialog(e)}else this.connections.delete(e.connection_id),this.update({})}},{key:"send",value:function(e,t){return this.events.send(e,t)}},{key:"wsEventMe",value:function(e){this.ensureDialog({connection_id:e.connection_id}).update(e)}},{key:"wsEventPart",value:function(e){this.emit("dialogEvent",e)}},{key:"wsEventPong",value:function(e){this.wsPongTimestamp=e.ts}},{key:"wsEventSentJoin",value:function(e){this.emit("dialogEvent",e)}},{key:"_createEvents",value:function(){var e=this,t=new Ft;return t.on("message",(function(t){e._dispatchMessageToDialog(t),e[t.dispatchTo]&&e[t.dispatchTo](t)})),t.on("update",(function(t){if(t.ready)return!!e.getUserOp.is("pending")&&e.load();e.getUserOp.update({status:"pending"}),e.connections.forEach((function(e){return e.update({state:"unreachable"})}))})),t}},{key:"_dispatchMessageToDialog",value:function(e){var t=this.findDialog({connection_id:e.connection_id});if(t&&(t[e.dispatchTo]&&t[e.dispatchTo](e),e.bubbles)){var n=t.findDialog(e);n&&n[e.dispatchTo]&&n[e.dispatchTo](e)}}},{key:"_parseGetUser",value:function(e){var t=this;this.connections.clear(),this.notifications.addMessages("set",e.notifications||[]),this.notifications.update({unread:e.unread||0}),(e.connections||[]).forEach((function(e){return t.ensureDialog(e)})),(e.dialogs||[]).forEach((function(e){return t.ensureDialog(e)})),this.update({})}}]),t}(Me);const Gt=[];function Yt(t,n=e){let a;const o=[];function r(e){if(c(t,e)&&(t=e,a)){const e=!Gt.length;for(let e=0;e<o.length;e+=1){const n=o[e];n[1](),Gt.push(n,t)}if(e){for(let e=0;e<Gt.length;e+=2)Gt[e][0](Gt[e+1]);Gt.length=0}}}return{set:r,update:function(e){r(e(t))},subscribe:function(i,c=e){const s=[i,c];return o.push(s),1===o.length&&(a=n(r)||e),i(t),()=>{const e=o.indexOf(s);-1!==e&&o.splice(e,1),0===o.length&&(a(),a=null)}}}}function Jt(e,t){var n=e.indexOf(t);return-1==n?null:n}function Xt(e){Qt(location.href),cn.set(new URL(location.href))}function Zt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Qt(e))return location.href=e;t.event&&t.event.preventDefault(),history[t.replace?"replaceState":"pushState"]({},document.title,e),cn.set(new URL(location.href))}function Qt(e){var t=0==e.indexOf("/")?0:e.indexOf(nn)+nn.length,n=Jt(e,"#"),a=Jt(e,"?");if(t==nn.length-1)return!1;var o=e.substring(t,a||n||e.length);return setTimeout((function(){return on.set(o)}),0),!0}function en(e){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){let t;return s(e,e=>t=e)(),t}(cn)).searchParams.forEach((function(t,n){var a=e[n];a&&a.tagName&&("checkbox"==a.type?a.checked=!!t:a.value=t,a.syncValue&&a.syncValue())}))}var tn=Yt(""),nn="//"+location.host,an=Yt(document.title),on=Yt(location.pathname),rn=function(t,n,a){const o=!Array.isArray(t),c=o?[t]:t,s=n.length<2;return{subscribe:Yt(a,t=>{let a=!1;const d=[];let u=0,l=e;const f=()=>{if(u)return;l();const a=n(o?d[0]:d,t);s?t(a):l=i(a)?a:e},p=c.map((e,t)=>e.subscribe(e=>{d[t]=e,u&=~(1<<t),a&&f()},()=>{u|=1<<t}));return a=!0,f(),function(){r(p),l()}}).subscribe}}(on,(function(e){return e.split("/").filter((function(e){return e.length})).map(decodeURIComponent)})),cn=Yt(new URL(location.href));function sn(t){var n,a,o,r;return{c(){P(n=E("i"),"class",a=t.classNames.join(" ")),P(n,"title",t.title),n.hidden=o=!t.name,P(n,"style",t.style),r=A(n,"click",t.click_handler)},m(e,t){w(e,n,t)},p(e,t){e.classNames&&a!==(a=t.classNames.join(" "))&&P(n,"class",a),e.title&&P(n,"title",t.title),e.name&&o!==(o=!t.name)&&(n.hidden=o),e.style&&P(n,"style",t.style)},i:e,o:e,d(e){e&&k(n),r()}}}function dn(e,t,n){const a={regular:"far",solid:"fas"},o=["atom","balance-scale","baseball-ball","book-reader","cat","chess-knight","child","dove","fish","hat-wizard","hiking","horse","id-badge","paw","portrait","running","skating","skiing","smile","snowboarding","snowman","swimmer","user-astronaut","user-graduate","user-ninja","user-secret","walking"];let{class:r=""}=t,i=[],{animation:c="",family:s="",name:d,style:u="",title:l=""}=t;return e.$set=e=>{"class"in e&&n("className",r=e.class),"animation"in e&&n("animation",c=e.animation),"family"in e&&n("family",s=e.family),"name"in e&&n("name",d=e.name),"style"in e&&n("style",u=e.style),"title"in e&&n("title",l=e.title)},e.$$.update=(e={family:1,classNames:1,name:1,animation:1,className:1})=>{(e.family||e.classNames||e.name||e.animation||e.className)&&(n("classNames",i=[a[s]||"fa"]),i.push("fa-"+(d&&0==d.indexOf("random:")?function(e){let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t),t&=t;return t=Math.abs(t),o[t%o.length]}(d):d)),c&&n("classNames",i=i.concat(c.split(" ").map(e=>"fa-"+e))),r&&n("classNames",i=i.concat(r.split(" "))))},{className:r,classNames:i,animation:c,family:s,name:d,style:u,title:l,click_handler:function(t){V(e,t)}}}class un extends be{constructor(e){super(),ve(this,e,dn,sn,c,["class","animation","family","name","style","title"])}}function ln(e){var t,n,a,o,r;const i=e.$$slots.default,c=u(i,e,null);var s=new un({props:{name:e.$activeMenu?"times-circle":"bars"}});return{c(){t=E("header"),c&&c.c(),n=S(),a=E("a"),s.$$.fragment.c(),P(a,"href","#toggle:menu"),P(a,"class","chat-header__hamburger"),P(t,"class","chat-header"),r=A(a,"click",C(e.toggleMenu))},l(e){c&&c.l(header_nodes)},m(e,r){w(e,t,r),c&&c.m(t,null),_(t,n),_(t,a),me(s,a,null),o=!0},p(e,t){c&&c.p&&e.$$scope&&c.p(f(i,t,e,null),l(i,t,null));var n={};e.$activeMenu&&(n.name=t.$activeMenu?"times-circle":"bars"),s.$set(n)},i(e){o||(le(c,e),le(s.$$.fragment,e),o=!0)},o(e){fe(c,e),fe(s.$$.fragment,e),o=!1},d(e){e&&k(t),c&&c.d(e),$e(s),r()}}}function fn(e,t,n){let a;d(e,tn,e=>{n("$activeMenu",a=e)});let{$$slots:o={},$$scope:r}=t;return e.$set=e=>{"$$scope"in e&&n("$$scope",r=e.$$scope)},e.$$.update=(e={$activeMenu:1})=>{e.$activeMenu&&(a||-1==location.href.indexOf("#settings")||Zt(location.href.replace(/#settings/,"")))},{toggleMenu:function(){p(tn,a="nav"==a?"":"nav")},$activeMenu:a,$$slots:o,$$scope:r}}class pn extends be{constructor(e){super(),ve(this,e,fn,ln,c,[])}}var hn=[];function gn(e,t){return gn[e]?gn[e](t):[]}function mn(e,t,n){const a=Object.create(e);return a.opt=t[n],a.i=n,a}function $n(e){var t,n,a=e.opt.text||e.opt.val+"";return{c(){P(t=E("a"),"href","#index:"+e.i),P(t,"tabindex","-1"),R(t,"has-focus",e.i==e.activeAutocompleteIndex),n=A(t,"click",C(e.selectOption))},m(e,n){w(e,t,n),t.innerHTML=a},p(e,n){e.autocompleteOptions&&a!==(a=n.opt.text||n.opt.val+"")&&(t.innerHTML=a),e.activeAutocompleteIndex&&R(t,"has-focus",n.i==n.activeAutocompleteIndex)},d(e){e&&k(t),n()}}}function vn(e){var t,n,a,o,i,c,s,d,u,l,f,p=new un({props:{name:"paper-plane"}});let h=e.autocompleteOptions,g=[];for(let t=0;t<h.length;t+=1)g[t]=$n(mn(e,h,t));return{c(){t=E("div"),n=E("textarea"),o=S(),i=E("a"),p.$$.fragment.c(),c=S(),s=E("div");for(let e=0;e<g.length;e+=1)g[e].c();P(n,"placeholder",a=Nt("What is on your mind %1?",e.$connection.nick)),P(i,"href","#send"),P(i,"class","btn-send"),P(s,"class",d="chat-input_autocomplete chat-input_autocomplete_"+e.autocompleteCategory),s.hidden=u=!e.autocompleteOptions.length,P(t,"class","chat-input"),f=[A(n,"keydown",e.keydown_handler),A(n,"keyup",e.keyup_handler),A(i,"click",C(e.sendMessage))]},m(a,r){w(a,t,r),_(t,n),e.textarea_binding(n),_(t,o),_(t,i),me(p,i,null),_(t,c),_(t,s);for(let e=0;e<g.length;e+=1)g[e].m(s,null);l=!0},p(e,t){if(l&&!e.$connection||a===(a=Nt("What is on your mind %1?",t.$connection.nick))||P(n,"placeholder",a),e.activeAutocompleteIndex||e.autocompleteOptions){let n;for(h=t.autocompleteOptions,n=0;n<h.length;n+=1){const a=mn(t,h,n);g[n]?g[n].p(e,a):(g[n]=$n(a),g[n].c(),g[n].m(s,null))}for(;n<g.length;n+=1)g[n].d(1);g.length=h.length}l&&!e.autocompleteCategory||d===(d="chat-input_autocomplete chat-input_autocomplete_"+t.autocompleteCategory)||P(s,"class",d),l&&!e.autocompleteOptions||u===(u=!t.autocompleteOptions.length)||(s.hidden=u)},i(e){l||(le(p.$$.fragment,e),l=!0)},o(e){fe(p.$$.fragment,e),l=!1},d(n){n&&k(t),e.textarea_binding(null),$e(p),x(g,n),r(f)}}}function bn(t,n,a){let o,r=e;t.$$.on_destroy.push(()=>r());let i,c,{dialog:d={}}=n,u=0,l="none";const f=K("user");function p(e,t={}){const n=t.space||"";a("inputEl",i.value=y[0]+e+n+y[3],i),a("inputEl",i.selectionStart=a("inputEl",i.selectionEnd=(y[0]+e+n).length,i),i),n.length&&a("pos",c=i.selectionStart)}function h(e){const t=v[u];t&&p(t.val,e)}function g(e,t){v.length&&(e.preventDefault(),a("activeAutocompleteIndex",u+=t),u<0&&a("activeAutocompleteIndex",u=v.length-1),u>=v.length&&a("activeAutocompleteIndex",u=0),h({space:""}))}function m(){const e={message:i.value,method:"send",dialog:d};e.message=e.message.replace(/^\/j\s/,"/join ");(e.message.match(/^\/(\w+)\s*(\S*)/)||["","message",""]).slice(1);e.message.length&&f.send(e),a("inputEl",i.value="",i)}const $={ArrowDown:e=>g(e,e.shiftKey?4:1),ArrowUp:e=>g(e,e.shiftKey?-4:-1),Tab:e=>g(e,e.shiftKey?-1:1),Enter(e){v[u]?(e.preventDefault(),h({space:" "})):e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||(e.preventDefault(),m())},Fallback(e){},Release(e){1!=e.key.length&&-1==["ArrowLeft","ArrowRight","Backspace"].indexOf(e.key)||a("pos",c=i.selectionStart)}};let v,b,y;return t.$set=e=>{"dialog"in e&&a("dialog",d=e.dialog)},t.$$.update=(e={pos:1,inputParts:1,dialog:1})=>{e.pos&&a("inputParts",y=c&&function(e){let t="",n="";return[i.value.substring(0,e).replace(/(\S)(\S*)$/,(e,a,o)=>(t=a,n=o,"")),t,n,i.value.substring(e)]}(c)||["","","",""]),e.inputParts&&a("autocompleteOptions",v=function([e,t,n,o]){a("autocompleteCategory",l=":"==t&&n.length?"emojis":"/"!=t||e.length?"@"==t&&n.length?"nicks":"#"==t||"&"==t?"dialogs":"none":"commands"),a("activeAutocompleteIndex",u=0);const r=gn(l,{dialog:d,query:t+n,user:f});return r.length&&r.unshift({val:t+n}),r}(y)||[]),e.dialog&&(()=>(r(),r=s(b,e=>{a("$connection",o=e)}),b))(a("connection",b=f.findDialog({connection_id:d.connection_id})))},{dialog:d,activeAutocompleteIndex:u,autocompleteCategory:l,inputEl:i,add:p,selectOption:function(e){a("activeAutocompleteIndex",u=parseInt(e.target.closest("a").href.replace(/.*index:/,""),10)),h({space:" "}),i.focus()},sendMessage:m,keys:$,autocompleteOptions:v,connection:b,$connection:o,textarea_binding:function(e){Y[e?"unshift":"push"](()=>{a("inputEl",i=e)})},keydown_handler:e=>($[e.key]||$.Fallback)(e),keyup_handler:e=>$.Release(e)}}gn.commands=function(e){for(var t=e.query,n=[],a=0;a<hn.length;a++)if(0==hn[a].cmd.indexOf(t)){var o=hn[a].alias||hn[a].cmd,r=hn[a].example.replace(/</g,"&lt;");n.push({text:r,val:o})}return n},gn.dialogs=function(e){for(var t=e.dialog,n=e.query,a=e.user.findDialog({connection_id:t.connection_id}).dialogs.toArray(),o=[],r=0;r<a.length&&!(-1!=a[r].name.toLowerCase().indexOf(n)&&(o.push({text:a[r].name,val:a[r].dialog_id}),o.length>=20));r++);return o},gn.emojis=function(e){var t=e.query,n=[];return[":","_"].map((function(e){return e+t.slice(1,2)})).forEach((function(e){for(var a=xt(e,"group"),o=0;o<a.length&&(a[o].shortname.indexOf(t)>=0&&n.push({val:a[o].emoji,text:Et(a[o].emoji)}),!(n.length>=20));o++);})),n},gn.nicks=function(e){var t=e.dialog,n=e.query,a=t.participants.values(),o=new RegExp("^"+We(n.slice(1)),"i"),r=[],i=!0,c=!1,s=void 0;try{for(var d,u=a[Symbol.iterator]();!(i=(d=u.next()).done);i=!0){var l=d.value;if(r.length>=20)break;l.nick.match(o)&&r.push({val:l.nick})}}catch(e){c=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(c)throw s}}return r},hn.push({cmd:"/me",example:"/me <msg>",description:"Send message as an action."}),hn.push({cmd:"/say",example:"/say <msg>",description:NaN}),hn.push({cmd:"/topic",example:"/topic or /topic <new topic>",description:"Show current topic, or set a new one."}),hn.push({cmd:"/whois",example:"/whois <nick>",description:"Show information about a user."}),hn.push({cmd:"/query",example:"/query <nick>",description:"Open up a new chat window with nick."}),hn.push({cmd:"/msg",example:"/msg <nick> <msg>",description:"Send a direct message to nick."}),hn.push({cmd:"/names",example:"/names",description:"Show participants in the channel."}),hn.push({cmd:"/join",example:"/join <#channel>",description:"Join channel and open up a chat window."}),hn.push({cmd:"/nick",example:"/nick <nick>",description:"Change your wanted nick."}),hn.push({cmd:"/part",example:"/part",description:"Leave channel, and close window."}),hn.push({cmd:"/close",example:"/close <nick>",description:"Close conversation with nick, defaults to current active."}),hn.push({cmd:"/kick",example:"/kick <nick>",description:"Kick a user from the current channel."}),hn.push({cmd:"/mode",example:"/mode +o #channel nick",description:"Change mode of yourself or a user"}),hn.push({cmd:"/reconnect",example:"/reconnect",description:"Restart the current connection."}),hn.push({cmd:"/cs",example:"/cs <msg>",description:'Short for "/msg chanserv ...".',alias:"/msg chanserv"}),hn.push({cmd:"/ns",example:"/ns <msg>",description:'Short for "/msg nickserv ...".',alias:"/msg nickserv"}),hn.push({cmd:"/hs",example:"/hs <msg>",description:'Short for "/msg hostserv ...".',alias:"/msg hostserv"}),hn.push({cmd:"/bs",example:"/bs <msg>",description:'Short for "/msg botserv ...".',alias:"/msg botserv"});class yn extends be{constructor(e){super(),ve(this,e,bn,vn,c,["dialog","add"])}get add(){return this.$$.ctx.add}}function _n(e,t,n){const a=Object.create(e);return a.message=t[n],a.i=n,a}function wn(e){var t,n,a=Nt("notifications"==e.dialog.dialog_id?"No notifications.":"No messages.")+"";return{c(){t=E("h2"),n=O(a)},m(e,a){w(e,t,a),_(t,n)},p(e,t){e.dialog&&a!==(a=Nt("notifications"==t.dialog.dialog_id?"No notifications.":"No messages.")+"")&&D(n,a)},d(e){e&&k(t)}}}function kn(e){var t,n,a,o=e.message.ts.getHumanDate()+"";return{c(){t=E("div"),n=E("span"),a=O(o),P(t,"class","message-status-line for-day-changed")},m(e,o){w(e,t,o),_(t,n),_(n,a)},p(e,t){e.dialog&&o!==(o=t.message.ts.getHumanDate()+"")&&D(a,o)},d(e){e&&k(t)}}}function xn(t){var n,a,o,r=Nt("Start of history")+"";return{c(){n=E("div"),a=E("span"),o=O(r),P(n,"class","message-status-line for-start-of-history")},m(e,t){w(e,n,t),_(n,a),_(a,o)},p:e,d(e){e&&k(n)}}}function En(t){var n,a,o,r=Nt("New messages")+"";return{c(){n=E("div"),a=E("span"),o=O(r),P(n,"class","message-status-line for-last-read")},m(e,t){w(e,n,t),_(n,a),_(a,o)},p:e,d(e){e&&k(n)}}}function On(e){var t,n,a,o,r,i,c,s,d,u,l,f,p,h,g,m,$=e.message.ts.toHuman()+"",v=e.message.from+"",b=e.message.markdown+"";function y(e,t){return t.message.endOfHistory?xn:t.message.dayChanged?kn:void 0}var x=y(0,e),N=x&&x(e),j=e.i&&e.i==e.dialog.messages.length-e.dialog.unread&&En(),T=new un({props:{name:e.message.from==e.connection.nick?e.user.icon:"random:"+e.message.from,family:"solid",style:"color:"+e.message.color}});function M(){return e.click_handler(e)}return{c(){N&&N.c(),t=S(),j&&j.c(),n=S(),a=E("div"),T.$$.fragment.c(),o=S(),r=E("b"),i=O($),s=S(),d=E("a"),u=O(v),f=S(),p=E("div"),P(r,"class","message__ts"),P(r,"title",c=e.message.ts.toLocaleString()),P(d,"href",l="#input:"+e.message.from),P(d,"class","message__from"),L(d,"color",e.message.color),P(p,"class","message__text"),P(a,"class",h="message is-type-"+(e.message.type||"notice")),P(a,"data-index",e.i),R(a,"is-sent-by-you",e.message.from==e.connection.nick),R(a,"is-hightlighted",e.message.highlight),R(a,"has-not-same-from",!e.message.isSameSender&&!e.message.dayChanged),R(a,"has-same-from",e.message.isSameSender&&!e.message.dayChanged),m=A(d,"click",C(M))},m(e,c){N&&N.m(e,c),w(e,t,c),j&&j.m(e,c),w(e,n,c),w(e,a,c),me(T,a,null),_(a,o),_(a,r),_(r,i),_(a,s),_(a,d),_(d,u),_(a,f),_(a,p),p.innerHTML=b,g=!0},p(o,s){x===(x=y(0,e=s))&&N?N.p(o,e):(N&&N.d(1),(N=x&&x(e))&&(N.c(),N.m(t.parentNode,t))),e.i&&e.i==e.dialog.messages.length-e.dialog.unread?j?j.p(o,e):((j=En()).c(),j.m(n.parentNode,n)):j&&(j.d(1),j=null);var f={};(o.dialog||o.connection)&&(f.name=e.message.from==e.connection.nick?e.user.icon:"random:"+e.message.from),o.dialog&&(f.style="color:"+e.message.color),T.$set(f),g&&!o.dialog||$===($=e.message.ts.toHuman()+"")||D(i,$),g&&!o.dialog||c===(c=e.message.ts.toLocaleString())||P(r,"title",c),g&&!o.dialog||v===(v=e.message.from+"")||D(u,v),g&&!o.dialog||l===(l="#input:"+e.message.from)||P(d,"href",l),g&&!o.dialog||L(d,"color",e.message.color),g&&!o.dialog||b===(b=e.message.markdown+"")||(p.innerHTML=b),g&&!o.dialog||h===(h="message is-type-"+(e.message.type||"notice"))||P(a,"class",h),(o.dialog||o.dialog||o.connection)&&R(a,"is-sent-by-you",e.message.from==e.connection.nick),(o.dialog||o.dialog)&&(R(a,"is-hightlighted",e.message.highlight),R(a,"has-not-same-from",!e.message.isSameSender&&!e.message.dayChanged),R(a,"has-same-from",e.message.isSameSender&&!e.message.dayChanged))},i(e){g||(le(T.$$.fragment,e),g=!0)},o(e){fe(T.$$.fragment,e),g=!1},d(e){N&&N.d(e),e&&k(t),j&&j.d(e),e&&(k(n),k(a)),$e(T),m()}}}function Sn(e){var t,n,a,o=Ct(e.connection,e.dialog)+"";return{c(){t=E("div"),n=E("span"),a=O(o),P(t,"class","message-status-line for-connection-status")},m(e,o){w(e,t,o),_(t,n),_(n,a)},p(e,t){(e.connection||e.dialog)&&o!==(o=Ct(t.connection,t.dialog)+"")&&D(a,o)},d(e){e&&k(t)}}}function Nn(t){var n,a,o,r=Nt("Loading...")+"";return{c(){n=E("div"),a=E("span"),o=O(r),P(n,"class","message-status-line for-loading")},m(e,t){w(e,n,t),_(n,a),_(a,o)},p:e,d(e){e&&k(n)}}}function An(e){var t,n,a,o,r,i=e.dialog.is("loading"),c=!e.dialog.messages.length&&wn(e);let s=e.dialog.messages,d=[];for(let t=0;t<s.length;t+=1)d[t]=On(_n(e,s,t));const u=e=>fe(d[e],1,1,()=>{d[e]=null});var l=(e.connection.frozen||e.dialog.frozen)&&Sn(e),f=i&&Nn();return{c(){c&&c.c(),t=S();for(let e=0;e<d.length;e+=1)d[e].c();n=S(),l&&l.c(),a=S(),f&&f.c(),o=N()},m(e,i){c&&c.m(e,i),w(e,t,i);for(let t=0;t<d.length;t+=1)d[t].m(e,i);w(e,n,i),l&&l.m(e,i),w(e,a,i),f&&f.m(e,i),w(e,o,i),r=!0},p(e,r){if(r.dialog.messages.length?c&&(c.d(1),c=null):c?c.p(e,r):((c=wn(r)).c(),c.m(t.parentNode,t)),e.dialog||e.connection||e.user||e.l){let t;for(s=r.dialog.messages,t=0;t<s.length;t+=1){const a=_n(r,s,t);d[t]?(d[t].p(e,a),le(d[t],1)):(d[t]=On(a),d[t].c(),le(d[t],1),d[t].m(n.parentNode,n))}for(de(),t=s.length;t<d.length;t+=1)u(t);ue()}r.connection.frozen||r.dialog.frozen?l?l.p(e,r):((l=Sn(r)).c(),l.m(a.parentNode,a)):l&&(l.d(1),l=null),e.dialog&&(i=r.dialog.is("loading")),i?f?f.p(e,r):((f=Nn()).c(),f.m(o.parentNode,o)):f&&(f.d(1),f=null)},i(e){if(!r){for(let e=0;e<s.length;e+=1)le(d[e]);r=!0}},o(e){d=d.filter(Boolean);for(let e=0;e<d.length;e+=1)fe(d[e]);r=!1},d(e){c&&c.d(e),e&&k(t),x(d,e),e&&k(n),l&&l.d(e),e&&k(a),f&&f.d(e),e&&k(o)}}}function Cn(e,t,n){let{connection:a,dialog:o,input:r}=t;const i=K("user");return e.$set=e=>{"connection"in e&&n("connection",a=e.connection),"dialog"in e&&n("dialog",o=e.dialog),"input"in e&&n("input",r=e.input)},{connection:a,dialog:o,input:r,user:i,click_handler:({message:e})=>r.add(e.from)}}class Pn extends be{constructor(e){super(),ve(this,e,Cn,An,c,["connection","dialog","input"])}}function Dn(e){var t,n,a,o,r,i=new un({props:{animation:e.animation,name:e.icon}});const c=e.$$slots.default,s=u(c,e,null);return{c(){t=E("button"),i.$$.fragment.c(),n=S(),s&&s.c(),P(t,"class",a=e.classNames.join(" ")),t.disabled=e.disabledProp,P(t,"type",e.type),r=A(t,"click",e.click_handler)},l(e){s&&s.l(button_nodes)},m(e,a){w(e,t,a),me(i,t,null),_(t,n),s&&s.m(t,null),o=!0},p(e,n){var r={};e.animation&&(r.animation=n.animation),e.icon&&(r.name=n.icon),i.$set(r),s&&s.p&&e.$$scope&&s.p(f(c,n,e,null),l(c,n,null)),o&&!e.classNames||a===(a=n.classNames.join(" "))||P(t,"class",a),o&&!e.disabledProp||(t.disabled=n.disabledProp),o&&!e.type||P(t,"type",n.type)},i(e){o||(le(i.$$.fragment,e),le(s,e),o=!0)},o(e){fe(i.$$.fragment,e),fe(s,e),o=!1},d(e){e&&k(t),$e(i),s&&s.d(e),r()}}}const jn=700;function Ln(e,t,n){let a,o="",r=[],i=!1,c=0,{disabled:s=!1,icon:u="",op:l=new Xe({api:!1,id:""}),type:f=""}=t;function p(e){e&&n("t0",c=(new ht).toEpoch()),n("animation",o=e?"spin":""),n("forceDisable",i=e)}d(e,l,e=>{n("$op",a=e)});let h,{$$slots:g={},$$scope:m}=t;return e.$set=e=>{"disabled"in e&&n("disabled",s=e.disabled),"icon"in e&&n("icon",u=e.icon),"op"in e&&n("op",l=e.op),"type"in e&&n("type",f=e.type),"$$scope"in e&&n("$$scope",m=e.$$scope)},e.$$.update=(e={$op:1,t0:1,icon:1,disabled:1,forceDisable:1})=>{e.$op&&a.is("loading")&&p(!0),(e.$op||e.t0)&&(a.is("loading")||setTimeout(()=>p(!1),jn-((new ht).toEpoch()-c))),e.icon&&n("classNames",r=["btn","for-"+(u||"default")]),(e.disabled||e.forceDisable)&&n("disabledProp",h=s||i)},{animation:o,classNames:r,disabled:s,icon:u,op:l,type:f,disabledProp:h,click_handler:function(t){V(e,t)},$$slots:g,$$scope:m}}class Rn extends be{constructor(e){super(),ve(this,e,Ln,Dn,c,["disabled","icon","op","type"])}}const Tn=()=>({}),Mn=()=>({});function In(e){var t,n,a,o,r,i,c,s,d=new un({props:{family:"regular",name:e.icon}});d.$on("click",e.click_handler);const p=e.$$slots.label,h=u(p,e,Mn);return{c(){t=E("div"),n=E("input"),a=S(),d.$$.fragment.c(),o=S(),r=E("label"),h||(i=O("Label")),h&&h.c(),P(n,"type","checkbox"),n.disabled=e.disabled,P(n,"name",e.name),P(n,"id",e.id),n.__value=e.value,n.value=n.__value,P(r,"for",e.id),P(t,"class","checkbox"),R(t,"is-disabled",e.disabled),s=A(n,"change",e.input_change_handler)},l(e){h&&h.l(label_nodes)},m(s,u){w(s,t,u),_(t,n),n.checked=e.checked,e.input_binding(n),_(t,a),me(d,t,null),_(t,o),_(t,r),h?h.m(r,null):_(r,i),c=!0},p(e,a){e.checked&&(n.checked=a.checked),c&&!e.disabled||(n.disabled=a.disabled),c&&!e.name||P(n,"name",a.name),c&&!e.id||P(n,"id",a.id),c&&!e.value||(n.__value=a.value),n.value=n.__value;var o={};e.icon&&(o.name=a.icon),d.$set(o),h&&h.p&&e.$$scope&&h.p(f(p,a,e,Tn),l(p,a,Mn)),c&&!e.id||P(r,"for",a.id),e.disabled&&R(t,"is-disabled",a.disabled)},i(e){c||(le(d.$$.fragment,e),le(h,e),c=!0)},o(e){fe(d.$$.fragment,e),fe(h,e),c=!1},d(n){n&&k(t),e.input_binding(null),$e(d),h&&h.d(n),s()}}}function Un(e,t,n){let a,{checked:o=!1,disabled:r=!1,name:i="",id:c=(i?"form_"+i:Ye()),value:s=1}=t,{$$slots:d={},$$scope:u}=t;let l;return e.$set=e=>{"checked"in e&&n("checked",o=e.checked),"disabled"in e&&n("disabled",r=e.disabled),"name"in e&&n("name",i=e.name),"id"in e&&n("id",c=e.id),"value"in e&&n("value",s=e.value),"$$scope"in e&&n("$$scope",u=e.$$scope)},e.$$.update=(e={inputEl:1,checked:1})=>{e.inputEl&&a&&!a.syncValue&&(n("inputEl",a.syncValue=function(){n("checked",[o,s]=[this.checked,this.value],o,n("value",s),n("inputEl",a))},a),a.syncValue()),e.checked&&n("icon",l=o?"check-square":"square")},{checked:o,disabled:r,name:i,id:c,value:s,inputEl:a,icon:l,input_change_handler:function(){o=this.checked,n("checked",o),n("inputEl",a)},input_binding:function(e){Y[e?"unshift":"push"](()=>{n("inputEl",a=e)})},click_handler:()=>{r||n("checked",o=!o)},$$slots:d,$$scope:u}}class Hn extends be{constructor(e){super(),ve(this,e,Un,In,c,["checked","disabled","name","id","value"])}}function zn(e){var t,n,a=Nt(e.$op.error())+"";return{c(){t=E("div"),n=O(a),P(t,"class","error")},m(e,a){w(e,t,a),_(t,n)},p(e,t){e.$op&&a!==(a=Nt(t.$op.error())+"")&&D(n,a)},d(e){e&&k(t)}}}function Bn(t){var n,a=t.$op.is("error"),o=a&&zn(t);return{c(){o&&o.c(),n=N()},m(e,t){o&&o.m(e,t),w(e,n,t)},p(e,t){e.$op&&(a=t.$op.is("error")),a?o?o.p(e,t):((o=zn(t)).c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},i:e,o:e,d(e){o&&o.d(e),e&&k(n)}}}function Fn(e,t,n){let a,{op:o=new Xe({})}=t;return d(e,o,e=>{n("$op",a=e)}),e.$set=e=>{"op"in e&&n("op",o=e.op)},{op:o,$op:a}}class qn extends be{constructor(e){super(),ve(this,e,Fn,Bn,c,["op"])}}const Wn=()=>({}),Kn=()=>({});function Vn(e){var t,n,a,o,r,i,c;const s=e.$$slots.label,d=u(s,e,Kn);return{c(){t=E("div"),n=E("label"),d||(a=O("Label")),d&&d.c(),o=S(),r=E("input"),P(n,"for",e.id),P(r,"type","password"),P(r,"name",e.name),P(r,"id",e.id),P(r,"placeholder",e.placeholder),P(t,"class","text-field has-password"),t.hidden=e.hidden,c=A(r,"input",e.input_input_handler)},l(e){d&&d.l(label_nodes)},m(c,s){w(c,t,s),_(t,n),d?d.m(n,null):_(n,a),_(t,o),_(t,r),j(r,e.value),i=!0},p(e,a){d&&d.p&&e.$$scope&&d.p(f(s,a,e,Wn),l(s,a,Kn)),i&&!e.id||P(n,"for",a.id),e.value&&r.value!==a.value&&j(r,a.value),i&&!e.name||P(r,"name",a.name),i&&!e.id||P(r,"id",a.id),i&&!e.placeholder||P(r,"placeholder",a.placeholder),i&&!e.hidden||(t.hidden=a.hidden)},i(e){i||(le(d,e),i=!0)},o(e){fe(d,e),i=!1},d(e){e&&k(t),d&&d.d(e),c()}}}function Gn(e,t,n){let{hidden:a=!1,name:o="",id:r=(o?"form_"+o:Ye()),placeholder:i="",value:c=""}=t,{$$slots:s={},$$scope:d}=t;return e.$set=e=>{"hidden"in e&&n("hidden",a=e.hidden),"name"in e&&n("name",o=e.name),"id"in e&&n("id",r=e.id),"placeholder"in e&&n("placeholder",i=e.placeholder),"value"in e&&n("value",c=e.value),"$$scope"in e&&n("$$scope",d=e.$$scope)},{hidden:a,name:o,id:r,placeholder:i,value:c,input_input_handler:function(){c=this.value,n("value",c)},$$slots:s,$$scope:d}}class Yn extends be{constructor(e){super(),ve(this,e,Gn,Vn,c,["hidden","name","id","placeholder","value"])}}function Jn(e){var t,n,a,o;const r=e.$$slots.default,i=u(r,e,null);return{c(){t=E("a"),i&&i.c(),P(t,"href",e.href),P(t,"class",n=e.classNames.join(" ")),P(t,"style",e.style),o=A(t,"click",e.onClick)},l(e){i&&i.l(a_nodes)},m(n,o){w(n,t,o),i&&i.m(t,null),e.a_binding(t),a=!0},p(e,o){i&&i.p&&e.$$scope&&i.p(f(r,o,e,null),l(r,o,null)),a&&!e.href||P(t,"href",o.href),a&&!e.classNames||n===(n=o.classNames.join(" "))||P(t,"class",n),a&&!e.style||P(t,"style",o.style)},i(e){a||(le(i,e),a=!0)},o(e){fe(i,e),a=!1},d(n){n&&k(t),i&&i.d(n),e.a_binding(null),o()}}}function Xn(e,t,n){let a;d(e,on,e=>{n("$pathname",a=e)});let o,{class:r=""}=t,i=[],{href:c="/",native:s=!1,replace:u=!1,style:l=""}=t;let{$$slots:f={},$$scope:p}=t;return e.$set=e=>{"class"in e&&n("className",r=e.class),"href"in e&&n("href",c=e.href),"native"in e&&n("native",s=e.native),"replace"in e&&n("replace",u=e.replace),"style"in e&&n("style",l=e.style),"$$scope"in e&&n("$$scope",p=e.$$scope)},e.$$.update=(e={className:1,href:1,$pathname:1})=>{(e.className||e.href||e.$pathname)&&function(e,t,a){n("classNames",i=e?[e]:[]),a==t.replace(/(#|\?).*/,"")&&n("classNames",i=[...i,"has-path"])}(r,c,a)},{className:r,classNames:i,el:o,href:c,native:s,replace:u,style:l,focus:()=>o.focus(),onClick:function(e){s||Zt(e.target.closest("a").href,{event:e,replace:u})},a_binding:function(e){Y[e?"unshift":"push"](()=>{n("el",o=e)})},$$slots:f,$$scope:p}}class Zn extends be{constructor(e){super(),ve(this,e,Xn,Jn,c,["class","href","native","replace","style","focus"])}get focus(){return this.$$.ctx.focus}}function Qn(e){var t,n,a,o,r=Nt(e.dialog.dialog_id?"Conversation":"Connection")+"",i=new un({props:{name:"times-circle"}});return{c(){t=E("h2"),n=O(r),a=S(),i.$$.fragment.c()},m(e,r){w(e,t,r),_(t,n),w(e,a,r),me(i,e,r),o=!0},p(e,t){o&&!e.dialog||r===(r=Nt(t.dialog.dialog_id?"Conversation":"Connection")+"")||D(n,r)},i(e){o||(le(i.$$.fragment,e),o=!0)},o(e){fe(i.$$.fragment,e),o=!1},d(e){e&&(k(t),k(a)),$e(i,e)}}}function ea(e){var t;let n={href:"/chat/"+e.dialog.path,class:"sidebar__header for-settings",$$slots:{default:[Qn]},$$scope:{ctx:e}};var a=new Zn({props:n});return e.link_binding(a),{c(){a.$$.fragment.c()},m(e,n){me(a,e,n),t=!0},p(e,t){var n={};e.dialog&&(n.href="/chat/"+t.dialog.path),(e.$$scope||e.dialog)&&(n.$$scope={changed:e,ctx:t}),a.$set(n)},i(e){t||(le(a.$$.fragment,e),t=!0)},o(e){fe(a.$$.fragment,e),t=!1},d(t){e.link_binding(null),$e(a,t)}}}function ta(e,t,n){let a,{dialog:o={}}=t;return e.$set=e=>{"dialog"in e&&n("dialog",o=e.dialog)},e.$$.update=(e={linkEl:1})=>{e.linkEl&&a&&a.focus()},{dialog:o,linkEl:a,link_binding:function(e){Y[e?"unshift":"push"](()=>{n("linkEl",a=e)})}}}class na extends be{constructor(e){super(),ve(this,e,ta,ea,c,["dialog"])}}const aa=()=>({}),oa=()=>({});function ra(e){var t,n,a,o,r,i,c;const s=e.$$slots.label,d=u(s,e,oa);return{c(){t=E("div"),n=E("label"),d||(a=O("Label")),d&&d.c(),o=S(),r=E("textarea"),P(n,"for",e.id),P(r,"name",e.name),P(r,"placeholder",e.placeholder),P(r,"id",e.id),r.readOnly=e.readonly,P(t,"class","text-area"),t.hidden=e.hidden,c=A(r,"input",e.textarea_input_handler)},l(e){d&&d.l(label_nodes)},m(c,s){w(c,t,s),_(t,n),d?d.m(n,null):_(n,a),_(t,o),_(t,r),j(r,e.value),e.textarea_binding(r),i=!0},p(e,a){d&&d.p&&e.$$scope&&d.p(f(s,a,e,aa),l(s,a,oa)),i&&!e.id||P(n,"for",a.id),e.value&&j(r,a.value),i&&!e.name||P(r,"name",a.name),i&&!e.placeholder||P(r,"placeholder",a.placeholder),i&&!e.id||P(r,"id",a.id),i&&!e.readonly||(r.readOnly=a.readonly),i&&!e.hidden||(t.hidden=a.hidden)},i(e){i||(le(d,e),i=!0)},o(e){fe(d,e),i=!1},d(n){n&&k(t),d&&d.d(n),e.textarea_binding(null),c()}}}function ia(e,t,n){let a,{hidden:o=!1,name:r="",id:i=(r?"form_"+r:Ye()),placeholder:c="",readonly:s=!1,value:d=""}=t,{$$slots:u={},$$scope:l}=t;return e.$set=e=>{"hidden"in e&&n("hidden",o=e.hidden),"name"in e&&n("name",r=e.name),"id"in e&&n("id",i=e.id),"placeholder"in e&&n("placeholder",c=e.placeholder),"readonly"in e&&n("readonly",s=e.readonly),"value"in e&&n("value",d=e.value),"$$scope"in e&&n("$$scope",l=e.$$scope)},e.$$.update=(e={inputEl:1})=>{e.inputEl&&a&&!a.syncValue&&(n("inputEl",a.syncValue=function(){n("value",d=this.value)},a),a.syncValue())},{inputEl:a,hidden:o,name:r,id:i,placeholder:c,readonly:s,value:d,textarea_input_handler:function(){d=this.value,n("value",d),n("inputEl",a)},textarea_binding:function(e){Y[e?"unshift":"push"](()=>{n("inputEl",a=e)})},$$slots:u,$$scope:l}}class ca extends be{constructor(e){super(),ve(this,e,ia,ra,c,["hidden","name","id","placeholder","readonly","value"])}}const sa=()=>({}),da=()=>({});function ua(e){var t,n,a,o,i,c,s;const d=e.$$slots.label,p=u(d,e,da);return{c(){t=E("div"),n=E("label"),p||(a=O("Label")),p&&p.c(),o=S(),i=E("input"),P(n,"for",e.id),P(i,"type","text"),P(i,"autocomplete",e.autocomplete),P(i,"name",e.name),P(i,"placeholder",e.placeholder),P(i,"id",e.id),i.readOnly=e.readonly,P(t,"class","text-field"),t.hidden=e.hidden,s=[A(i,"input",e.input_input_handler),A(i,"keyup",e.keyup_handler)]},l(e){p&&p.l(label_nodes)},m(r,s){w(r,t,s),_(t,n),p?p.m(n,null):_(n,a),_(t,o),_(t,i),j(i,e.value),e.input_binding(i),c=!0},p(e,a){p&&p.p&&e.$$scope&&p.p(f(d,a,e,sa),l(d,a,da)),c&&!e.id||P(n,"for",a.id),e.value&&i.value!==a.value&&j(i,a.value),c&&!e.autocomplete||P(i,"autocomplete",a.autocomplete),c&&!e.name||P(i,"name",a.name),c&&!e.placeholder||P(i,"placeholder",a.placeholder),c&&!e.id||P(i,"id",a.id),c&&!e.readonly||(i.readOnly=a.readonly),c&&!e.hidden||(t.hidden=a.hidden)},i(e){c||(le(p,e),c=!0)},o(e){fe(p,e),c=!1},d(n){n&&k(t),p&&p.d(n),e.input_binding(null),r(s)}}}function la(e,t,n){let a,{autocomplete:o=null,hidden:r=!1,name:i="",id:c=(i?"form_"+i:Ye()),placeholder:s="",readonly:d=!1,value:u=""}=t,{$$slots:l={},$$scope:f}=t;return e.$set=e=>{"autocomplete"in e&&n("autocomplete",o=e.autocomplete),"hidden"in e&&n("hidden",r=e.hidden),"name"in e&&n("name",i=e.name),"id"in e&&n("id",c=e.id),"placeholder"in e&&n("placeholder",s=e.placeholder),"readonly"in e&&n("readonly",d=e.readonly),"value"in e&&n("value",u=e.value),"$$scope"in e&&n("$$scope",f=e.$$scope)},e.$$.update=(e={inputEl:1})=>{e.inputEl&&a&&!a.syncValue&&(n("inputEl",a.syncValue=function(){n("value",u=this.value)},a),a.syncValue())},{inputEl:a,autocomplete:o,hidden:r,name:i,id:c,placeholder:s,readonly:d,value:u,keyup_handler:function(t){V(e,t)},input_input_handler:function(){u=this.value,n("value",u),n("inputEl",a)},input_binding:function(e){Y[e?"unshift":"push"](()=>{n("inputEl",a=e)})},$$slots:l,$$scope:f}}class fa extends be{constructor(e){super(),ve(this,e,la,ua,c,["autocomplete","hidden","name","id","placeholder","readonly","value"])}}function pa(e){var t,n;return{c(){P(t=E("input"),"type","hidden"),P(t,"name","connection_id"),t.value=n=e.connection.connection_id},m(e,n){w(e,t,n)},p(e,a){e.connection&&n!==(n=a.connection.connection_id)&&(t.value=n)},d(e){e&&k(t)}}}function ha(t){var n,a,o=Nt("Host and port")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function ga(t){return{c:e,m:e,p:e,d:e}}function ma(t){var n,a,o=Nt("Nickname")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function $a(t){return{c:e,m:e,p:e,d:e}}function va(e){var t,n;function a(n){e.checkbox_checked_binding.call(null,n),t=!0,ae(()=>t=!1)}let o={$$slots:{default:[ya],label:[ba]},$$scope:{ctx:e}};void 0!==e.wantToBeConnected&&(o.checked=e.wantToBeConnected);var r=new Hn({props:o});return Y.push(()=>ge(r,"checked",a)),{c(){r.$$.fragment.c()},m(e,t){me(r,e,t),n=!0},p(e,n){var a={};e.$$scope&&(a.$$scope={changed:e,ctx:n}),!t&&e.wantToBeConnected&&(a.checked=n.wantToBeConnected),r.$set(a)},i(e){n||(le(r.$$.fragment,e),n=!0)},o(e){fe(r.$$.fragment,e),n=!1},d(e){$e(r,e)}}}function ba(t){var n,a,o=Nt("Want to be connected")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function ya(t){return{c:e,m:e,p:e,d:e}}function _a(t){var n,a,o=Nt("Secure connection (TLS)")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function wa(t){return{c:e,m:e,p:e,d:e}}function ka(e){var t,n;function a(n){e.checkbox_checked_binding_1.call(null,n),t=!0,ae(()=>t=!1)}let o={name:"tls_verify",$$slots:{default:[Ea],label:[xa]},$$scope:{ctx:e}};void 0!==e.verifyTls&&(o.checked=e.verifyTls);var r=new Hn({props:o});return Y.push(()=>ge(r,"checked",a)),{c(){r.$$.fragment.c()},m(e,t){me(r,e,t),n=!0},p(e,n){var a={};e.$$scope&&(a.$$scope={changed:e,ctx:n}),!t&&e.verifyTls&&(a.checked=n.verifyTls),r.$set(a)},i(e){n||(le(r.$$.fragment,e),n=!0)},o(e){fe(r.$$.fragment,e),n=!1},d(e){$e(r,e)}}}function xa(t){var n,a,o=Nt("Verify certificate (TLS)")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function Ea(t){return{c:e,m:e,p:e,d:e}}function Oa(t){var n,a,o=Nt("Show advanced settings")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function Sa(t){return{c:e,m:e,p:e,d:e}}function Na(t){var n,a,o=Nt("Username")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function Aa(t){return{c:e,m:e,p:e,d:e}}function Ca(t){var n,a,o=Nt("Password")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function Pa(t){return{c:e,m:e,p:e,d:e}}function Da(t){var n,a,o=Nt("On-connect commands")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function ja(t){return{c:e,m:e,p:e,d:e}}function La(e){var t,n=new Rn({props:{icon:"save",op:e.createConnectionOp,$$slots:{default:[Ta]},$$scope:{ctx:e}}});return{c(){n.$$.fragment.c()},m(e,a){me(n,e,a),t=!0},p(e,t){var a={};e.$$scope&&(a.$$scope={changed:e,ctx:t}),n.$set(a)},i(e){t||(le(n.$$.fragment,e),t=!0)},o(e){fe(n.$$.fragment,e),t=!1},d(e){$e(n,e)}}}function Ra(e){var t,n,a=new Rn({props:{icon:"save",op:e.updateConnectionOp,$$slots:{default:[Ma]},$$scope:{ctx:e}}}),o=new Rn({props:{icon:"trash",type:"button",op:e.removeConnectionOp,$$slots:{default:[Ia]},$$scope:{ctx:e}}});return o.$on("click",e.removeConnection),{c(){a.$$.fragment.c(),t=S(),o.$$.fragment.c()},m(e,r){me(a,e,r),w(e,t,r),me(o,e,r),n=!0},p(e,t){var n={};e.$$scope&&(n.$$scope={changed:e,ctx:t}),a.$set(n);var r={};e.$$scope&&(r.$$scope={changed:e,ctx:t}),o.$set(r)},i(e){n||(le(a.$$.fragment,e),le(o.$$.fragment,e),n=!0)},o(e){fe(a.$$.fragment,e),fe(o.$$.fragment,e),n=!1},d(e){$e(a,e),e&&k(t),$e(o,e)}}}function Ta(t){var n,a=Nt("Create")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function Ma(t){var n,a=Nt("Update")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function Ia(t){var n,a=Nt("Delete")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function Ua(e){var t,n,a,o,r,i,c,s,d,u,l,f,p,h,g,m,$,v,b,y,x,O,N,D,j,L=e.connection.connection_id&&pa(e),R=new fa({props:{name:"server",placeholder:Nt("Ex: chat.freenode.net:6697"),$$slots:{default:[ga],label:[ha]},$$scope:{ctx:e}}}),T=new fa({props:{name:"nick",placeholder:Nt("Ex: your-name"),$$slots:{default:[$a],label:[ma]},$$scope:{ctx:e}}}),M=e.connection.url&&va(e);function I(t){e.checkbox0_checked_binding.call(null,t),u=!0,ae(()=>u=!1)}let U={name:"tls",$$slots:{default:[wa],label:[_a]},$$scope:{ctx:e}};void 0!==e.useTls&&(U.checked=e.useTls);var H=new Hn({props:U});Y.push(()=>ge(H,"checked",I));var z=e.useTls&&ka(e);function B(t){e.checkbox1_checked_binding.call(null,t),p=!0,ae(()=>p=!1)}let F={$$slots:{default:[Sa],label:[Oa]},$$scope:{ctx:e}};void 0!==e.showAdvancedSettings&&(F.checked=e.showAdvancedSettings);var q=new Hn({props:F});Y.push(()=>ge(q,"checked",B));var W=new fa({props:{name:"username",hidden:!e.showAdvancedSettings,$$slots:{default:[Aa],label:[Na]},$$scope:{ctx:e}}}),K=new Yn({props:{name:"password",hidden:!e.showAdvancedSettings,$$slots:{default:[Pa],label:[Ca]},$$scope:{ctx:e}}}),V=new ca({props:{name:"on_connect_commands",hidden:!e.showAdvancedSettings,$$slots:{default:[ja],label:[Da]},$$scope:{ctx:e}}}),G=[Ra,La],J=[];function X(e,t){return t.connection.url?0:1}b=X(0,e),y=J[b]=G[b](e);var Z=new qn({props:{op:e.createConnectionOp}}),Q=new qn({props:{op:e.removeConnectionOp}}),ee=new qn({props:{op:e.updateConnectionOp}});return{c(){t=E("form"),L&&L.c(),n=S(),a=E("input"),o=S(),r=E("input"),i=S(),R.$$.fragment.c(),c=S(),T.$$.fragment.c(),s=S(),M&&M.c(),d=S(),H.$$.fragment.c(),l=S(),z&&z.c(),f=S(),q.$$.fragment.c(),h=S(),W.$$.fragment.c(),g=S(),K.$$.fragment.c(),m=S(),V.$$.fragment.c(),$=S(),v=E("div"),y.c(),x=S(),Z.$$.fragment.c(),O=S(),Q.$$.fragment.c(),N=S(),ee.$$.fragment.c(),P(a,"type","hidden"),P(a,"name","url"),P(r,"type","hidden"),P(r,"name","wanted_state"),P(v,"class","form-actions"),P(t,"method","post"),j=A(t,"submit",C(e.submitForm))},m(u,p){w(u,t,p),L&&L.m(t,null),_(t,n),_(t,a),_(t,o),_(t,r),_(t,i),me(R,t,null),_(t,c),me(T,t,null),_(t,s),M&&M.m(t,null),_(t,d),me(H,t,null),_(t,l),z&&z.m(t,null),_(t,f),me(q,t,null),_(t,h),me(W,t,null),_(t,g),me(K,t,null),_(t,m),me(V,t,null),_(t,$),_(t,v),J[b].m(v,null),_(t,x),me(Z,t,null),_(t,O),me(Q,t,null),_(t,N),me(ee,t,null),e.form_binding(t),D=!0},p(e,a){a.connection.connection_id?L?L.p(e,a):((L=pa(a)).c(),L.m(t,n)):L&&(L.d(1),L=null);var o={};e.$$scope&&(o.$$scope={changed:e,ctx:a}),R.$set(o);var r={};e.$$scope&&(r.$$scope={changed:e,ctx:a}),T.$set(r),a.connection.url?M?(M.p(e,a),le(M,1)):((M=va(a)).c(),le(M,1),M.m(t,d)):M&&(de(),fe(M,1,1,()=>{M=null}),ue());var i={};e.$$scope&&(i.$$scope={changed:e,ctx:a}),!u&&e.useTls&&(i.checked=a.useTls),H.$set(i),a.useTls?z?(z.p(e,a),le(z,1)):((z=ka(a)).c(),le(z,1),z.m(t,f)):z&&(de(),fe(z,1,1,()=>{z=null}),ue());var c={};e.$$scope&&(c.$$scope={changed:e,ctx:a}),!p&&e.showAdvancedSettings&&(c.checked=a.showAdvancedSettings),q.$set(c);var s={};e.showAdvancedSettings&&(s.hidden=!a.showAdvancedSettings),e.$$scope&&(s.$$scope={changed:e,ctx:a}),W.$set(s);var l={};e.showAdvancedSettings&&(l.hidden=!a.showAdvancedSettings),e.$$scope&&(l.$$scope={changed:e,ctx:a}),K.$set(l);var h={};e.showAdvancedSettings&&(h.hidden=!a.showAdvancedSettings),e.$$scope&&(h.$$scope={changed:e,ctx:a}),V.$set(h);var g=b;(b=X(0,a))===g?J[b].p(e,a):(de(),fe(J[g],1,1,()=>{J[g]=null}),ue(),(y=J[b])||(y=J[b]=G[b](a)).c(),le(y,1),y.m(v,null))},i(e){D||(le(R.$$.fragment,e),le(T.$$.fragment,e),le(M),le(H.$$.fragment,e),le(z),le(q.$$.fragment,e),le(W.$$.fragment,e),le(K.$$.fragment,e),le(V.$$.fragment,e),le(y),le(Z.$$.fragment,e),le(Q.$$.fragment,e),le(ee.$$.fragment,e),D=!0)},o(e){fe(R.$$.fragment,e),fe(T.$$.fragment,e),fe(M),fe(H.$$.fragment,e),fe(z),fe(q.$$.fragment,e),fe(W.$$.fragment,e),fe(K.$$.fragment,e),fe(V.$$.fragment,e),fe(y),fe(Z.$$.fragment,e),fe(Q.$$.fragment,e),fe(ee.$$.fragment,e),D=!1},d(n){n&&k(t),L&&L.d(),$e(R),$e(T),M&&M.d(),$e(H),z&&z.d(),$e(q),$e(W),$e(K),$e(V),J[b].d(),$e(Z),$e(Q),$e(ee),e.form_binding(null),j()}}}function Ha(e,t,n){let{dialog:a={}}=t;const o=K("user"),r=o.api.operation("createConnection"),i=o.api.operation("removeConnection"),c=o.api.operation("updateConnection");[r,c].forEach(e=>{e.on("start",e=>{e.body.on_connect_commands=e.body.on_connect_commands.split("\n").map(e=>e.trim())})});let s,d={},u=!1,l=!1,f=!1,p=!1;function h(){d.url&&(n("formEl",s.server.value=d.url.host,s),n("formEl",s.nick.value=d.url.searchParams.get("nick")||"",s),n("formEl",s.on_connect_commands.value=d.on_connect_commands.join("\n"),s),n("formEl",s.password.value=d.url.password,s),n("formEl",s.username.value=d.url.username,s),n("formEl",s.url.value=d.url.toString(),s),n("useTls",l="1"==d.url.searchParams.get("tls")),n("verifyTls",f="1"==d.url.searchParams.get("tls_verify")),n("wantToBeConnected",p="connected"==d.wanted_state))}return q(async()=>{if(await o.load(),s)return n("connection",d=o.findDialog({connection_id:a.connection_id})||{}),d.url?h():(n("formEl",s.nick.value=o.email.replace(/@.*/,"").replace(/\W/g,"_"),s),n("useTls",l=!0),n("wantToBeConnected",p=!0),void en(s))}),e.$set=e=>{"dialog"in e&&n("dialog",a=e.dialog)},e.$$.update=(e={formEl:1,wantToBeConnected:1})=>{(e.formEl||e.wantToBeConnected)&&s&&n("formEl",s.wanted_state.value=p?"connected":"disconnected",s)},{dialog:a,createConnectionOp:r,removeConnectionOp:i,updateConnectionOp:c,connection:d,formEl:s,showAdvancedSettings:u,useTls:l,verifyTls:f,wantToBeConnected:p,removeConnection:async function(e){await i.perform(d),o.removeDialog(d),Zt("/chat")},submitForm:async function(e){if(s.server.value)if(n("formEl",s.url.value=new ct("irc://localhost:6667").fromForm(e.target).toString(),s),d.connection_id)await c.perform(e.target),o.ensureDialog(c.res.body),h();else{await r.perform(e.target),Zt("/chat/"+o.ensureDialog(r.res.body).path)}},checkbox_checked_binding:function(e){n("wantToBeConnected",p=e)},checkbox0_checked_binding:function(e){n("useTls",l=e)},checkbox_checked_binding_1:function(e){n("verifyTls",f=e)},checkbox1_checked_binding:function(e){n("showAdvancedSettings",u=e)},form_binding:function(e){Y[e?"unshift":"push"](()=>{n("formEl",s=e)})}}}class za extends be{constructor(e){super(),ve(this,e,Ha,Ua,c,["dialog"])}}function Ba(e){var t,n,a=Nt("Currently connecting to %1.",e.connectionHost)+"";return{c(){t=E("p"),n=O(a)},m(e,a){w(e,t,a),_(t,n)},p(e,t){e.connectionHost&&a!==(a=Nt("Currently connecting to %1.",t.connectionHost)+"")&&D(n,a)},d(e){e&&k(t)}}}function Fa(e){var t,n,a=Nt("Currently connected to %1.",e.connectionHost)+"";return{c(){t=E("p"),n=O(a)},m(e,a){w(e,t,a),_(t,n)},p(e,t){e.connectionHost&&a!==(a=Nt("Currently connected to %1.",t.connectionHost)+"")&&D(n,a)},d(e){e&&k(t)}}}function qa(e){var t,n,a=Nt("Currently disconnected from %1.",e.connectionHost)+"";return{c(){t=E("p"),n=O(a)},m(e,a){w(e,t,a),_(t,n)},p(e,t){e.connectionHost&&a!==(a=Nt("Currently disconnected from %1.",t.connectionHost)+"")&&D(n,a)},d(e){e&&k(t)}}}function Wa(t){var n,a,o=Nt("Connection not found.")+"";return{c(){n=E("p"),a=O(o)},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function Ka(e){var t,n,a,o,r=new na({props:{dialog:e.dialog}});function i(e,t){return t.connection.url?"disconnected"==t.connection.state?qa:"connected"==t.connection.state?Fa:Ba:Wa}var c=i(0,e),s=c(e),d=new za({props:{dialog:e.dialog}});return{c(){t=E("div"),r.$$.fragment.c(),n=S(),s.c(),a=S(),d.$$.fragment.c(),P(t,"class","sidebar-wrapper is-visible")},m(e,i){w(e,t,i),me(r,t,null),_(t,n),s.m(t,null),_(t,a),me(d,t,null),o=!0},p(e,n){var o={};e.dialog&&(o.dialog=n.dialog),r.$set(o),c===(c=i(0,n))&&s?s.p(e,n):(s.d(1),(s=c(n))&&(s.c(),s.m(t,a)));var u={};e.dialog&&(u.dialog=n.dialog),d.$set(u)},i(e){o||(le(r.$$.fragment,e),le(d.$$.fragment,e),o=!0)},o(e){fe(r.$$.fragment,e),fe(d.$$.fragment,e),o=!1},d(e){e&&k(t),$e(r),s.d(),$e(d)}}}function Va(e,t,n){let{dialog:a={}}=t;const o=K("user");let r,i={};return q(async()=>{await o.load(),n("connection",i=o.findDialog({connection_id:a.connection_id})||{})}),e.$set=e=>{"dialog"in e&&n("dialog",a=e.dialog)},e.$$.update=(e={connection:1})=>{e.connection&&n("connectionHost",r=i.url&&i.url.host)},{dialog:a,connection:i,connectionHost:r}}class Ga extends be{constructor(e){super(),ve(this,e,Va,Ka,c,["dialog"])}}function Ya(e,t,n){const a=Object.create(e);return a.participant=t[n],a}function Ja(t){var n,a,o=Nt("No participants.")+"";return{c(){n=E("p"),a=O(o)},m(e,t){w(e,n,t),_(n,a)},p:e,i:e,o:e,d(e){e&&k(n)}}}function Xa(e){var t,n;let a=e.dialog.participants.toArray(),o=[];for(let t=0;t<a.length;t+=1)o[t]=Qa(Ya(e,a,t));const r=e=>fe(o[e],1,1,()=>{o[e]=null});return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=N()},m(e,a){for(let t=0;t<o.length;t+=1)o[t].m(e,a);w(e,t,a),n=!0},p(e,n){if(e.dialog||e.participantClassNames){let i;for(a=n.dialog.participants.toArray(),i=0;i<a.length;i+=1){const r=Ya(n,a,i);o[i]?(o[i].p(e,r),le(o[i],1)):(o[i]=Qa(r),o[i].c(),le(o[i],1),o[i].m(t.parentNode,t))}for(de(),i=a.length;i<o.length;i+=1)r(i);ue()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)le(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)fe(o[e]);n=!1},d(e){x(o,e),e&&k(t)}}}function Za(e){var t,n,a,o,r,i=e.participant.nick+"",c=new un({props:{name:"random:"+e.participant.id,family:"solid",style:"color:"+e.participant.color}});return{c(){c.$$.fragment.c(),t=S(),n=E("span"),a=O(i),o=S()},m(e,i){me(c,e,i),w(e,t,i),w(e,n,i),_(n,a),w(e,o,i),r=!0},p(e,t){var n={};e.dialog&&(n.name="random:"+t.participant.id),e.dialog&&(n.style="color:"+t.participant.color),c.$set(n),r&&!e.dialog||i===(i=t.participant.nick+"")||D(a,i)},i(e){r||(le(c.$$.fragment,e),r=!0)},o(e){fe(c.$$.fragment,e),r=!1},d(e){$e(c,e),e&&(k(t),k(n),k(o))}}}function Qa(e){var t,n=new Zn({props:{href:"/chat/"+e.dialog.connection_id+"/"+e.participant.id,class:"participant "+to(e.participant.mode),$$slots:{default:[Za]},$$scope:{ctx:e}}});return{c(){n.$$.fragment.c()},m(e,a){me(n,e,a),t=!0},p(e,t){var a={};e.dialog&&(a.href="/chat/"+t.dialog.connection_id+"/"+t.participant.id),e.dialog&&(a.class="participant "+to(t.participant.mode)),(e.$$scope||e.dialog)&&(a.$$scope={changed:e,ctx:t}),n.$set(a)},i(e){t||(le(n.$$.fragment,e),t=!0)},o(e){fe(n.$$.fragment,e),t=!1},d(e){$e(n,e)}}}function eo(e){var t,n,a,o,r=[Xa,Ja],i=[];function c(e,t){return t.dialog.participants.size?0:1}return t=c(0,e),n=i[t]=r[t](e),{c(){n.c(),a=N()},m(e,n){i[t].m(e,n),w(e,a,n),o=!0},p(e,o){var s=t;(t=c(0,o))===s?i[t].p(e,o):(de(),fe(i[s],1,1,()=>{i[s]=null}),ue(),(n=i[t])||(n=i[t]=r[t](o)).c(),le(n,1),n.m(a.parentNode,a))},i(e){o||(le(n),o=!0)},o(e){fe(n),o=!1},d(e){i[t].d(e),e&&k(a)}}}function to(e){return(e||"").split("").map(e=>"has-mode-"+e).join(" ")}function no(e,t,n){let{dialog:a}=t;return e.$set=e=>{"dialog"in e&&n("dialog",a=e.dialog)},{dialog:a}}class ao extends be{constructor(e){super(),ve(this,e,no,eo,c,["dialog"])}}function oo(e){var t,n=Nt("You are not a channel operator in %1.",e.dialog.name)+"";return{c(){t=O(n)},m(e,n){w(e,t,n)},p(e,a){e.dialog&&n!==(n=Nt("You are not a channel operator in %1.",a.dialog.name)+"")&&D(t,n)},d(e){e&&k(t)}}}function ro(e){var t,n=Nt("You are a channel operator in %1.",e.dialog.name)+"";return{c(){t=O(n)},m(e,n){w(e,t,n)},p(e,a){e.dialog&&n!==(n=Nt("You are a channel operator in %1.",a.dialog.name)+"")&&D(t,n)},d(e){e&&k(t)}}}function io(e){var t,n=Nt("Private conversation with %1.",e.dialog.name)+"";return{c(){t=O(n)},m(e,n){w(e,t,n)},p(e,a){e.dialog&&n!==(n=Nt("Private conversation with %1.",a.dialog.name)+"")&&D(t,n)},d(e){e&&k(t)}}}function co(e){var t,n,a,o,r,i,c,s=new ca({props:{name:"topic",placeholder:Nt("No topic is set."),readonly:!e.user.isDialogOperator(e.dialog),$$slots:{default:[uo],label:[so]},$$scope:{ctx:e}}});return{c(){t=E("input"),a=S(),o=E("input"),i=S(),s.$$.fragment.c(),P(t,"type","hidden"),P(t,"name","connection_id"),t.value=n=e.dialog.connection_id,P(o,"type","hidden"),P(o,"name","dialog_id"),o.value=r=e.dialog.dialog_id},m(e,n){w(e,t,n),w(e,a,n),w(e,o,n),w(e,i,n),me(s,e,n),c=!0},p(e,a){c&&!e.dialog||n===(n=a.dialog.connection_id)||(t.value=n),c&&!e.dialog||r===(r=a.dialog.dialog_id)||(o.value=r);var i={};e.dialog&&(i.readonly=!a.user.isDialogOperator(a.dialog)),e.$$scope&&(i.$$scope={changed:e,ctx:a}),s.$set(i)},i(e){c||(le(s.$$.fragment,e),c=!0)},o(e){fe(s.$$.fragment,e),c=!1},d(e){e&&(k(t),k(a),k(o),k(i)),$e(s,e)}}}function so(t){var n,a,o=Nt("Topic")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function uo(t){return{c:e,m:e,p:e,d:e}}function lo(e){var t,n=new Rn({props:{icon:"save",disabled:!e.user.isDialogOperator(e.dialog),$$slots:{default:[fo]},$$scope:{ctx:e}}});return{c(){n.$$.fragment.c()},m(e,a){me(n,e,a),t=!0},p(e,t){var a={};e.dialog&&(a.disabled=!t.user.isDialogOperator(t.dialog)),e.$$scope&&(a.$$scope={changed:e,ctx:t}),n.$set(a)},i(e){t||(le(n.$$.fragment,e),t=!0)},o(e){fe(n.$$.fragment,e),t=!1},d(e){$e(n,e)}}}function fo(t){var n,a=Nt("Update")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function po(t){var n,a=Nt("Part")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function ho(e){var t,n,a,o,r,i,c,s,d,u,l,f,p,h,g,m,$,v=!e.dialog.is("private"),b=!e.dialog.is("private"),y=Nt("Participants (%1)",e.dialog.participants.size)+"",x=new na({props:{dialog:e.dialog}});function N(e,t){return(null==o||e.dialog)&&(o=!!t.dialog.is("private")),o?io:((null==r||e.dialog)&&(r=!!t.user.isDialogOperator(t.dialog)),r?ro:oo)}var j=N(null,e),L=j(e),R=v&&co(e),T=b&&lo(e),M=new Rn({props:{type:"button",icon:"sign-out-alt",$$slots:{default:[po]},$$scope:{ctx:e}}});M.$on("click",e.partDialog);var I=new ao({props:{dialog:e.dialog}});return{c(){t=E("div"),x.$$.fragment.c(),n=S(),a=E("p"),L.c(),i=S(),c=E("form"),R&&R.c(),s=S(),d=E("div"),T&&T.c(),u=S(),M.$$.fragment.c(),l=S(),f=E("nav"),p=E("h3"),h=O(y),g=S(),I.$$.fragment.c(),P(d,"class","form-actions"),P(c,"method","post"),P(f,"class","sidebar__nav"),P(t,"class","sidebar-wrapper is-visible"),$=A(c,"submit",C(e.updateDialogFromForm))},m(o,r){w(o,t,r),me(x,t,null),_(t,n),_(t,a),L.m(a,null),_(t,i),_(t,c),R&&R.m(c,null),_(c,s),_(c,d),T&&T.m(d,null),_(d,u),me(M,d,null),e.form_binding(c),_(t,l),_(t,f),_(f,p),_(p,h),_(f,g),me(I,f,null),m=!0},p(e,t){var n={};e.dialog&&(n.dialog=t.dialog),x.$set(n),j===(j=N(e,t))&&L?L.p(e,t):(L.d(1),(L=j(t))&&(L.c(),L.m(a,null))),e.dialog&&(v=!t.dialog.is("private")),v?R?(R.p(e,t),le(R,1)):((R=co(t)).c(),le(R,1),R.m(c,s)):R&&(de(),fe(R,1,1,()=>{R=null}),ue()),e.dialog&&(b=!t.dialog.is("private")),b?T?(T.p(e,t),le(T,1)):((T=lo(t)).c(),le(T,1),T.m(d,u)):T&&(de(),fe(T,1,1,()=>{T=null}),ue());var o={};e.$$scope&&(o.$$scope={changed:e,ctx:t}),M.$set(o),m&&!e.dialog||y===(y=Nt("Participants (%1)",t.dialog.participants.size)+"")||D(h,y);var r={};e.dialog&&(r.dialog=t.dialog),I.$set(r)},i(e){m||(le(x.$$.fragment,e),le(R),le(T),le(M.$$.fragment,e),le(I.$$.fragment,e),m=!0)},o(e){fe(x.$$.fragment,e),fe(R),fe(T),fe(M.$$.fragment,e),fe(I.$$.fragment,e),m=!1},d(n){n&&k(t),$e(x),L.d(),R&&R.d(),T&&T.d(),$e(M),e.form_binding(null),$e(I),$()}}}function go(e,t,n){let{dialog:a={}}=t;const o=K("user");let r;return e.$set=e=>{"dialog"in e&&n("dialog",a=e.dialog)},e.$$.update=(e={formEl:1,dialog:1})=>{(e.formEl||e.dialog)&&r&&r.topic&&n("formEl",r.topic.value=a.topic||"",r)},{dialog:a,user:o,formEl:r,partDialog:function(e){o.send({message:"/part",dialog:a})},updateDialogFromForm:function(e){o.send({message:"/topic "+r.topic.value,dialog:a})},form_binding:function(e){Y[e?"unshift":"push"](()=>{n("formEl",r=e)})}}}class mo extends be{constructor(e){super(),ve(this,e,go,ho,c,["dialog"])}}function $o(t){var n,a,o;return{c(){n=E("b"),a=O(t.unread),P(n,"class","unread"),n.hidden=o=!t.unread},m(e,t){w(e,n,t),_(n,a)},p(e,t){e.unread&&D(a,t.unread),e.unread&&o!==(o=!t.unread)&&(n.hidden=o)},i:e,o:e,d(e){e&&k(n)}}}function vo(e,t,n){let{unread:a=0}=t;return e.$set=e=>{"unread"in e&&n("unread",a=e.unread)},{unread:a}}class bo extends be{constructor(e){super(),ve(this,e,vo,$o,c,["unread"])}}function yo(e){var t,n=new un({props:{name:e.settingsIcon}});return{c(){n.$$.fragment.c()},m(e,a){me(n,e,a),t=!0},p(e,t){var a={};e.settingsIcon&&(a.name=t.settingsIcon),n.$set(a)},i(e){t||(le(n.$$.fragment,e),t=!0)},o(e){fe(n.$$.fragment,e),t=!1},d(e){$e(n,e)}}}function _o(e){var t,n,a,o,r=e.dialog.name+"",i=new bo({props:{unread:e.dialog.unread}});return{c(){t=E("span"),n=O(r),a=S(),i.$$.fragment.c()},m(e,r){w(e,t,r),_(t,n),w(e,a,r),me(i,e,r),o=!0},p(e,t){o&&!e.dialog||r===(r=t.dialog.name+"")||D(n,r);var a={};e.dialog&&(a.unread=t.dialog.unread),i.$set(a)},i(e){o||(le(i.$$.fragment,e),o=!0)},o(e){fe(i.$$.fragment,e),o=!1},d(e){e&&(k(t),k(a)),$e(i,e)}}}function wo(e){var t,n,a,o,r,i,c=new Zn({props:{href:"/chat/"+e.dialog.path+"#settings",class:"sidebar__item__settings",$$slots:{default:[yo]},$$scope:{ctx:e}}}),s=new Zn({props:{href:"/chat/"+e.dialog.path,class:"sidebar__item__link",$$slots:{default:[_o]},$$scope:{ctx:e}}});return{c(){t=E("div"),c.$$.fragment.c(),n=S(),s.$$.fragment.c(),P(t,"class",a="sidebar__item "+e.classNames.join(" ")),P(t,"title",o=Ct(e.connection,e.dialog)),i=A(t,"click",e.clicked)},m(e,a){w(e,t,a),me(c,t,null),_(t,n),me(s,t,null),r=!0},p(e,n){var i={};e.dialog&&(i.href="/chat/"+n.dialog.path+"#settings"),(e.$$scope||e.settingsIcon)&&(i.$$scope={changed:e,ctx:n}),c.$set(i);var d={};e.dialog&&(d.href="/chat/"+n.dialog.path),(e.$$scope||e.dialog)&&(d.$$scope={changed:e,ctx:n}),s.$set(d),r&&!e.classNames||a===(a="sidebar__item "+n.classNames.join(" "))||P(t,"class",a),r&&!e.connection&&!e.dialog||o===(o=Ct(n.connection,n.dialog))||P(t,"title",o)},i(e){r||(le(c.$$.fragment,e),le(s.$$.fragment,e),r=!0)},o(e){fe(c.$$.fragment,e),fe(s.$$.fragment,e),r=!1},d(e){e&&k(t),$e(c),$e(s),i()}}}function ko(e,t,n){let a;d(e,tn,e=>{n("$activeMenu",a=e)});let o,r,{connection:i,dialog:c}=t;return e.$set=e=>{"connection"in e&&n("connection",i=e.connection),"dialog"in e&&n("dialog",c=e.dialog)},e.$$.update=(e={dialog:1})=>{e.dialog&&n("classNames",o=function(e){const t=[];return e.connection_id&&t.push("has-settings"),e.connection_id&&!e.dialog_id&&t.push("for-connection"),e.dialog_id&&t.push("for-dialog"),(e.frozen||"connected"!=i.state)&&t.push("is-frozen"),t}(c)),e.dialog&&n("settingsIcon",r=c.connection_id?c.dialog_id?c.is("private")?"user":"user-friends":"network-wired":null)},{connection:i,dialog:c,clicked:function(e){const t=e.target.closest("a");t&&t.classList.contains("sidebar__item__link")&&p(tn,a="")},classNames:o,settingsIcon:r}}class xo extends be{constructor(e){super(),ve(this,e,ko,wo,c,["connection","dialog"])}}function Eo(e){var t,n,a=new un({props:{name:e.icon}});const o=e.$$slots.default,r=u(o,e,null);return{c(){a.$$.fragment.c(),t=S(),r&&r.c()},l(e){r&&r.l(e)},m(e,o){me(a,e,o),w(e,t,o),r&&r.m(e,o),n=!0},p(e,t){var n={};e.icon&&(n.name=t.icon),a.$set(n),r&&r.p&&e.$$scope&&r.p(f(o,t,e,null),l(o,t,null))},i(e){n||(le(a.$$.fragment,e),le(r,e),n=!0)},o(e){fe(a.$$.fragment,e),fe(r,e),n=!1},d(e){$e(a,e),e&&k(t),r&&r.d(e)}}}function Oo(e){var t,n,a,o=new Zn({props:{href:e.href,class:"sidebar__item__link",native:-1!=e.href.indexOf(".html"),$$slots:{default:[Eo]},$$scope:{ctx:e}}});return{c(){t=E("div"),o.$$.fragment.c(),P(t,"class","sidebar__item"),a=A(t,"click",e.clicked)},m(e,a){w(e,t,a),me(o,t,null),n=!0},p(e,t){var n={};e.href&&(n.href=t.href),e.href&&(n.native=-1!=t.href.indexOf(".html")),(e.$$scope||e.icon)&&(n.$$scope={changed:e,ctx:t}),o.$set(n)},i(e){n||(le(o.$$.fragment,e),n=!0)},o(e){fe(o.$$.fragment,e),n=!1},d(e){e&&k(t),$e(o),a()}}}function So(e,t,n){let a;d(e,tn,e=>{n("$activeMenu",a=e)});let{href:o=!1,icon:r="cog"}=t;let{$$slots:i={},$$scope:c}=t;return e.$set=e=>{"href"in e&&n("href",o=e.href),"icon"in e&&n("icon",r=e.icon),"$$scope"in e&&n("$$scope",c=e.$$scope)},{href:o,icon:r,clicked:function(e){const t=e.target.closest("a");t&&t.classList.contains("sidebar__item__link")&&p(tn,a="")},$$slots:i,$$scope:c}}class No extends be{constructor(e){super(),ve(this,e,So,Oo,c,["href","icon"])}}function Ao(e){const t=e-1;return t*t*t+1}function Co(e,{delay:t=0,duration:n=400,easing:a=Ao,x:o=0,y:r=0,opacity:i=0}){const c=getComputedStyle(e),s=+c.opacity,d="none"===c.transform?"":c.transform,u=s*(1-i);return{delay:t,duration:n,easing:a,css:(e,t)=>`\n\t\t\ttransform: ${d} translate(${(1-e)*o}px, ${(1-e)*r}px);\n\t\t\topacity: ${s-u*t}`}}function Po(e,t,n){const a=Object.create(e);return a.dialog=t[n],a}function Do(e,t,n){const a=Object.create(e);return a.dialog=t[n],a}function jo(e,t,n){const a=Object.create(e);return a.connection=t[n],a}function Lo(e){var t,n,a,o,i,c,s,d,u,l,f,p,h,g,m,$,v,b,y,x,N=e.$user.email||Nt("Account")+"",C=new un({props:{name:"search"}});C.$on("click",e.click_handler);var L=e.$user.connections.size&&Ro(e),T=new No({props:{href:"/chat",icon:e.$notifications.unread?"bell":"bell-slash",$$slots:{default:[Uo]},$$scope:{ctx:e}}}),M=new No({props:{href:"/add/conversation",icon:"comment",$$slots:{default:[Ho]},$$scope:{ctx:e}}}),I=new No({props:{href:"/add/connection",icon:"network-wired",$$slots:{default:[zo]},$$scope:{ctx:e}}}),U=new No({props:{href:"/settings",icon:"cog",$$slots:{default:[Bo]},$$scope:{ctx:e}}}),H=new No({props:{href:"/help",icon:"question-circle",$$slots:{default:[Fo]},$$scope:{ctx:e}}}),z=new No({props:{href:"/api/user/logout.html",icon:"power-off",$$slots:{default:[qo]},$$scope:{ctx:e}}});return{c(){t=E("div"),n=E("div"),a=E("form"),o=E("input"),c=S(),C.$$.fragment.c(),s=S(),d=E("nav"),L&&L.c(),u=S(),l=E("h3"),f=O(N),p=S(),T.$$.fragment.c(),h=S(),M.$$.fragment.c(),g=S(),I.$$.fragment.c(),m=S(),U.$$.fragment.c(),$=S(),H.$$.fragment.c(),v=S(),z.$$.fragment.c(),P(o,"type","text"),P(o,"placeholder",i=e.searchHasFocus?Nt("Search..."):Nt("Convos")),P(a,"class","sidebar__header"),P(d,"class","sidebar__nav"),R(d,"is-filtering",e.filter.length>0),P(n,"class","sidebar"),P(t,"class","sidebar-wrapper"),x=[A(o,"input",e.input_input_handler),A(o,"blur",e.clearFilter),A(o,"focus",e.filterNav),A(o,"keydown",e.onSearchKeydown)]},m(r,i){w(r,t,i),_(t,n),_(n,a),_(a,o),j(o,e.filter),e.input_binding(o),_(a,c),me(C,a,null),_(n,s),_(n,d),L&&L.m(d,null),_(d,u),_(d,l),_(l,f),_(d,p),me(T,d,null),_(d,h),me(M,d,null),_(d,g),me(I,d,null),_(d,m),me(U,d,null),_(d,$),me(H,d,null),_(d,v),me(z,d,null),e.nav_binding(d),y=!0},p(e,t){e.filter&&o.value!==t.filter&&j(o,t.filter),y&&!e.searchHasFocus||i===(i=t.searchHasFocus?Nt("Search..."):Nt("Convos"))||P(o,"placeholder",i),t.$user.connections.size?L?(L.p(e,t),le(L,1)):((L=Ro(t)).c(),le(L,1),L.m(d,u)):L&&(de(),fe(L,1,1,()=>{L=null}),ue()),y&&!e.$user||N===(N=t.$user.email||Nt("Account")+"")||D(f,N);var n={};e.$notifications&&(n.icon=t.$notifications.unread?"bell":"bell-slash"),(e.$$scope||e.$notifications)&&(n.$$scope={changed:e,ctx:t}),T.$set(n);var a={};e.$$scope&&(a.$$scope={changed:e,ctx:t}),M.$set(a);var r={};e.$$scope&&(r.$$scope={changed:e,ctx:t}),I.$set(r);var c={};e.$$scope&&(c.$$scope={changed:e,ctx:t}),U.$set(c);var s={};e.$$scope&&(s.$$scope={changed:e,ctx:t}),H.$set(s);var l={};e.$$scope&&(l.$$scope={changed:e,ctx:t}),z.$set(l),e.filter&&R(d,"is-filtering",t.filter.length>0)},i(n){y||(le(C.$$.fragment,n),le(L),le(T.$$.fragment,n),le(M.$$.fragment,n),le(I.$$.fragment,n),le(U.$$.fragment,n),le(H.$$.fragment,n),le(z.$$.fragment,n),ne(()=>{b||(b=he(t,Co,e.flyTransitionParameters,!0)),b.run(1)}),y=!0)},o(n){fe(C.$$.fragment,n),fe(L),fe(T.$$.fragment,n),fe(M.$$.fragment,n),fe(I.$$.fragment,n),fe(U.$$.fragment,n),fe(H.$$.fragment,n),fe(z.$$.fragment,n),b||(b=he(t,Co,e.flyTransitionParameters,!1)),b.run(0),y=!1},d(n){n&&k(t),e.input_binding(null),$e(C),L&&L.d(),$e(T),$e(M),$e(I),$e(U),$e(H),$e(z),e.nav_binding(null),n&&b&&b.end(),r(x)}}}function Ro(e){var t,n,a,o,r,i=Nt("Conversations")+"";let c=e.$user.connections.toArray(),s=[];for(let t=0;t<c.length;t+=1)s[t]=Io(jo(e,c,t));const d=e=>fe(s[e],1,1,()=>{s[e]=null});return{c(){t=E("h3"),n=O(i),a=S();for(let e=0;e<s.length;e+=1)s[e].c();o=N()},m(e,i){w(e,t,i),_(t,n),w(e,a,i);for(let t=0;t<s.length;t+=1)s[t].m(e,i);w(e,o,i),r=!0},p(e,t){if(e.$user){let n;for(c=t.$user.connections.toArray(),n=0;n<c.length;n+=1){const a=jo(t,c,n);s[n]?(s[n].p(e,a),le(s[n],1)):(s[n]=Io(a),s[n].c(),le(s[n],1),s[n].m(o.parentNode,o))}for(de(),n=c.length;n<s.length;n+=1)d(n);ue()}},i(e){if(!r){for(let e=0;e<c.length;e+=1)le(s[e]);r=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)fe(s[e]);r=!1},d(e){e&&(k(t),k(a)),x(s,e),e&&k(o)}}}function To(e){var t,n=new xo({props:{connection:e.connection,dialog:e.dialog}});return{c(){n.$$.fragment.c()},m(e,a){me(n,e,a),t=!0},p(e,t){var a={};e.$user&&(a.connection=t.connection),e.$user&&(a.dialog=t.dialog),n.$set(a)},i(e){t||(le(n.$$.fragment,e),t=!0)},o(e){fe(n.$$.fragment,e),t=!1},d(e){$e(n,e)}}}function Mo(e){var t,n=new xo({props:{connection:e.connection,dialog:e.dialog}});return{c(){n.$$.fragment.c()},m(e,a){me(n,e,a),t=!0},p(e,t){var a={};e.$user&&(a.connection=t.connection),e.$user&&(a.dialog=t.dialog),n.$set(a)},i(e){t||(le(n.$$.fragment,e),t=!0)},o(e){fe(n.$$.fragment,e),t=!1},d(e){$e(n,e)}}}function Io(e){var t,n,a,o,r=new xo({props:{connection:e.connection,dialog:e.connection}});let i=e.connection.dialogs.filter(Ko),c=[];for(let t=0;t<i.length;t+=1)c[t]=To(Do(e,i,t));const s=e=>fe(c[e],1,1,()=>{c[e]=null});let d=e.connection.dialogs.filter(Vo),u=[];for(let t=0;t<d.length;t+=1)u[t]=Mo(Po(e,d,t));const l=e=>fe(u[e],1,1,()=>{u[e]=null});return{c(){r.$$.fragment.c(),t=S();for(let e=0;e<c.length;e+=1)c[e].c();n=S();for(let e=0;e<u.length;e+=1)u[e].c();a=N()},m(e,i){me(r,e,i),w(e,t,i);for(let t=0;t<c.length;t+=1)c[t].m(e,i);w(e,n,i);for(let t=0;t<u.length;t+=1)u[t].m(e,i);w(e,a,i),o=!0},p(e,t){var o={};if(e.$user&&(o.connection=t.connection),e.$user&&(o.dialog=t.connection),r.$set(o),e.$user){let a;for(i=t.connection.dialogs.filter(Ko),a=0;a<i.length;a+=1){const o=Do(t,i,a);c[a]?(c[a].p(e,o),le(c[a],1)):(c[a]=To(o),c[a].c(),le(c[a],1),c[a].m(n.parentNode,n))}for(de(),a=i.length;a<c.length;a+=1)s(a);ue()}if(e.$user){let n;for(d=t.connection.dialogs.filter(Vo),n=0;n<d.length;n+=1){const o=Po(t,d,n);u[n]?(u[n].p(e,o),le(u[n],1)):(u[n]=Mo(o),u[n].c(),le(u[n],1),u[n].m(a.parentNode,a))}for(de(),n=d.length;n<u.length;n+=1)l(n);ue()}},i(e){if(!o){le(r.$$.fragment,e);for(let e=0;e<i.length;e+=1)le(c[e]);for(let e=0;e<d.length;e+=1)le(u[e]);o=!0}},o(e){fe(r.$$.fragment,e),c=c.filter(Boolean);for(let e=0;e<c.length;e+=1)fe(c[e]);u=u.filter(Boolean);for(let e=0;e<u.length;e+=1)fe(u[e]);o=!1},d(e){$e(r,e),e&&k(t),x(c,e),e&&k(n),x(u,e),e&&k(a)}}}function Uo(e){var t,n,a,o,r=Nt("Notifications")+"",i=new bo({props:{unread:e.$notifications.unread}});return{c(){t=E("span"),n=O(r),a=S(),i.$$.fragment.c()},m(e,r){w(e,t,r),_(t,n),w(e,a,r),me(i,e,r),o=!0},p(e,t){var n={};e.$notifications&&(n.unread=t.$notifications.unread),i.$set(n)},i(e){o||(le(i.$$.fragment,e),o=!0)},o(e){fe(i.$$.fragment,e),o=!1},d(e){e&&(k(t),k(a)),$e(i,e)}}}function Ho(t){var n,a,o=Nt("Add conversation")+"";return{c(){n=E("span"),a=O(o)},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function zo(t){var n,a,o=Nt("Add connection")+"";return{c(){n=E("span"),a=O(o)},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function Bo(t){var n,a,o=Nt("Settings")+"";return{c(){n=E("span"),a=O(o)},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function Fo(t){var n,a,o=Nt("Help")+"";return{c(){n=E("span"),a=O(o)},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function qo(t){var n,a,o=Nt("Log out")+"";return{c(){n=E("span"),a=O(o)},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function Wo(e){var t,n,a;ne(e.onwindowresize);var o=(e.wideEnough||"nav"==e.$activeMenu)&&Lo(e);return{c(){o&&o.c(),t=N(),a=[A(window,"keydown",e.onGlobalKeydown),A(window,"resize",e.onwindowresize)]},m(e,a){o&&o.m(e,a),w(e,t,a),n=!0},p(e,n){n.wideEnough||"nav"==n.$activeMenu?o?(o.p(e,n),le(o,1)):((o=Lo(n)).c(),le(o,1),o.m(t.parentNode,t)):o&&(de(),fe(o,1,1,()=>{o=null}),ue())},i(e){n||(le(o),n=!0)},o(e){fe(o),n=!1},d(e){o&&o.d(e),e&&k(t),r(a)}}}const Ko=e=>!e.is_private,Vo=e=>e.is_private;function Go(e,t,n){let a,o,r;d(e,tn,e=>{n("$activeMenu",o=e)});const i=K("user");d(e,i,e=>{n("$user",a=e)});const c=a.notifications;d(e,c,e=>{n("$notifications",r=e)});let s,u,l=0,f=0,h="",g=!1,m=[];function $(){n("searchHasFocus",g=!1),setTimeout(()=>{n("filter",h="")},100)}function v(){if(!s)return;const e=new RegExp("\\b\\W*"+We(h),"i"),t={};n("activeLinkIndex",l=0),n("searchHasFocus",g=!0),n("visibleLinks",m=[]),qe(s,".sidebar__item__link",(a,o)=>{const r=a.classList;!h.length&&r.contains("has-path")&&n("activeLinkIndex",l=o),r.remove("has-focus");const i=a.parentNode,c=!h.length||!t[a.href]&&a.textContent.match(e);c&&m.push(a),c?i.removeAttribute("hidden"):i.setAttribute("hidden",""),t[a.href]=!0}),qe(s,".for-connection",e=>{let t=e;for(;(t=t.nextElementSibling)&&t.classList.contains("for-dialog");)if(!t.hasAttribute("hidden"))return e.removeAttribute("hidden")}),qe(s,"h3",e=>{let t=e;for(;(t=t.nextElementSibling)&&!Ve(t,"h3");)if(!t.hasAttribute("hidden"))return e.removeAttribute("hidden");e.setAttribute("hidden","")})}function b(e){He(e.target,".chat-header")||He(e.target,".sidebar-wrapper")||p(tn,o="")}q(()=>(document.addEventListener("click",b),()=>document.removeEventListener("click",b)));let y,_;return e.$$.update=(e={containerWidth:1,wideEnough:1,filter:1,visibleLinks:1,activeLinkIndex:1})=>{e.containerWidth&&n("wideEnough",y=f>=800),(e.wideEnough||e.containerWidth)&&n("flyTransitionParameters",_={duration:y?0:250,x:f}),e.filter&&v(),(e.visibleLinks||e.activeLinkIndex)&&m[l]&&m[l].classList.add("has-focus")},{user:i,notifications:c,containerWidth:f,filter:h,navEl:s,searchHasFocus:g,searchInput:u,clearFilter:$,filterNav:v,onGlobalKeydown:function(e){if(e.shiftKey&&13==e.keyCode){e.preventDefault();const t=document.activeElement||u;t==u||Ve(t,"body"),u.focus()}},onSearchKeydown:function(e){if(13==e.keyCode)return e.preventDefault(),$(),void(m[l]&&Zt(m[l].href));const t=38==e.keyCode?-1:40==e.keyCode?1:0;t&&(e.preventDefault(),m[l]&&m[l].classList.remove("has-focus"),n("activeLinkIndex",l+=e.ctrlKey?4*t:t)),l<0&&n("activeLinkIndex",l=m.length-1),l>=m.length&&n("activeLinkIndex",l=0)},$user:a,wideEnough:y,flyTransitionParameters:_,$activeMenu:o,$notifications:r,onwindowresize:function(){f=window.innerWidth,n("containerWidth",f)},input_input_handler:function(){h=this.value,n("filter",h)},input_binding:function(e){Y[e?"unshift":"push"](()=>{n("searchInput",u=e)})},click_handler:()=>u.focus(),nav_binding:function(e){Y[e?"unshift":"push"](()=>{n("navEl",s=e)})}}}class Yo extends be{constructor(e){super(),ve(this,e,Go,Wo,c,[])}}function Jo(e){var t,n,a,o,r,i=e.$pathParts[2]||e.$pathParts[1]||Nt("Notifications")+"",c=Ct(e.connection,e.dialog)+"";return{c(){t=E("h1"),n=O(i),a=S(),o=E("small"),r=O(c)},m(e,i){w(e,t,i),_(t,n),w(e,a,i),w(e,o,i),_(o,r)},p(e,t){e.$pathParts&&i!==(i=t.$pathParts[2]||t.$pathParts[1]||Nt("Notifications")+"")&&D(n,i),(e.connection||e.dialog)&&c!==(c=Ct(t.connection,t.dialog)+"")&&D(r,c)},d(e){e&&(k(t),k(a),k(o))}}}function Xo(e){var t,n=new Pn({props:{connection:e.connection,dialog:e.dialog,input:e.chatInput}});return{c(){n.$$.fragment.c()},m(e,a){me(n,e,a),t=!0},p(e,t){var a={};e.connection&&(a.connection=t.connection),e.dialog&&(a.dialog=t.dialog),e.chatInput&&(a.input=t.chatInput),n.$set(a)},i(e){t||(le(n.$$.fragment,e),t=!0)},o(e){fe(n.$$.fragment,e),t=!1},d(e){$e(n,e)}}}function Zo(e){var t,n,a,o,r,i,c,s,d,u,l,f,p,h=Nt("You are not part of this conversation.")+"",g=Nt('Do you want to chat with "%1"?',e.$pathParts[2])+"",m=Nt("Yes")+"",$=new Zn({props:{href:"/chat",class:"btn",$$slots:{default:[tr]},$$scope:{ctx:e}}});return{c(){t=E("h2"),n=O(h),a=S(),o=E("p"),r=O(g),i=S(),c=E("p"),s=E("a"),d=O(m),l=S(),$.$$.fragment.c(),P(s,"href",u="#add:"+e.$pathParts[2]),P(s,"class","btn"),p=A(s,"click",C(e.addDialog))},m(e,u){w(e,t,u),_(t,n),w(e,a,u),w(e,o,u),_(o,r),w(e,i,u),w(e,c,u),_(c,s),_(s,d),_(c,l),me($,c,null),f=!0},p(e,t){f&&!e.$pathParts||g===(g=Nt('Do you want to chat with "%1"?',t.$pathParts[2])+"")||D(r,g),f&&!e.$pathParts||u===(u="#add:"+t.$pathParts[2])||P(s,"href",u);var n={};e.$$scope&&(n.$$scope={changed:e,ctx:t}),$.$set(n)},i(e){f||(le($.$$.fragment,e),f=!0)},o(e){fe($.$$.fragment,e),f=!1},d(e){e&&(k(t),k(a),k(o),k(i),k(c)),$e($),p()}}}function Qo(e){var t,n,a,o,r,i,c,s,d,u=Nt("Connection does not exist.")+"",l=Nt('Do you want to create the connection "%1"?',e.$pathParts[1])+"",f=new Zn({props:{href:"/add/connection?server="+encodeURIComponent(e.$pathParts[1])+"&dialog="+encodeURIComponent(e.$pathParts[2]),class:"btn",$$slots:{default:[nr]},$$scope:{ctx:e}}}),p=new Zn({props:{href:"/chat",class:"btn",$$slots:{default:[ar]},$$scope:{ctx:e}}});return{c(){t=E("h2"),n=O(u),a=S(),o=E("p"),r=O(l),i=S(),c=E("p"),f.$$.fragment.c(),s=S(),p.$$.fragment.c()},m(e,u){w(e,t,u),_(t,n),w(e,a,u),w(e,o,u),_(o,r),w(e,i,u),w(e,c,u),me(f,c,null),_(c,s),me(p,c,null),d=!0},p(e,t){d&&!e.$pathParts||l===(l=Nt('Do you want to create the connection "%1"?',t.$pathParts[1])+"")||D(r,l);var n={};e.$pathParts&&(n.href="/add/connection?server="+encodeURIComponent(t.$pathParts[1])+"&dialog="+encodeURIComponent(t.$pathParts[2])),e.$$scope&&(n.$$scope={changed:e,ctx:t}),f.$set(n);var a={};e.$$scope&&(a.$$scope={changed:e,ctx:t}),p.$set(a)},i(e){d||(le(f.$$.fragment,e),le(p.$$.fragment,e),d=!0)},o(e){fe(f.$$.fragment,e),fe(p.$$.fragment,e),d=!1},d(e){e&&(k(t),k(a),k(o),k(i),k(c)),$e(f),$e(p)}}}function er(t){var n,a,o=Nt("Loading...")+"";return{c(){n=E("h2"),a=O(o)},m(e,t){w(e,n,t),_(n,a)},p:e,i:e,o:e,d(e){e&&k(n)}}}function tr(t){var n,a=Nt("No")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function nr(t){var n,a=Nt("Yes")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function ar(t){var n,a=Nt("No")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function or(e){var t;let n={dialog:e.dialog};var a=new yn({props:n});return e.chatinput_binding(a),{c(){a.$$.fragment.c()},m(e,n){me(a,e,n),t=!0},p(e,t){var n={};e.dialog&&(n.dialog=t.dialog),a.$set(n)},i(e){t||(le(a.$$.fragment,e),t=!0)},o(e){fe(a.$$.fragment,e),t=!1},d(t){e.chatinput_binding(null),$e(a,t)}}}function rr(e){var t,n,a,o,r,i,c=Nt("Participants (%1)",e.dialog.participants.size)+"",s=new ao({props:{dialog:e.dialog}});return{c(){t=E("div"),n=E("div"),a=E("h3"),o=O(c),r=S(),s.$$.fragment.c(),P(n,"class","sidebar__nav"),P(t,"class","sidebar-participants-wrapper")},m(e,c){w(e,t,c),_(t,n),_(n,a),_(a,o),_(n,r),me(s,n,null),i=!0},p(e,t){i&&!e.dialog||c===(c=Nt("Participants (%1)",t.dialog.participants.size)+"")||D(o,c);var n={};e.dialog&&(n.dialog=t.dialog),s.$set(n)},i(e){i||(le(s.$$.fragment,e),i=!0)},o(e){fe(s.$$.fragment,e),i=!1},d(e){e&&k(t),$e(s)}}}function ir(e){var t,n,a,o,i,c,s,d,u,l,f,p,h,g;ne(e.onwindowresize);var m=new Yo({}),$=e.settingsComponent;function v(e){return{props:{dialog:e.dialog}}}if($)var b=new $(v(e));var y=new pn({props:{$$slots:{default:[Jo]},$$scope:{ctx:e}}}),x=[er,Qo,Zo,Xo],O=[];function C(e,t){return(null==c||e.$user||e.dialog)&&(c=!!(t.$user.is("loading")||t.dialog.is("loading")&&!t.dialog.messages.length)),c?0:t.$pathParts[1]&&!t.connection.connection_id?1:t.$pathParts[2]&&!t.dialog.connection_id?2:3}s=C(null,e),d=O[s]=x[s](e);var D=e.dialog.connection_id&&or(e),j=e.dialog.participants.size&&rr(e);return{c(){m.$$.fragment.c(),t=S(),b&&b.$$.fragment.c(),n=S(),y.$$.fragment.c(),a=S(),o=E("main"),i=E("div"),d.c(),l=S(),D&&D.c(),f=S(),j&&j.c(),p=N(),ne(()=>e.div_resize_handler.call(i)),P(i,"class","messages-container"),P(o,"class","main messages-wrapper"),g=[A(window,"resize",e.onwindowresize),A(o,"scroll",e.onScroll)]},m(r,c){me(m,r,c),w(r,t,c),b&&me(b,r,c),w(r,n,c),me(y,r,c),w(r,a,c),w(r,o,c),_(o,i),O[s].m(i,null),u=function(e,t){"static"===getComputedStyle(e).position&&(e.style.position="relative");const n=document.createElement("object");let a;return n.setAttribute("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;"),n.type="text/html",n.tabIndex=-1,n.onload=()=>{(a=n.contentDocument.defaultView).addEventListener("resize",t)},/Trident/.test(navigator.userAgent)?(e.appendChild(n),n.data="about:blank"):(n.data="about:blank",e.appendChild(n)),{cancel:()=>{a&&a.removeEventListener&&a.removeEventListener("resize",t),e.removeChild(n)}}}(i,e.div_resize_handler.bind(i)),e.main_binding(o),w(r,l,c),D&&D.m(r,c),w(r,f,c),j&&j.m(r,c),w(r,p,c),h=!0},p(e,t){var a={};if(e.dialog&&(a.dialog=t.dialog),$!==($=t.settingsComponent)){if(b){de();const e=b;fe(e.$$.fragment,1,0,()=>{$e(e,1)}),ue()}$?((b=new $(v(t))).$$.fragment.c(),le(b.$$.fragment,1),me(b,n.parentNode,n)):b=null}else $&&b.$set(a);var o={};(e.$$scope||e.connection||e.dialog||e.$pathParts)&&(o.$$scope={changed:e,ctx:t}),y.$set(o);var r=s;(s=C(e,t))===r?O[s].p(e,t):(de(),fe(O[r],1,1,()=>{O[r]=null}),ue(),(d=O[s])||(d=O[s]=x[s](t)).c(),le(d,1),d.m(i,null)),t.dialog.connection_id?D?(D.p(e,t),le(D,1)):((D=or(t)).c(),le(D,1),D.m(f.parentNode,f)):D&&(de(),fe(D,1,1,()=>{D=null}),ue()),t.dialog.participants.size?j?(j.p(e,t),le(j,1)):((j=rr(t)).c(),le(j,1),j.m(p.parentNode,p)):j&&(de(),fe(j,1,1,()=>{j=null}),ue())},i(e){h||(le(m.$$.fragment,e),b&&le(b.$$.fragment,e),le(y.$$.fragment,e),le(d),le(D),le(j),h=!0)},o(e){fe(m.$$.fragment,e),b&&fe(b.$$.fragment,e),fe(y.$$.fragment,e),fe(d),fe(D),fe(j),h=!1},d(i){$e(m,i),i&&k(t),b&&$e(b,i),i&&k(n),$e(y,i),i&&(k(a),k(o)),O[s].d(),u.cancel(),e.main_binding(null),i&&k(l),D&&D.d(i),i&&k(f),j&&j.d(i),i&&k(p),r(g)}}}function cr(e,t,n){let a,o,r;d(e,rn,e=>{n("$pathParts",o=e)}),d(e,cn,e=>{n("$currentUrl",r=e)});const i=K("embedMaker"),c=K("user");let s,u;d(e,c,e=>{n("$user",a=e)});let l,f=null,p=0,h=0,g=0,m="bottom",$={},v=c.notifications,b="",y=[];var _;function w(e){"#settings"==e.hash&&v.connection_id?n("settingsComponent",f=v.dialog_id?mo:Ga):n("settingsComponent",f=null)}function k(e,t){e.forEach(({isIntersecting:e,target:t})=>{e&&i.render((v.messages[t.dataset.index]||{}).embeds||[],t)})}q(()=>{qe(document,".message__embed",e=>e.remove())}),_=()=>{l=l||new IntersectionObserver(k,{rootMargin:"0px"}),qe(document,".message",e=>l.observe(e)),"bottom"==m?n("messagesEl",u.scrollTop=h,u):g&&g<h&&(n("messagesEl",u.scrollTop=h-g,u),g=0)},F().$$.after_update.push(_),function(e){F().$$.on_destroy.push(e)}(()=>{y.forEach(e=>e())});const x=Ue(e=>{if(!v.dialog_id)return;const t=u.offsetHeight,n=u.scrollTop;"top"!=(m=t>h||n+20>h-t?"bottom":n<100?"top":"middle")||v.is("loading")||(v.messages.length&&!v.messages[0].endOfHistory&&v.loadHistoric(),g=h)},20);return e.$$.update=(e={$user:1,$pathParts:1,$currentUrl:1})=>{(e.$user||e.$pathParts)&&function(e,t){const a=e.findDialog({connection_id:t[1]})||{};a!=$&&n("connection",$=a);const i=1==t.length?e.notifications:e.findDialog({connection_id:t[1],dialog_id:o[2]});if(!i)return n("dialog",v=e.notifications);i==v&&b||(y&&y.forEach(e=>e()),b&&v.setLastRead&&v.setLastRead(),n("dialog",v=i),b=t.join("/"),y=[],$.subscribe&&y.push($.subscribe(e=>{n("connection",$=e)})),v!=$&&y.push(v.subscribe(e=>{n("dialog",v=e)})),v.load(),w(r))}(a,o),e.$currentUrl&&w(r)},{user:c,chatInput:s,messagesEl:u,settingsComponent:f,containerHeight:p,messagesHeight:h,connection:$,dialog:v,addDialog:function(e){$.connection_id&&$.addDialog(e.target.closest("a").href.replace(/.*#add:/,""))},onScroll:x,$user:a,$pathParts:o,onwindowresize:function(){p=window.innerHeight,n("containerHeight",p)},div_resize_handler:function(){h=this.offsetHeight,n("messagesHeight",h)},main_binding:function(e){Y[e?"unshift":"push"](()=>{n("messagesEl",u=e)})},chatinput_binding:function(e){Y[e?"unshift":"push"](()=>{n("chatInput",s=e)})}}}class sr extends be{constructor(e){super(),ve(this,e,cr,ir,c,[])}}function dr(t){var n,a,o=Nt("Add connection")+"";return{c(){n=E("h1"),a=O(o)},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function ur(e){var t,n,a,o,r=new Yo({}),i=new pn({props:{$$slots:{default:[dr]},$$scope:{ctx:e}}}),c=new za({});return{c(){r.$$.fragment.c(),t=S(),i.$$.fragment.c(),n=S(),a=E("main"),c.$$.fragment.c(),P(a,"class","main")},m(e,s){me(r,e,s),w(e,t,s),me(i,e,s),w(e,n,s),w(e,a,s),me(c,a,null),o=!0},p(e,t){var n={};e.$$scope&&(n.$$scope={changed:e,ctx:t}),i.$set(n)},i(e){o||(le(r.$$.fragment,e),le(i.$$.fragment,e),le(c.$$.fragment,e),o=!0)},o(e){fe(r.$$.fragment,e),fe(i.$$.fragment,e),fe(c.$$.fragment,e),o=!1},d(e){$e(r,e),e&&k(t),$e(i,e),e&&(k(n),k(a)),$e(c)}}}class lr extends be{constructor(e){super(),ve(this,e,null,ur,c,[])}}function fr(e,t,n){const a=Object.create(e);return a.opt=t[n],a.i=n,a}const pr=()=>({}),hr=()=>({});function gr(e){var t,n,a,o,i=e.opt.length>1?e.opt[1]:e.opt[0]+"";function c(){return e.mouseover_handler(e)}return{c(){t=E("a"),n=O(i),P(t,"href",a="#"+e.i+":"+e.opt[0]),P(t,"tabindex","-1"),R(t,"is-active",e.i==e.activeIndex),o=[A(t,"click",e.selectOption),A(t,"mouseover",c)]},m(e,a){w(e,t,a),_(t,n)},p(o,r){e=r,o.visibleOptions&&i!==(i=e.opt.length>1?e.opt[1]:e.opt[0]+"")&&D(n,i),o.visibleOptions&&a!==(a="#"+e.i+":"+e.opt[0])&&P(t,"href",a),o.activeIndex&&R(t,"is-active",e.i==e.activeIndex)},d(e){e&&k(t),r(o)}}}function mr(e){var t,n,a,o,i,c,s,d,p,h,g;const m=e.$$slots.label,$=u(m,e,hr);let v=e.visibleOptions,b=[];for(let t=0;t<v.length;t+=1)b[t]=gr(fr(e,v,t));return{c(){t=E("div"),n=E("label"),$||(a=O("Label")),$&&$.c(),o=S(),i=E("input"),c=S(),s=E("input"),d=S(),p=E("div");for(let e=0;e<b.length;e+=1)b[e].c();P(n,"for",e.id),P(i,"type","hidden"),P(i,"name",e.name),P(s,"type","text"),P(s,"placeholder",e.placeholder),P(s,"id",e.id),s.readOnly=e.readonly,P(s,"autocomplete","off"),P(p,"class","select-field__options"),P(t,"class","select-field text-field"),t.hidden=e.hidden,R(t,"is-open",e.open),g=[A(i,"input",e.input0_input_handler),A(i,"keydown",e.keydown),A(s,"keydown",e.keydown),A(s,"keyup",e.keyup),A(t,"click",C(e.toggle))]},l(e){$&&$.l(label_nodes)},m(r,u){w(r,t,u),_(t,n),$?$.m(n,null):_(n,a),_(t,o),_(t,i),j(i,e.value),e.input0_binding(i),_(t,c),_(t,s),e.input1_binding(s),_(t,d),_(t,p);for(let e=0;e<b.length;e+=1)b[e].m(p,null);e.div1_binding(t),h=!0},p(e,a){if($&&$.p&&e.$$scope&&$.p(f(m,a,e,pr),l(m,a,hr)),h&&!e.id||P(n,"for",a.id),e.value&&j(i,a.value),h&&!e.name||P(i,"name",a.name),h&&!e.placeholder||P(s,"placeholder",a.placeholder),h&&!e.id||P(s,"id",a.id),h&&!e.readonly||(s.readOnly=a.readonly),e.visibleOptions||e.activeIndex){let t;for(v=a.visibleOptions,t=0;t<v.length;t+=1){const n=fr(a,v,t);b[t]?b[t].p(e,n):(b[t]=gr(n),b[t].c(),b[t].m(p,null))}for(;t<b.length;t+=1)b[t].d(1);b.length=v.length}h&&!e.hidden||(t.hidden=a.hidden),e.open&&R(t,"is-open",a.open)},i(e){h||(le($,e),h=!0)},o(e){fe($,e),h=!1},d(n){n&&k(t),$&&$.d(n),e.input0_binding(null),e.input1_binding(null),x(b,n),e.div1_binding(null),r(g)}}}function $r(e,t,n){const a=["ArrowDown","ArrowUp","Enter"];let o,r,i,c=0,s=!1,d="",{hidden:u=!1,name:l="",id:f=(l?"form_"+l:Ye()),options:p=[],placeholder:h="",readonly:g=!1,value:m=""}=t;async function $(e){let t;if("keydown"==e.type)t=y.length?y[c]:[];else{const n=e.target.href.replace(/^.*?#\d+:/,"");t=y.filter(e=>e[0]==n)[0]||[]}t.length||(t=[""]),n("value",m=t[0]),n("humanEl",r.value=t.length>1?t[1]:t[0],r),await(te(),Z),r.setSelectionRange(0,9999),n("open",s=!1)}q(()=>{r.addEventListener("blur",()=>setTimeout(()=>{n("open",s=!1)},100)),n("value",m=o.value)});let{$$slots:v={},$$scope:b}=t;let y;return e.$set=e=>{"hidden"in e&&n("hidden",u=e.hidden),"name"in e&&n("name",l=e.name),"id"in e&&n("id",f=e.id),"options"in e&&n("options",p=e.options),"placeholder"in e&&n("placeholder",h=e.placeholder),"readonly"in e&&n("readonly",g=e.readonly),"value"in e&&n("value",m=e.value),"$$scope"in e&&n("$$scope",b=e.$$scope)},e.$$.update=(e={open:1,options:1,typed:1,hiddenEl:1,humanEl:1})=>{if(e.open&&0==s&&n("typed",d=""),(e.options||e.typed)&&n("visibleOptions",y=function(e,t){let n=new RegExp("(?:^|\\s|-)"+We(t),"i"),a=[];return a.length||(a=e.filter(e=>e[0]==t)),a.length||(a=e.filter(e=>e[0].match(n))),a.concat(e.filter(e=>e.length>1&&-1!=a.indexOf(e)&&e[1].match(n)))}(p,d)),e.open&&1==s&&n("activeIndex",c=0),e.hiddenEl&&o&&!o.syncValue&&(n("hiddenEl",o.syncValue=function(){n("value",m=this.value)},o),o.syncValue()),(e.humanEl||e.options||e.hiddenEl)&&r&&!r.value&&r!=document.activeElement){const e=p.find(e=>e[0]==o.value);e&&n("humanEl",r.value=e[1]||e[0],r)}},{activeIndex:c,hiddenEl:o,humanEl:r,open:s,wrapperEl:i,hidden:u,name:l,id:f,options:p,placeholder:h,readonly:g,value:m,keydown:function(e){-1!=a.indexOf(e.key)&&e.preventDefault(),"Tab"!=e.key?s?("ArrowDown"==e.key&&n("activeIndex",c++,c),"ArrowUp"==e.key&&n("activeIndex",c--,c),"Enter"==e.key&&$(e),c>=p.length&&n("activeIndex",c=0),c<0&&n("activeIndex",c=p.length-1)):n("open",s=!0):s&&$(e)},keyup:function(e){1!=e.key.length&&"Backspace"!=e.key||n("typed",d=r.value)},selectOption:$,toggle:function(){n("open",s=!s)},visibleOptions:y,input0_input_handler:function(){m=this.value,n("value",m),n("hiddenEl",o)},input0_binding:function(e){Y[e?"unshift":"push"](()=>{n("hiddenEl",o=e)})},input1_binding:function(e){Y[e?"unshift":"push"](()=>{n("humanEl",r=e)})},mouseover_handler:({i:e})=>{n("activeIndex",c=e)},div1_binding:function(e){Y[e?"unshift":"push"](()=>{n("wrapperEl",i=e)})},$$slots:v,$$scope:b}}class vr extends be{constructor(e){super(),ve(this,e,$r,mr,c,["hidden","name","id","options","placeholder","readonly","value"])}}function br(e,t,n){const a=Object.create(e);return a.dialog=t[n],a}function yr(t){var n,a,o=Nt("Add conversation")+"";return{c(){n=E("h1"),a=O(o)},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function _r(t){var n,a,o=Nt("Connection")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function wr(t){return{c:e,m:e,p:e,d:e}}function kr(e){var t,n=Nt(e.availableDialogs.dialogs.length?"Refresh":"Load")+"";return{c(){t=O(n)},m(e,n){w(e,t,n)},p(e,a){e.availableDialogs&&n!==(n=Nt(a.availableDialogs.dialogs.length?"Refresh":"Load")+"")&&D(t,n)},d(e){e&&k(t)}}}function xr(t){var n,a,o=Nt("Conversation name")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function Er(t){return{c:e,m:e,p:e,d:e}}function Or(t){var n,a=Nt("Add")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function Sr(e){var t,n,a,o,r=e.availableDialogs.error+"";return{c(){t=E("p"),n=O(e.connectionId),a=O(": "),o=O(r),P(t,"class","error")},m(e,r){w(e,t,r),_(t,n),_(t,a),_(t,o)},p(e,t){e.connectionId&&D(n,t.connectionId),e.availableDialogs&&r!==(r=t.availableDialogs.error+"")&&D(o,r)},d(e){e&&k(t)}}}function Nr(e){var t,n,a;function o(e,t){return t.availableDialogs.done?Cr:Ar}var r=o(0,e),i=r(e);let c=e.availableDialogs.dialogs,s=[];for(let t=0;t<c.length;t+=1)s[t]=Pr(br(e,c,t));return{c(){t=E("p"),i.c(),n=S(),a=E("div");for(let e=0;e<s.length;e+=1)s[e].c();P(a,"class","dialog-add-list")},m(e,o){w(e,t,o),i.m(t,null),w(e,n,o),w(e,a,o);for(let e=0;e<s.length;e+=1)s[e].m(a,null)},p(e,n){if(r===(r=o(0,n))&&i?i.p(e,n):(i.d(1),(i=r(n))&&(i.c(),i.m(t,null))),e.availableDialogs){let t;for(c=n.availableDialogs.dialogs,t=0;t<c.length;t+=1){const o=br(n,c,t);s[t]?s[t].p(e,o):(s[t]=Pr(o),s[t].c(),s[t].m(a,null))}for(;t<s.length;t+=1)s[t].d(1);s.length=c.length}},d(e){e&&k(t),i.d(),e&&(k(n),k(a)),x(s,e)}}}function Ar(e){var t,n=Nt("Showing %1 of %2 conversations, but the list is still loading.",e.availableDialogs.dialogs.length,e.availableDialogs.n_dialogs)+"";return{c(){t=O(n)},m(e,n){w(e,t,n)},p(e,a){e.availableDialogs&&n!==(n=Nt("Showing %1 of %2 conversations, but the list is still loading.",a.availableDialogs.dialogs.length,a.availableDialogs.n_dialogs)+"")&&D(t,n)},d(e){e&&k(t)}}}function Cr(e){var t,n=Nt("Showing %1 of %2 conversations.",e.availableDialogs.dialogs.length,e.availableDialogs.n_dialogs)+"";return{c(){t=O(n)},m(e,n){w(e,t,n)},p(e,a){e.availableDialogs&&n!==(n=Nt("Showing %1 of %2 conversations.",a.availableDialogs.dialogs.length,a.availableDialogs.n_dialogs)+"")&&D(t,n)},d(e){e&&k(t)}}}function Pr(e){var t,n,a,o,r,i,c,s,d,u,l,f,p=e.dialog.n_users+"",h=e.dialog.name+"",g=e.dialog.topic||"No topic.";return{c(){t=E("a"),n=E("span"),a=O(p),o=S(),r=E("b"),i=O(h),c=S(),s=E("i"),d=O(g),u=S(),P(n,"class","dialog-add-list__n-users"),P(r,"class","dialog-add-list__name"),P(s,"class","dialog-add-list__title"),P(t,"href",l="#add:"+e.dialog.name),f=A(t,"click",C(e.addDialog))},m(e,l){w(e,t,l),_(t,n),_(n,a),_(t,o),_(t,r),_(r,i),_(t,c),_(t,s),_(s,d),_(t,u)},p(e,n){e.availableDialogs&&p!==(p=n.dialog.n_users+"")&&D(a,p),e.availableDialogs&&h!==(h=n.dialog.name+"")&&D(i,h),e.availableDialogs&&g!==(g=n.dialog.topic||"No topic.")&&D(d,g),e.availableDialogs&&l!==(l="#add:"+n.dialog.name)&&P(t,"href",l)},d(e){e&&k(t),f()}}}function Dr(e){var t,n,a,o,r,i,c,s,d,u,l,f,p,h,g,m,$,v,b,y,x=Nt("Enter the name of an exising conversation, or create a new conversation.")+"",N=Nt("It is also possible to load in all existing conversations for a given connection.")+"",D=new Yo({}),j=new pn({props:{$$slots:{default:[yr]},$$scope:{ctx:e}}});function L(t){e.selectfield_value_binding.call(null,t),l=!0,ae(()=>l=!1)}let R={name:"connection_id",options:e.connectionOptions,placeholder:Nt("Select..."),$$slots:{default:[wr],label:[_r]},$$scope:{ctx:e}};void 0!==e.connectionId&&(R.value=e.connectionId);var T=new vr({props:R});Y.push(()=>ge(T,"value",L));var M=new Rn({props:{type:"button",icon:"sync-alt",disabled:!e.connectionId,$$slots:{default:[kr]},$$scope:{ctx:e}}});function I(t){e.textfield_value_binding.call(null,t),g=!0,ae(()=>g=!1)}M.$on("click",e.loadConversations);let U={name:"dialog_id",placeholder:Nt("#room or nick"),autocomplete:"off",$$slots:{default:[Er],label:[xr]},$$scope:{ctx:e}};void 0!==e.dialogId&&(U.value=e.dialogId);var H=new fa({props:U});Y.push(()=>ge(H,"value",I)),H.$on("keyup",e.debouncedLoadConversations);var z=new Rn({props:{icon:"comment",disabled:!e.connectionId||!e.dialogId,$$slots:{default:[Or]},$$scope:{ctx:e}}}),B=e.availableDialogs.error&&Sr(e),F=null!==e.availableDialogs.done&&Nr(e);return{c(){D.$$.fragment.c(),t=S(),j.$$.fragment.c(),n=S(),a=E("main"),o=E("p"),r=O(x),i=S(),c=O(N),s=S(),d=E("form"),u=E("div"),T.$$.fragment.c(),f=S(),M.$$.fragment.c(),p=S(),h=E("div"),H.$$.fragment.c(),m=S(),z.$$.fragment.c(),$=S(),B&&B.c(),v=S(),F&&F.c(),P(u,"class","inputs-side-by-side"),P(h,"class","inputs-side-by-side"),P(d,"method","post"),P(a,"class","main"),y=A(d,"submit",C(e.addDialog))},m(l,g){me(D,l,g),w(l,t,g),me(j,l,g),w(l,n,g),w(l,a,g),_(a,o),_(o,r),_(o,i),_(o,c),_(a,s),_(a,d),_(d,u),me(T,u,null),_(u,f),me(M,u,null),_(d,p),_(d,h),me(H,h,null),_(h,m),me(z,h,null),_(d,$),B&&B.m(d,null),_(d,v),F&&F.m(d,null),e.form_binding(d),b=!0},p(e,t){var n={};e.$$scope&&(n.$$scope={changed:e,ctx:t}),j.$set(n);var a={};e.connectionOptions&&(a.options=t.connectionOptions),e.$$scope&&(a.$$scope={changed:e,ctx:t}),!l&&e.connectionId&&(a.value=t.connectionId),T.$set(a);var o={};e.connectionId&&(o.disabled=!t.connectionId),(e.$$scope||e.availableDialogs)&&(o.$$scope={changed:e,ctx:t}),M.$set(o);var r={};e.$$scope&&(r.$$scope={changed:e,ctx:t}),!g&&e.dialogId&&(r.value=t.dialogId),H.$set(r);var i={};(e.connectionId||e.dialogId)&&(i.disabled=!t.connectionId||!t.dialogId),e.$$scope&&(i.$$scope={changed:e,ctx:t}),z.$set(i),t.availableDialogs.error?B?B.p(e,t):((B=Sr(t)).c(),B.m(d,v)):B&&(B.d(1),B=null),null!==t.availableDialogs.done?F?F.p(e,t):((F=Nr(t)).c(),F.m(d,null)):F&&(F.d(1),F=null)},i(e){b||(le(D.$$.fragment,e),le(j.$$.fragment,e),le(T.$$.fragment,e),le(M.$$.fragment,e),le(H.$$.fragment,e),le(z.$$.fragment,e),b=!0)},o(e){fe(D.$$.fragment,e),fe(j.$$.fragment,e),fe(T.$$.fragment,e),fe(M.$$.fragment,e),fe(H.$$.fragment,e),fe(z.$$.fragment,e),b=!1},d(o){$e(D,o),o&&k(t),$e(j,o),o&&(k(n),k(a)),$e(T),$e(M),$e(H),$e(z),B&&B.d(),F&&F.d(),e.form_binding(null),y()}}}function jr(e,t,n){let a;const o=K("user");d(e,o,e=>{n("$user",a=e)});let r,i={dialogs:[],done:null,n_dialogs:0},c="",s="";function u(e){let t="/list";e?t+=s.length?" /"+s+"/":"":i.dialogs.length&&(t+=" refresh"),o.send({connection_id:c,message:t},e=>{const t=Be(e);n("availableDialogs",i=t?{dialogs:[],done:null,n_dialogs:0,error:t}:e),t||e.done||setTimeout(u,500)})}q(()=>en(r));const l=Ue(u,250);let f;return e.$$.update=(e={$user:1,connectionId:1,connectionOptions:1})=>{e.$user&&n("connectionOptions",f=Array.from(a.connections.keys()).map(e=>[e])),(e.connectionId||e.connectionOptions)&&(c||n("connectionId",c=f[0]?f[0][0]:""))},{user:o,availableDialogs:i,connectionId:c,dialogId:s,formEl:r,addDialog:function(e){const t=e&&e.target&&e.target.closest("a");t&&t.href&&n("dialogId",s=t.href.replace(/.*#add:/,"")),c&&s&&o.findDialog({connection_id:c}).addDialog(s)},loadConversations:u,debouncedLoadConversations:l,connectionOptions:f,selectfield_value_binding:function(e){n("connectionId",c=e),n("connectionOptions",f),n("$user",a)},textfield_value_binding:function(e){n("dialogId",s=e)},form_binding:function(e){Y[e?"unshift":"push"](()=>{n("formEl",r=e)})}}}class Lr extends be{constructor(e){super(),ve(this,e,jr,Dr,c,[])}}function Rr(t){var n,a,o,r,i,c=Nt("Help")+"";return{c(){n=E("h1"),a=O(c),o=E("small"),r=O("v"),i=O(Mr)},m(e,t){w(e,n,t),_(n,a),w(e,o,t),_(o,r),_(o,i)},p:e,d(e){e&&(k(n),k(o))}}}function Tr(e){var t,n,a,o,r,i,c,s,d,u,l,f,p,h,g,m,$,v,b,y,x,N,A,C,D,j,L,R,M,I,U,H,z,B,F=At('Got any questions? Come and talk to us in the "#convos" channel on http://freenode.net.')+"",q=At("More information can also be found on http://convos.by.")+"",W=Nt("Shortcuts")+"",K=Nt("Available commands")+"",V=Nt("Resources")+"",G=Nt("Project homepage")+"",Y=Nt("Bug/issue tracker")+"",J=Nt("Source code")+"",X=new Yo({}),Z=new pn({props:{$$slots:{default:[Rr]},$$scope:{ctx:e}}});return{c(){X.$$.fragment.c(),t=S(),Z.$$.fragment.c(),n=S(),a=E("main"),o=E("p"),i=S(),s=S(),d=E("h2"),u=O(W),l=S(),(f=E("dl")).innerHTML="<dt>shift+enter</dt><dd>Shift focus between chat input and search in sidebar.</dd><dt>tab (When writing a message)</dt><dd>Will autocomplete a command, nick or channel name.</dd>",p=S(),h=E("h2"),g=O(K),m=S(),($=E("dl")).innerHTML='<dt><a href="#/me">/me &lt;msg&gt;</a></dt><dd>Send message as an action.</dd><dt><a href="#/say">/say &lt;msg&gt;</a></dt><dd>Used when you want to send a message starting with "/".</dd><dt><a href="#/topic">/topic or /topic &lt;new topic&gt;</a></dt><dd>Show current topic, or set a new one.</dd><dt><a href="#/whois">/whois &lt;nick&gt;</a></dt><dd>Show information about a user.</dd><dt><a href="#/query">/query &lt;nick&gt;</a></dt><dd>Open up a new chat window with nick.</dd><dt><a href="#/msg">/msg &lt;nick&gt; &lt;msg&gt;</a></dt><dd>Send a direct message to nick.</dd><dt><a href="#/names">/names</a></dt><dd>Show participants in the channel.</dd><dt><a href="#/join">/join &lt;#channel&gt;</a></dt><dd>Join channel and open up a chat window.</dd><dt><a href="#/nick">/nick &lt;nick&gt;</a></dt><dd>Change your wanted nick.</dd><dt><a href="#/part">/part</a></dt><dd>Leave channel, and close window.</dd><dt><a href="#/close">/close &lt;nick&gt;</a></dt><dd>Close conversation with nick, defaults to current active.</dd><dt><a href="#/kick">/kick &lt;nick&gt;</a></dt><dd>Kick a user from the current channel.</dd><dt><a href="#/mode">/mode</a></dt><dd>Change mode of yourself or a user</dd><dt><a href="#/reconnect">/reconnect</a></dt><dd>Restart the current connection.</dd><dt><a href="#/cs">/cs &lt;msg&gt;</a></dt><dd>Short for "/msg chanserv ...".</dd><dt><a href="#/ns">/ns &lt;msg&gt;</a></dt><dd>Short for "/msg nickserv ...".</dd><dt><a href="#/hs">/hs &lt;msg&gt;</a></dt><dd>Short for "/msg hostserv ...".</dd><dt><a href="#/bs">/bs &lt;msg&gt;</a></dt><dd>Short for "/msg botserv ...".</dd>',v=S(),b=E("h2"),y=O(V),x=S(),N=E("ul"),A=E("li"),C=E("a"),D=O(G),j=S(),L=E("li"),R=E("a"),M=O(Y),I=S(),U=E("li"),H=E("a"),z=O(J),r=new T(F,i),c=new T(q,null),P(C,"href","http://convos.by"),P(C,"target","_blank"),P(R,"href","https://github.com/Nordaaker/convos/issues"),P(R,"target","_blank"),P(H,"href","https://github.com/Nordaaker/convos"),P(H,"target","_blank"),P(a,"class","main")},m(e,k){me(X,e,k),w(e,t,k),me(Z,e,k),w(e,n,k),w(e,a,k),_(a,o),r.m(o),_(o,i),c.m(o),_(a,s),_(a,d),_(d,u),_(a,l),_(a,f),_(a,p),_(a,h),_(h,g),_(a,m),_(a,$),_(a,v),_(a,b),_(b,y),_(a,x),_(a,N),_(N,A),_(A,C),_(C,D),_(N,j),_(N,L),_(L,R),_(R,M),_(N,I),_(N,U),_(U,H),_(H,z),B=!0},p(e,t){var n={};e.$$scope&&(n.$$scope={changed:e,ctx:t}),Z.$set(n)},i(e){B||(le(X.$$.fragment,e),le(Z.$$.fragment,e),B=!0)},o(e){fe(X.$$.fragment,e),fe(Z.$$.fragment,e),B=!1},d(e){$e(X,e),e&&k(t),$e(Z,e),e&&(k(n),k(a))}}}const Mr="1.0.0";class Ir extends be{constructor(e){super(),ve(this,e,null,Tr,c,[])}}function Ur(t){var n,a,o=Nt("Convos")+"";return{c(){n=E("span"),a=O(o)},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function Hr(t){var n,a=Nt("Login")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function zr(t){var n,a=Nt("Create account")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function Br(t){var n,a=Nt("Documentation")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function Fr(t){var n,a=Nt("GitHub")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function qr(e){var t,n,a,o,r,i,c,s,d,u,l,f,p=Nt("A multiuser chat application.")+"",h=new Zn({props:{href:"/",$$slots:{default:[Ur]},$$scope:{ctx:e}}}),g=new Zn({props:{href:"/login",$$slots:{default:[Hr]},$$scope:{ctx:e}}}),m=new Zn({props:{href:"/register",$$slots:{default:[zr]},$$scope:{ctx:e}}}),$=new Zn({props:{href:"https://convos.by/doc",$$slots:{default:[Br]},$$scope:{ctx:e}}}),v=new Zn({props:{href:"https://github.com/Nordaaker/convos",$$slots:{default:[Fr]},$$scope:{ctx:e}}});return{c(){t=E("div"),n=E("div"),a=E("h1"),h.$$.fragment.c(),o=S(),r=E("p"),i=O(p),c=S(),s=E("nav"),g.$$.fragment.c(),d=S(),m.$$.fragment.c(),u=S(),$.$$.fragment.c(),l=S(),v.$$.fragment.c(),P(a,"class","sidebar__logo"),P(r,"class","sidebar__about"),P(s,"class","sidebar__nav"),P(n,"class","sidebar is-logged-out"),P(t,"class","sidebar-wrapper")},m(e,p){w(e,t,p),_(t,n),_(n,a),me(h,a,null),_(n,o),_(n,r),_(r,i),_(n,c),_(n,s),me(g,s,null),_(s,d),me(m,s,null),_(s,u),me($,s,null),_(s,l),me(v,s,null),f=!0},p(e,t){var n={};e.$$scope&&(n.$$scope={changed:e,ctx:t}),h.$set(n);var a={};e.$$scope&&(a.$$scope={changed:e,ctx:t}),g.$set(a);var o={};e.$$scope&&(o.$$scope={changed:e,ctx:t}),m.$set(o);var r={};e.$$scope&&(r.$$scope={changed:e,ctx:t}),$.$set(r);var i={};e.$$scope&&(i.$$scope={changed:e,ctx:t}),v.$set(i)},i(e){f||(le(h.$$.fragment,e),le(g.$$.fragment,e),le(m.$$.fragment,e),le($.$$.fragment,e),le(v.$$.fragment,e),f=!0)},o(e){fe(h.$$.fragment,e),fe(g.$$.fragment,e),fe(m.$$.fragment,e),fe($.$$.fragment,e),fe(v.$$.fragment,e),f=!1},d(e){e&&k(t),$e(h),$e(g),$e(m),$e($),$e(v)}}}class Wr extends be{constructor(e){super(),ve(this,e,null,qr,c,[])}}function Kr(t){var n,a,o=Nt("E-mail")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function Vr(t){return{c:e,m:e,p:e,d:e}}function Gr(t){var n,a,o=Nt("Password")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function Yr(t){return{c:e,m:e,p:e,d:e}}function Jr(e){var t,n,a,o,r,i,c,s,d,u,l,f,p,h,g,m,$,v,b=Nt("Log in")+"",y=Nt("Log in")+"",x=Nt("Convos is the simplest way to use IRC and it keeps you always online.")+"",N=new Wr({}),D=new fa({props:{name:"email",placeholder:Nt("Ex: john@doe.com"),$$slots:{default:[Vr],label:[Kr]},$$scope:{ctx:e}}}),j=new Yn({props:{name:"password",$$slots:{default:[Yr],label:[Gr]},$$scope:{ctx:e}}}),L=new qn({props:{op:e.loginOp}});return{c(){N.$$.fragment.c(),t=S(),n=E("main"),a=E("h1"),o=O(b),r=S(),i=E("form"),D.$$.fragment.c(),c=S(),j.$$.fragment.c(),s=S(),d=E("div"),u=E("button"),l=O(y),f=S(),L.$$.fragment.c(),p=S(),h=E("article"),g=E("p"),m=O(x),P(u,"class","btn"),P(u,"op",e.loginOp),P(d,"class","form-actions"),P(i,"method","post"),P(n,"class","main align-content-middle"),v=A(i,"submit",C(e.submit_handler))},m(e,v){me(N,e,v),w(e,t,v),w(e,n,v),_(n,a),_(a,o),_(n,r),_(n,i),me(D,i,null),_(i,c),me(j,i,null),_(i,s),_(i,d),_(d,u),_(u,l),_(i,f),me(L,i,null),_(n,p),_(n,h),_(h,g),_(g,m),$=!0},p(e,t){var n={};e.$$scope&&(n.$$scope={changed:e,ctx:t}),D.$set(n);var a={};e.$$scope&&(a.$$scope={changed:e,ctx:t}),j.$set(a)},i(e){$||(le(N.$$.fragment,e),le(D.$$.fragment,e),le(j.$$.fragment,e),le(L.$$.fragment,e),$=!0)},o(e){fe(N.$$.fragment,e),fe(D.$$.fragment,e),fe(j.$$.fragment,e),fe(L.$$.fragment,e),$=!1},d(e){$e(N,e),e&&(k(t),k(n)),$e(D),$e(j),$e(L),v()}}}function Xr(e,t,n){let a;const o=K("user"),r=o.api.operation("loginUser");d(e,r,e=>{n("$loginOp",a=e)});return e.$$.update=(e={$loginOp:1})=>{e.$loginOp&&a.is("success")&&(document.cookie=r.res.headers["Set-Cookie"],r.reset(),o.load())},{loginOp:r,submit_handler:e=>r.perform(e.target)}}class Zr extends be{constructor(e){super(),ve(this,e,Xr,Jr,c,[])}}function Qr(t){var n,a,o=Nt("E-mail")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function ei(t){return{c:e,m:e,p:e,d:e}}function ti(t){var n,a,o=Nt("Password")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function ni(t){return{c:e,m:e,p:e,d:e}}function ai(t){var n,a,o=Nt("Invite code")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function oi(t){return{c:e,m:e,p:e,d:e}}function ri(e){var t,n,a,o,r,i,c,s,d,u,l,f,p,h,g,m=Nt("Create account")+"",$=Nt("Register")+"",v=new Wr({}),b=new fa({props:{name:"email",placeholder:Nt("Ex: john@doe.com"),$$slots:{default:[ei],label:[Qr]},$$scope:{ctx:e}}}),y=new Yn({props:{name:"password",$$slots:{default:[ni],label:[ti]},$$scope:{ctx:e}}}),x=function(e){var t,n=new fa({props:{name:"invite_code",$$slots:{default:[oi],label:[ai]},$$scope:{ctx:e}}});return{c(){n.$$.fragment.c()},m(e,a){me(n,e,a),t=!0},p(e,t){var a={};e.$$scope&&(a.$$scope={changed:e,ctx:t}),n.$set(a)},i(e){t||(le(n.$$.fragment,e),t=!0)},o(e){fe(n.$$.fragment,e),t=!1},d(e){$e(n,e)}}}(e),N=new qn({props:{op:e.registerOp}});return{c(){v.$$.fragment.c(),t=S(),n=E("main"),a=E("h1"),o=O(m),r=S(),i=E("form"),b.$$.fragment.c(),c=S(),y.$$.fragment.c(),s=S(),x&&x.c(),d=S(),u=E("div"),l=E("button"),f=O($),p=S(),N.$$.fragment.c(),P(l,"class","btn"),P(l,"op",e.registerOp),P(u,"class","form-actions"),P(i,"method","post"),P(n,"class","main align-content-middle"),g=A(i,"submit",C(e.submit_handler))},m(e,g){me(v,e,g),w(e,t,g),w(e,n,g),_(n,a),_(a,o),_(n,r),_(n,i),me(b,i,null),_(i,c),me(y,i,null),_(i,s),x&&x.m(i,null),_(i,d),_(i,u),_(u,l),_(l,f),_(i,p),me(N,i,null),h=!0},p(e,t){var n={};e.$$scope&&(n.$$scope={changed:e,ctx:t}),b.$set(n);var a={};e.$$scope&&(a.$$scope={changed:e,ctx:t}),y.$set(a),x.p(e,t)},i(e){h||(le(v.$$.fragment,e),le(b.$$.fragment,e),le(y.$$.fragment,e),le(x),le(N.$$.fragment,e),h=!0)},o(e){fe(v.$$.fragment,e),fe(b.$$.fragment,e),fe(y.$$.fragment,e),fe(x),fe(N.$$.fragment,e),h=!1},d(e){$e(v,e),e&&(k(t),k(n)),$e(b),$e(y),x&&x.d(),$e(N),g()}}}function ii(e,t,n){let a;const o=K("user"),r=o.api.operation("registerUser");d(e,r,e=>{n("$registerOp",a=e)});return e.$$.update=(e={$registerOp:1})=>{e.$registerOp&&a.is("success")&&(document.cookie=r.res.headers["Set-Cookie"],r.reset(),o.load())},{registerOp:r,submit_handler:e=>r.perform(e.target)}}class ci extends be{constructor(e){super(),ve(this,e,ii,ri,c,[])}}function si(t){var n,a,o=Nt("Settings")+"";return{c(){n=E("h1"),a=O(o)},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function di(t){var n,a,o=Nt("Email")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function ui(t){return{c:e,m:e,p:e,d:e}}function li(t){var n,a,o=Nt("Notification keywords")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function fi(t){return{c:e,m:e,p:e,d:e}}function pi(t){var n,a,o=Nt("Enable notifications")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function hi(t){return{c:e,m:e,p:e,d:e}}function gi(t){var n,a,o=Nt("You cannot receive notifications, because it is denied by your browser.")+"";return{c(){n=E("p"),a=O(o),P(n,"class","error")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function mi(t){var n,a,o=Nt("Expand URL to media")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function $i(t){return{c:e,m:e,p:e,d:e}}function vi(t){var n,a,o=Nt("Password")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function bi(t){return{c:e,m:e,p:e,d:e}}function yi(t){var n,a,o=Nt("Repeat password")+"";return{c(){n=E("span"),a=O(o),P(n,"slot","label")},m(e,t){w(e,n,t),_(n,a)},p:e,d(e){e&&k(n)}}}function _i(t){return{c:e,m:e,p:e,d:e}}function wi(t){var n,a=Nt("Save settings")+"";return{c(){n=O(a)},m(e,t){w(e,n,t)},p:e,d(e){e&&k(n)}}}function ki(e){var t,n,a,o,r,i,c,s,d,u,l,f,p,h,g,m,$,v,b,y=Nt("Leave the password fields empty to keep the current password.")+"",x=new Yo({}),N=new pn({props:{$$slots:{default:[si]},$$scope:{ctx:e}}}),D=new fa({props:{name:"email",value:e.$user.email,readonly:!0,$$slots:{default:[ui],label:[di]},$$scope:{ctx:e}}}),j=new fa({props:{name:"highlight_keywords",placeholder:Nt("whatever, keywords"),$$slots:{default:[fi],label:[li]},$$scope:{ctx:e}}});function L(t){e.checkbox0_checked_binding.call(null,t),c=!0,ae(()=>c=!1)}let R={name:"notifications",$$slots:{default:[hi],label:[pi]},$$scope:{ctx:e}};void 0!==e.wantNotifications&&(R.checked=e.wantNotifications);var T=new Hn({props:R});Y.push(()=>ge(T,"checked",L));var M=e.notificationsDisabled&&gi(),I=new Hn({props:{name:"expand_url",$$slots:{default:[$i],label:[mi]},$$scope:{ctx:e}}}),U=new Yn({props:{name:"password",$$slots:{default:[bi],label:[vi]},$$scope:{ctx:e}}}),H=new Yn({props:{name:"password_again",$$slots:{default:[_i],label:[yi]},$$scope:{ctx:e}}}),z=new Rn({props:{icon:"save",op:e.updateUserOp,$$slots:{default:[wi]},$$scope:{ctx:e}}}),B=new qn({props:{op:e.updateUserOp}});return{c(){x.$$.fragment.c(),t=S(),N.$$.fragment.c(),n=S(),a=E("main"),o=E("form"),D.$$.fragment.c(),r=S(),j.$$.fragment.c(),i=S(),T.$$.fragment.c(),s=S(),M&&M.c(),d=S(),I.$$.fragment.c(),u=S(),U.$$.fragment.c(),l=S(),H.$$.fragment.c(),f=S(),p=E("p"),h=O(y),g=S(),m=E("div"),z.$$.fragment.c(),$=S(),B.$$.fragment.c(),P(m,"class","form-actions"),P(o,"method","post"),P(a,"class","main"),b=A(o,"submit",C(e.updateUserFromForm))},m(c,b){me(x,c,b),w(c,t,b),me(N,c,b),w(c,n,b),w(c,a,b),_(a,o),me(D,o,null),_(o,r),me(j,o,null),_(o,i),me(T,o,null),_(o,s),M&&M.m(o,null),_(o,d),me(I,o,null),_(o,u),me(U,o,null),_(o,l),me(H,o,null),_(o,f),_(o,p),_(p,h),_(o,g),_(o,m),me(z,m,null),_(o,$),me(B,o,null),e.form_binding(o),v=!0},p(e,t){var n={};e.$$scope&&(n.$$scope={changed:e,ctx:t}),N.$set(n);var a={};e.$user&&(a.value=t.$user.email),e.$$scope&&(a.$$scope={changed:e,ctx:t}),D.$set(a);var r={};e.$$scope&&(r.$$scope={changed:e,ctx:t}),j.$set(r);var i={};e.$$scope&&(i.$$scope={changed:e,ctx:t}),!c&&e.wantNotifications&&(i.checked=t.wantNotifications),T.$set(i),t.notificationsDisabled?M?M.p(e,t):((M=gi()).c(),M.m(o,d)):M&&(M.d(1),M=null);var s={};e.$$scope&&(s.$$scope={changed:e,ctx:t}),I.$set(s);var u={};e.$$scope&&(u.$$scope={changed:e,ctx:t}),U.$set(u);var l={};e.$$scope&&(l.$$scope={changed:e,ctx:t}),H.$set(l);var f={};e.$$scope&&(f.$$scope={changed:e,ctx:t}),z.$set(f)},i(e){v||(le(x.$$.fragment,e),le(N.$$.fragment,e),le(D.$$.fragment,e),le(j.$$.fragment,e),le(T.$$.fragment,e),le(I.$$.fragment,e),le(U.$$.fragment,e),le(H.$$.fragment,e),le(z.$$.fragment,e),le(B.$$.fragment,e),v=!0)},o(e){fe(x.$$.fragment,e),fe(N.$$.fragment,e),fe(D.$$.fragment,e),fe(j.$$.fragment,e),fe(T.$$.fragment,e),fe(I.$$.fragment,e),fe(U.$$.fragment,e),fe(H.$$.fragment,e),fe(z.$$.fragment,e),fe(B.$$.fragment,e),v=!1},d(o){$e(x,o),o&&k(t),$e(N,o),o&&(k(n),k(a)),$e(D),$e(j),$e(T),M&&M.d(),$e(I),$e(U),$e(H),$e(z),$e(B),e.form_binding(null),b()}}}function xi(e,t,n){let a;const o=window.Notification||{permission:"denied"},r=K("user");d(e,r,e=>{n("$user",a=e)});const i=r.api.operation("updateUser");let c,s="denied"==o.permission,u=r.events.wantNotifications;return{user:r,updateUserOp:i,formEl:c,notificationsDisabled:s,wantNotifications:u,updateUserFromForm:function(e){const t=e.target,a=[t.password.value,t.password_again.value];if(u&&window.Notification&&"granted"!=o.permission&&o.requestPermission(e=>{"denied"==e&&(n("wantNotifications",u=!1),n("notificationsDisabled",s=!0))}),a.join("").length&&a[0]!=a[1])return i.error("Passwords does not match.");r.events.update({wantNotifications:u}),r.update({expandUrlToMedia:t.expand_url.checked}),i.perform(e.target)},$user:a,checkbox0_checked_binding:function(e){n("wantNotifications",u=e)},form_binding:function(e){Y[e?"unshift":"push"](()=>{n("formEl",c=e)})}}}class Ei extends be{constructor(e){super(),ve(this,e,xi,ki,c,[])}}function Oi(e){var t,n,a,o=e.pageComponent;if(o)var r=new o({});return{c(){r&&r.$$.fragment.c(),t=S(),(n=E("div")).textContent=" ",P(n,"class","overlay"),R(n,"is-visible",e.$activeMenu)},m(e,o){r&&me(r,e,o),w(e,t,o),w(e,n,o),a=!0},p(e,a){if(o!==(o=a.pageComponent)){if(r){de();const e=r;fe(e.$$.fragment,1,0,()=>{$e(e,1)}),ue()}o?((r=new o({})).$$.fragment.c(),le(r.$$.fragment,1),me(r,t.parentNode,t)):r=null}e.$activeMenu&&R(n,"is-visible",a.$activeMenu)},i(e){a||(r&&le(r.$$.fragment,e),a=!0)},o(e){r&&fe(r.$$.fragment,e),a=!1},d(e){r&&$e(r,e),e&&(k(t),k(n))}}}function Si(e){let t=["","chat"];if(e.connection_id&&t.push(e.connection_id),"part"==e.type){const e=document.querySelector('.sidebar-wrapper [href$="'+t.map(encodeURIComponent).join("/")+'"]');Zt(e?e.href:"/chat")}else e.dialog_id&&t.push(e.dialog_id),Zt(t.map(encodeURIComponent).join("/"))}function Ni(e,t){const n=document.querySelector("body");n.className=n.className.replace(e,(e,n)=>n+t)}function Ai(e,t,n){let a,o,r,i,c,s;d(e,an,e=>{n("$docTitle",o=e)}),d(e,rn,e=>{n("$pathParts",r=e)}),d(e,on,e=>{n("$pathname",c=e)}),d(e,tn,e=>{n("$activeMenu",s=e)});const u={"add/connection":lr,"add/conversation":Lr,chat:sr,help:Ir,settings:Ei},l={login:Zr,register:ci},f=window.Convos||{},p=new Ze(f.apiUrl,{debug:!0}),h=new et({api:p}),g=new Vt({api:p});d(e,g,e=>{n("$user",i=e)});const m=g.notifications;d(e,m,e=>{n("$notifications",a=e)});let $=null;return W("embedMaker",h),W("user",g),q(async()=>{const e=g.on("dialogEvent",Si),t=(window.addEventListener("popstate",Xt),function(){return window.removeEventListener("popstate",Xt)});return g.load(),()=>{e(),t()}}),e.$$.update=(e={$notifications:1,$docTitle:1,$pathParts:1,$user:1})=>{(e.$notifications||e.$docTitle)&&document&&(document.title=a.unread?"("+a.unread+") "+o:o),(e.$pathParts||e.$user)&&function(e,t){-1!=e.indexOf("chat")&&localStorage.setItem("lastUrl",c);const a=t.is("success")?u:l,o=a[e.join("/")]?e.join("/"):e[0],r=a[o];if(r)r!=$&&n("pageComponent",$=r),Ni(/(is-logged-)\S+/,t.is("success")?"in":"out"),Ni(/(page-)\S+/,o.replace(/\W+/g,"_"));else if(t.is("success")){Zt(localStorage.getItem("lastUrl")||(t.connections.size?"/chat":"/add/connection"),{replace:!0})}else t.is("error")&&Zt("/login",{replace:!0});if(t.is("success")&&Fe("/images/emojis.js"),$){const e=document.querySelectorAll(".js-remove");for(let t=0;t<e.length;t++)e[t].remove()}}(r,i)},{user:g,notifications:m,pageComponent:$,$activeMenu:s}}console.log("[Convos] Initializing application.");var Ci=document.querySelector("body");new class extends be{constructor(e){super(),ve(this,e,Ai,Oi,c,[])}}({target:document.body});Ci.classList=Ci.className.replace(/no-js/,"has-js"),window.renderGrid=function(){return Ci.classList.add("with-grid")},"serviceWorker"in navigator&&window.addEventListener("load",(function(e){navigator.serviceWorker.register("/sw.js").then((function(e){return window.updateServiceWorker&&e.update()}),(function(e){return console.log("[Convos] ServiceWorker registration failed:",e)}))}))}();
//# sourceMappingURL=convos.5daa883a.js.map
